[{"id":0,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/metrics/prometheus/questions/01/","title":"01","section":"questions","content":" å¦‚ä½•åœ¨kubernetesä¸­å¦‚ä½•æŠ“å–æœåŠ¡çš„metrics # prometheus ä¸­è‡ªå¸¦çš„å‡ ä¸ªmetrics # prometheus å¦‚ä½•å°†æ•°æ®å‘é€ç»™è¿œç«¯å­˜å‚¨ # ä»‹ç»ä¸€ä¸‹prometheus WAL æœºåˆ¶ # prometheus ä½¿ç”¨ä»€ä¹ˆå‹ç¼©ç®—æ³•å‹ç¼©æ•°æ® # "},{"id":1,"href":"/docs/go/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/golang-benchmark/","title":"benchmark","section":"æ€§èƒ½æµ‹è¯•","content":" Go åŸºå‡†æµ‹è¯•ï¼ˆBenchmarkï¼‰åŸç†ä¸å®è·µ # ğŸ“ˆ go test -bench èƒ½è®©ä½ åœ¨çº³ç§’çº§åˆ«æ´å¯Ÿä»£ç æ€§èƒ½ã€‚æœ¬æŒ‡å—æ±‡æ€»äº†ä»è¿è¡ŒåŸç†åˆ°å®æˆ˜æŠ€å·§çš„å®Œæ•´çŸ¥è¯†ç‚¹ã€‚\n1 â€” æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ # å…³é”®å¯¹è±¡ ä½œç”¨ go test -bench å¯åŠ¨åŸºå‡†æµ‹è¯•è¿è¡Œå™¨ï¼ˆbenchmark harnessï¼‰ã€‚ func BenchmarkXxx(b *testing.B) å£°æ˜ä¸€ä¸ªåŸºå‡†æµ‹è¯•å‡½æ•°ï¼Œåç§°éœ€ä»¥ Benchmark å‰ç¼€å¼€å¤´ã€‚ b.N è¿è¡Œå™¨è‡ªåŠ¨å†³å®šçš„å¾ªç¯æ¬¡æ•°ï¼›è¢«æµ‹ä»£ç éœ€æ”¾å…¥ for i := 0; i \u0026lt; b.N; i++ { â€¦ }ã€‚ è®¡æ—¶/ç»Ÿè®¡ é»˜è®¤ç»Ÿè®¡ wallâ€‘clock æ—¶é—´ï¼ˆns/opï¼‰ï¼›ä½¿ç”¨ -benchmem å¯é¢å¤–è¾“å‡º B/op ä¸ allocs/opã€‚ å¸¸ç”¨è¾…åŠ© API b.ResetTimer()ã€b.StopTimer()/b.StartTimer()ã€b.ReportAllocs()ã€b.SetBytes(n)ã€b.RunParallel() 2 â€” Benchmark è¿è¡ŒåŸç† # ç¼–è¯‘é˜¶æ®µ\ngo test ä¼šä¸ºæµ‹è¯•ä¸åŸºå‡†ç”Ÿæˆä¸´æ—¶ main åŒ…å¹¶ç¼–è¯‘ã€‚ æ¢æµ‹åˆé€‚çš„è¿­ä»£æ¬¡æ•° (b.N)\nåˆå§‹åŒ– N = 1ï¼›å¦‚æœä¸€æ¬¡è€—æ—¶ \u0026lt; 0.5â€¯sï¼Œå°±æŒ‰æŒ‡æ•°çº§æ”¾å¤§ï¼ˆÃ—20ã€Ã—100â€¯â€¦ï¼‰ã€‚ ç›®æ ‡ï¼šå•æ¬¡åŸºå‡† â‰¥ 1â€¯sï¼ˆå¯é€šè¿‡ -benchtime è°ƒæ•´ï¼‰ï¼Œå…¼é¡¾ç»Ÿè®¡æ˜¾è‘—æ€§ä¸æ€»æ—¶é•¿ã€‚ ç²¾å‡†è®¡æ—¶\né»˜è®¤è®¡æ—¶æ•´ä¸ªåŸºå‡†å‡½æ•°ï¼›è°ƒç”¨ StopTimer åæš‚åœï¼ŒStartTimer æ¢å¤ã€‚ ä»»ä½• GCã€ç³»ç»Ÿè°ƒç”¨ä¹Ÿè¢«è®¡å…¥ï¼›é¿å…åœ¨è®¡æ—¶åŒºå†…æ‰§è¡Œ I/Oã€ç½‘ç»œç­‰æ“ä½œã€‚ ç»“æœè¾“å‡º\nç¤ºä¾‹ï¼š\nBenchmarkNaive-8 1234567 100.0 ns/op -benchmem è¿½åŠ æ¯æ¬¡è¿­ä»£çš„åˆ†é…å­—èŠ‚æ•°ä¸æ¬¡æ•°ã€‚è‹¥è°ƒç”¨ SetBytes(n)ï¼Œè¿˜ä¼šæ˜¾ç¤º MB/sã€‚\nå¹¶è¡Œæ¨¡å¼\nb.RunParallel(func(pb *testing.PB){ â€¦ }) ä¼šæ ¹æ® GOMAXPROCS å¯åŠ¨å¤š goroutineï¼Œå¹¶é€šè¿‡ pb.Next() æ§åˆ¶å¾ªç¯ã€‚\n3 â€” å¦‚ä½•ä¹¦å†™ \u0026amp; è¿è¡ŒåŸºå‡† # // concat_test.go package concat import ( \u0026#34;strings\u0026#34; \u0026#34;testing\u0026#34; ) func naive(s1, s2 string) string { return s1 + s2 } func buffered(s1, s2 string) string { var buf strings.Builder buf.WriteString(s1) buf.WriteString(s2) return buf.String() } func BenchmarkNaive(b *testing.B) { s1, s2 := \u0026#34;foo\u0026#34;, \u0026#34;bar\u0026#34; for i := 0; i \u0026lt; b.N; i++ { _ = naive(s1, s2) } } func BenchmarkBuffered(b *testing.B) { s1, s2 := \u0026#34;foo\u0026#34;, \u0026#34;bar\u0026#34; b.ReportAllocs() for i := 0; i \u0026lt; b.N; i++ { _ = buffered(s1, s2) } } 3.1 è¿è¡Œå‘½ä»¤ # # ä»…è·‘åŸºå‡†ï¼ˆè·³è¿‡å•å…ƒæµ‹è¯•ï¼‰ go test -run=^$ -bench=. ./... # æŸ¥çœ‹å†…å­˜åˆ†é… go test -run=^$ -bench=. -benchmem ./... # è‡ªå®šä¹‰æŒç»­æ—¶é—´ï¼ˆè‡³å°‘ 3â€¯sï¼‰ go test -run=^$ -bench=. -benchtime=3s ./... # ç”Ÿæˆ CPU / å†…å­˜å‰–é¢ go test -run=^$ -bench=. -cpuprofile cpu.out -memprofile mem.out go tool pprof cpu.out 4 â€” å¸¸ç”¨æŠ€å·§ä¸å‘ # åšæ³• ç†ç”± å°†å‡†å¤‡å·¥ä½œæ”¾åœ¨å¾ªç¯å¤–æˆ–ä½¿ç”¨ StopTimer/StartTimer é¿å…æŠŠéæ ¸å¿ƒé€»è¾‘è®¡å…¥åŸºå‡†æ—¶é—´ ä½¿ç”¨ç»“æœå˜é‡ï¼ˆå¦‚ var sink anyï¼‰ é˜²æ­¢ç¼–è¯‘å™¨æ­»ä»£ç æ¶ˆé™¤ (DCE) å›ºå®šè¾“å…¥è§„æ¨¡ æé«˜å¯é‡å¤æ€§ï¼›å¤šè§„æ¨¡å¯ç”¨ b.Run æ³¨æ„å…±äº«çŠ¶æ€ \u0026amp; GC å…±äº« mapã€éšæœºæ•°ç§å­ç­‰ä¼šæ”¾å¤§å™ªå£° åœ¨å®ä½“æœºä¸Šè¿è¡Œ VMã€ç¬”è®°æœ¬çœç”µæ¨¡å¼å¯èƒ½æŠ–åŠ¨ ç»“åˆ go test -count=N å¤šæ¬¡è¿è¡Œå–å¹³å‡/ä¸­ä½æé«˜ç½®ä¿¡åº¦ 5 â€” è¿›é˜¶èƒ½åŠ› # 5.1 å­åŸºå‡† # func BenchmarkSizes(b *testing.B) { for _, size := range []int{1 \u0026lt;\u0026lt; 10, 1 \u0026lt;\u0026lt; 20, 1 \u0026lt;\u0026lt; 24} { b.Run(fmt.Sprintf(\u0026#34;%dB\u0026#34;, size), func(b *testing.B) { data := make([]byte, size) for i := 0; i \u0026lt; b.N; i++ { _ = hash(data) } }) } } 5.2 å¹¶è¡Œååæµ‹è¯• # func BenchmarkPool(b *testing.B) { pool := sync.Pool{New: func() any { return make([]byte, 1024) }} b.RunParallel(func(pb *testing.PB) { for pb.Next() { buf := pool.Get().([]byte) // ... ä½¿ç”¨ buf ... pool.Put(buf) } }) } 5.3 ç»“æœå¯è§†åŒ– # ä½¿ç”¨å®˜æ–¹å·¥å…· benchstat / benchcmp å¯¹æ¯”ä¸¤æ¬¡åŸºå‡†å·®å¼‚ï¼š\ngo test -bench=. \u0026gt; old.txt # ä¿®æ”¹ä»£ç â€¦ go test -bench=. \u0026gt; new.txt benchstat old.txt new.txt 6 â€” å°ç»“ # åŸºå‡†æµ‹è¯•é›†æˆäº testing åŒ…ï¼Œæ— éœ€é¢å¤–ä¾èµ–ã€‚ æŠŠ çœŸæ­£æ¬²æµ‹çš„è¯­å¥ æ”¾è¿› for i \u0026lt; b.Nï¼›å…¶ä½™é€»è¾‘ç”¨ StopTimer éš”ç¦»ã€‚ -benchmemã€pprof ä¸ benchstat å¯å¸®åŠ©ä½ å®šä½ç“¶é¢ˆä¸åˆ†é…çƒ­ç‚¹ã€‚ åŸºå‡† â‰  å‹æµ‹ï¼šå®ƒå…³æ³¨å¾®è§‚æ€§èƒ½ï¼›ç³»ç»Ÿçº§è´Ÿè½½éœ€å¦è¡Œå‹æµ‹ã€‚ "},{"id":2,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/develop/client-go/informer/deltafifo/","title":"DeltaFIFO","section":"informer","content":" DeltaFIFO # "},{"id":3,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/metrics/prometheus/develop/","title":"develop","section":"prometheus","content":" prometheus æºç è§£è¯» # "},{"id":4,"href":"/docs/go/","title":"Go","section":"æ–‡æ¡£é¦–é¡µ","content":"æœ¬ç« èŠ‚ä»‹ç» Go çš„åŸºæœ¬ä½¿ç”¨ã€‚\n"},{"id":5,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/operate/install/","title":"install","section":"operate","content":"æ¬¢è¿ä½¿ç”¨kubernetes\n"},{"id":6,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/metrics/prometheus/operator/install/","title":"install","section":"operator","content":" prometheus æºç è§£è¯» # "},{"id":7,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/operate/install/kubernetes/","title":"kubernetes","section":"install","content":" éƒ¨ç½²å‰å‡†å¤‡ # ä¿®æ”¹æœºå™¨å hostnamectl set-hostname master å…³é—­swap swapoff -a sed -i \u0026#39;/swap / s/^\\(.*\\)$/#\\1/g\u0026#39; /etc/fstab free -m # æ£€æŸ¥æ˜¯å¦å…³é—­swap sshå…è®¸Root ç™»é™† vim /etc/ssh/sshd_config å¢åŠ  Port 22 PermitRootLogin yes passwd # è®¾ç½®root å¯†ç  å…³é—­é˜²ç«å¢™ sudo ufw disable ä¿®æ”¹apt æºåœ°å€ cp /etc/apt/sources.list /etc/apt/sources.list.bak # ä½¿ç”¨vim æ›¿æ¢/etc/apt/sources.listä¸­çš„èµ„æºåœ°å€ vim /etc/apt/sources.list deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse # æ›´æ–° vim /etc/resolv.conf # æ·»åŠ ä¸€ä¸‹ä¸¤è¡Œ nameserver 8.8.8.8 nameserver 8.8.4.4 apt-get update æ·»åŠ  Kubernetes apt å­˜å‚¨åº“ sudo tee /etc/apt/sources.list.d/kubernetes.list \u0026lt;\u0026lt;-\u0026#39;EOF\u0026#39; deb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main EOF apt-get update The following signatures couldn\u0026#39;t be verified because the public key is not available: NO_PUBKEY B53DC80D13EDEF05 NO_PUBKEY FEEA9169307EA071 # å¦‚æœæŠ¥é”™ä»¥ä¸Šé”™è¯¯ï¼Œæ‰§è¡Œä¸‹é¢ä¸€æ¡å‘½ä»¤ recv-keys æ˜¯æŠ¥é”™ç°å®çš„NO_PUBKEY sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys FEEA9169307EA071 å®‰è£…kubectl kubeadm kubelet sudo apt-get install -y kubelet=1.22.2-00 kubeadm=1.22.2-00 kubectl=1.22.2-00 å®‰è£…docker apt-get install -y docker.io systemctl enable docker master # å®‰è£…master èŠ‚ç‚¹ kubeadm init \\ --apiserver-advertise-address=192.168.31.239 \\ --image-repository registry.aliyuncs.com/google_containers \\ --kubernetes-version v1.32.3 \\ --service-cidr=10.96.0.0/12 \\ --pod-network-cidr=10.244.0.0/16 node # å®‰è£…node èŠ‚ç‚¹ kubeadm join 192.168.31.208:6443 --token u1soc8.1xyeqbzptpvvjz8f --discovery-token-ca-cert-hash sha256:3406b992b2c05f27b398a81375082a72aa2a823fd82616e4f8cb6f2a24370bb3 # kubeadm init åˆå§‹åŒ–å®Œæˆä¼šæ‰“å°åˆ°console ä¸Š # å¯ä»¥é€šè¿‡ kubeadm token create --print-join-command æŸ¥çœ‹ "},{"id":8,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/","title":"Kubernetes","section":"äº‘åŸç”Ÿ","content":"kubernetes æ¶æ„å›¾\nGroupã€Versionã€Resource æ ¸å¿ƒæ•°æ®ç»“æ„ # æ•´ä¸ªKubernetes ä½“ç³»æ¶æ„ä¸­ï¼Œèµ„æºæ˜¯Kubernetesæœ€é‡è¦çš„æ¦‚å¿µï¼Œå¯ä»¥è¯´Kubernetsçš„ç”Ÿæ€ç³»ç»Ÿéƒ½å›´ç»•ç€èµ„æºè¿ä½œã€‚\nKubernetesç³»ç»Ÿè™½ç„¶æœ‰ç›¸å½“å¤æ‚å’Œä¼—å¤šçš„åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªèµ„æºæ§åˆ¶ç³»ç»Ÿâ€”â€”æ³¨å†Œã€ç®¡ç†ã€è°ƒåº¦èµ„æºå¹¶ç»´æŠ¤èµ„æºçš„çŠ¶æ€\nKubernetes å°†èµ„æºåˆ†ç»„å’Œç‰ˆæœ¬åŒ–ï¼Œå½¢æˆGroupï¼ˆèµ„æºç»„ï¼‰ã€Versionï¼ˆèµ„æºç‰ˆæœ¬ï¼‰ã€Resourceï¼ˆèµ„æºï¼‰\nGroupï¼šèµ„æºç»„ï¼Œåœ¨Kubernetes API Server ä¸­ä¹Ÿå¯ç§°å…¶ä¸ºAPIGroup Versionï¼šèµ„æºç‰ˆæœ¬ï¼Œåœ¨Kubernets API Server ä¸­ä¹Ÿå¯ç§°å…¶ä¸ºAPIVersions Resourceï¼šèµ„æºï¼Œåœ¨Kubernetes API Server ä¸­ä¹Ÿå¯ç§°å…¶ä¸ºAPIResource Kindï¼šèµ„æºç§ç±»ï¼Œæè¿°Resource çš„ç§ç±»ï¼Œä¸Resourceä¸ºåŒä¸€çº§åˆ« Kubernetes ç³»ç»Ÿæ”¯æŒå¤šä¸ªGroupã€‚æ¯ä¸ªGroupæ”¯æŒå¤šä¸ªVersionï¼Œæ¯ä¸ªVersionæ”¯æŒå¤šä¸ªResourceï¼ŒåŒæ—¶éƒ¨åˆ†èµ„æºä¼šæ‹¥æœ‰è‡ªå·±çš„å­èµ„æº\nèµ„æºç»„ã€èµ„æºç‰ˆæœ¬ã€èµ„æºã€å­èµ„æºçš„å®Œæ•´è¡¨è¾¾å½¢å¼ä¸º\u0026lt;group\u0026gt;/\u0026lt;version\u0026gt;/\u0026lt;resource\u0026gt;/\u0026lt;status\u0026gt;,ä»¥å¸¸ç”¨çš„Deploymentèµ„æºä¸ºä¾‹ï¼Œå…¶å®Œæ•´è¡¨ç°å½¢å¼ä¸ºapps/v1/deployments/status\nèµ„æºå¯¹è±¡ç”± èµ„æºç»„ + èµ„æºç‰ˆæœ¬ + èµ„æºç§ç±»ç»„æˆï¼Œä¾‹å¦‚Deployment èµ„æºæ˜¯å®ä¾‹åŒ–åæ‹¥æœ‰èµ„æºç»„ã€èµ„æºç‰ˆæœ¬åŠèµ„æºç§ç±»ï¼Œå…¶è¡¨ç°å½¢å¼ä¸º/,Kind=,ä¾‹å¦‚apps/v1ï¼ŒKind= Deployment\næ¯ä¸€ä¸ªèµ„æºéƒ½æ‹¥æœ‰ä¸€å®šæ•°é‡çš„èµ„æºæ“ä½œæ–¹æ³•ï¼ˆå³Verbsï¼‰ï¼Œèµ„æºæ“ä½œæ–¹æ³•ç”¨äºEtcdé›†ç¾¤å­˜å‚¨ä¸­å¯¹èµ„æºå¯¹è±¡çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œã€‚ç›®å‰Kubernetesç³»ç»Ÿæ”¯æŒ8ç§èµ„æºæ“ä½œæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watchæ“ä½œæ–¹æ³•\n"},{"id":9,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/metrics/prometheus/operator/install/kubernetes-services/","title":"kubernetes service","section":"install","content":"scrape_configs: - job_name: \u0026#39;kubernetes-pods\u0026#39; kubernetes_sd_configs: - role: pod relabel_configs: # æå– annotation ä¸­çš„ metrics_path - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path] action: replace target_label: __metrics_path__ # æå– annotation ä¸­çš„ scrape interval - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape_interval] action: replace target_label: scrape_interval # æå– annotation ä¸­çš„ scrape timeout - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape_timeout] action: replace target_label: scrape_timeout # é€šè¿‡ annotation è®¾ç½®æ˜¯å¦å¯ç”¨ scrape - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape] action: keep regex: \u0026#34;true\u0026#34; # æå– annotation ä¸­çš„ metrics ç«¯å£ - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_port] action: replace target_label: __address__ regex: (.+) replacement: $1 apiVersion: v1 kind: Pod metadata: name: example-app annotations: prometheus.io/scrape: \u0026#34;true\u0026#34; prometheus.io/path: \u0026#34;/metrics\u0026#34; prometheus.io/port: \u0026#34;8080\u0026#34; prometheus.io/scrape_interval: \u0026#34;15s\u0026#34; prometheus.io/scrape_timeout: \u0026#34;10s\u0026#34; spec: containers: - name: example image: example-app ports: - containerPort: 8080 "},{"id":10,"href":"/docs/%E7%AE%97%E6%B3%95/%E5%9B%9E%E6%BA%AF/1.-n-%E7%9A%87%E5%90%8E/","title":"N çš‡å","section":"å›æº¯","content":" N çš‡å # leetcode 51\næŒ‰ç…§å›½é™…è±¡æ£‹çš„è§„åˆ™ï¼Œçš‡åå¯ä»¥æ”»å‡»ä¸ä¹‹å¤„åœ¨åŒä¸€è¡Œæˆ–åŒä¸€åˆ—æˆ–åŒä¸€æ–œçº¿ä¸Šçš„æ£‹å­ã€‚\nn çš‡åé—®é¢˜ ç ”ç©¶çš„æ˜¯å¦‚ä½•å°† n ä¸ªçš‡åæ”¾ç½®åœ¨ nÃ—n çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»ã€‚\nç»™ä½ ä¸€ä¸ªæ•´æ•° n ï¼Œè¿”å›æ‰€æœ‰ä¸åŒçš„ n çš‡åé—®é¢˜ çš„è§£å†³æ–¹æ¡ˆã€‚\næ¯ä¸€ç§è§£æ³•åŒ…å«ä¸€ä¸ªä¸åŒçš„ n çš‡åé—®é¢˜ çš„æ£‹å­æ”¾ç½®æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆä¸­ \u0026lsquo;Q\u0026rsquo; å’Œ \u0026lsquo;.\u0026rsquo; åˆ†åˆ«ä»£è¡¨äº†çš‡åå’Œç©ºä½ã€‚\nç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼šn = 4\nè¾“å‡ºï¼š[[\u0026quot;.Q..\u0026quot;,\u0026quot;\u0026hellip;Q\u0026quot;,\u0026ldquo;Q\u0026hellip;\u0026rdquo;,\u0026quot;..Q.\u0026quot;],[\u0026quot;..Q.\u0026quot;,\u0026ldquo;Q\u0026hellip;\u0026rdquo;,\u0026quot;\u0026hellip;Q\u0026quot;,\u0026quot;.Q..\u0026quot;]]\nè§£é‡Šï¼šå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ4 çš‡åé—®é¢˜å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„è§£æ³•ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šn = 1\nè¾“å‡ºï¼š[[\u0026ldquo;Q\u0026rdquo;]]\nfunc solveNQueens(n int) [][]string { var result [][]string board := make([][]rune, n) for i := range board{ board[i] = make([]rune, n) for j := range board[i]{ board[i][j] = \u0026#39;.\u0026#39; } } var dfs func(row int, cols, diag1, diag2 map[int]bool) dfs = func(row int, cols, diag1, diag2 map[int]bool){ if row == n{ var solution []string for _, r := range board{ solution = append(solution, string(r)) } result = append(result, solution) return } for col := 0; col \u0026lt; n; col ++{ if cols[col] || diag1[row-col] || diag2[row+col]{ continue } board[row][col] = \u0026#39;Q\u0026#39; cols[col], diag1[row-col], diag2[col + row] = true, true, true dfs(row + 1, cols, diag1, diag2) board[row][col] = \u0026#39;.\u0026#39; delete(cols, col) delete(diag1, row -col) delete(diag2, row + col) } } dfs(0, make(map[int]bool), make(map[int]bool), make(map[int]bool)) return result } "},{"id":11,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/metrics/prometheus/operator/","title":"operator","section":"prometheus","content":" prometheus æºç è§£è¯» # "},{"id":12,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-cd/plan/","title":"plan","section":"argo cd","content":" ğŸ“˜ Argo CD å­¦ä¹ è®¡åˆ’ - ç¬¬ 2 å‘¨ # ğŸ¯ å­¦ä¹ ç›®æ ‡ # ç†è§£ Argo CD çš„æ ¸å¿ƒæ¶æ„ä¸ GitOps åŸç†ã€‚ èƒ½å¤Ÿç‹¬ç«‹å®‰è£… Argo CD å¹¶è¿æ¥ Git ä»“åº“éƒ¨ç½² Kubernetes åº”ç”¨ã€‚ æŒæ¡åŒæ­¥ç­–ç•¥ã€çŠ¶æ€ç®¡ç†ã€RBAC å’Œå¤šç¯å¢ƒéƒ¨ç½²æŠ€å·§ã€‚ ğŸ“… æ¯æ—¥ä»»åŠ¡å®‰æ’ # âœ… å‘¨ä¸€ï¼šArgo CD æ¦‚è¿°ä¸æ¶æ„ # å­¦ä¹ å†…å®¹ï¼š\nä»€ä¹ˆæ˜¯ GitOpsï¼Ÿä¸ CI/CD çš„åŒºåˆ« Argo CD æ¶æ„å›¾ï¼šAPI Serverã€Repository Serverã€Application Controllerã€UI æ”¯æŒçš„ Git ç±»å‹ï¼ˆGitHubã€GitLabï¼‰ã€Helm/Kustomize æ”¯æŒ å‚è€ƒèµ„æ–™ï¼š\nå®˜æ–¹æ–‡æ¡£ï¼šhttps://argo-cd.readthedocs.io/ æ¶æ„å›¾å‚è€ƒï¼š âœ… å‘¨äºŒï¼šå®‰è£… Argo CD # å®‰è£…å‘½ä»¤ï¼ˆåœ¨æ–°é›†ç¾¤æˆ–åŒé›†ç¾¤ namespace åŒºåˆ†ï¼‰ï¼š\nkubectl create namespace argocd kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml è®¿é—® UIï¼ˆç«¯å£è½¬å‘ï¼‰ï¼š\nkubectl port-forward svc/argocd-server -n argocd 8080:443 è·å–åˆå§‹ admin å¯†ç ï¼š\nkubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\u0026#34;{.data.password}\u0026#34; | base64 -d è®¿é—®åœ°å€ï¼š https://localhost:8080\nâœ… å‘¨ä¸‰ï¼šéƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨ # ç¤ºä¾‹ Git ä»“åº“ï¼šhttps://github.com/argoproj/argocd-example-apps\nä½¿ç”¨ CLI åˆ›å»º appï¼š\nargocd login localhost:8080 argocd app create guestbook --repo https://github.com/argoproj/argocd-example-apps --path guestbook --dest-server https://kubernetes.default.svc --dest-namespace default åŒæ­¥åº”ç”¨ï¼š\nargocd app sync guestbook UI æŸ¥çœ‹çŠ¶æ€ï¼šåŒæ­¥çŠ¶æ€ã€å¥åº·çŠ¶æ€\nâœ… å‘¨å››ï¼šåŒæ­¥ç­–ç•¥ä¸å¥åº·æ£€æŸ¥ # æ‰‹åŠ¨åŒæ­¥ vs è‡ªåŠ¨åŒæ­¥\nsyncPolicy ç¤ºä¾‹ï¼š\nsyncPolicy: automated: prune: true selfHeal: true Hook ä¸ç”Ÿå‘½å‘¨æœŸæ“ä½œï¼ˆpre-sync, post-sync ç­‰ï¼‰\næŸ¥çœ‹çŠ¶æ€ï¼š\nargocd app get guestbook âœ… å‘¨äº”ï¼šRBAC ä¸å¤šç¯å¢ƒç®¡ç† # é…ç½®ç”¨æˆ·æƒé™ï¼šä½¿ç”¨ argocd-rbac-cm é…ç½® mapRoles\nç¤ºä¾‹ï¼šåªè¯»ç”¨æˆ·ã€admin ç”¨æˆ·\nå¤šç¯å¢ƒæ”¯æŒï¼šä½¿ç”¨ Git åˆ†æ”¯ã€Kustomize æˆ– Helm value åˆ†æ–‡ä»¶å¤¹åˆ†ç¯å¢ƒ\nUI å¤šé¡¹ç›®é…ç½®ï¼šProject ç®¡ç†ã€é™åˆ¶ç›®æ ‡ namespace\nğŸ“ æ€»ç»“å»ºè®® # æ¯å¤©å®Œæˆæ“ä½œæˆªå›¾è®°å½•ã€UI çŠ¶æ€è®°å½•ã€‚ æ€è€ƒ Argo CD åœ¨å®é™…å·¥ä½œä¸­å¦‚ä½•å¯¹æ¥ä½ çš„é¡¹ç›®ã€‚ å¯å°è¯•å°†ä¸¤ä¸ªä¸åŒ Git ä»“åº“åº”ç”¨é…ç½®åˆ°åŒä¸€ Argo CD ç®¡ç†ä¸­ã€‚ "},{"id":13,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-workflow/plan/","title":"plan","section":"argo workflow","content":" ğŸ“˜ Argo Workflows å­¦ä¹ è®¡åˆ’ - ç¬¬ 1 å‘¨ # ğŸ¯ å­¦ä¹ ç›®æ ‡ # ç†è§£ Argo Workflows çš„åŸºæœ¬æ¦‚å¿µã€æ¶æ„å’Œç»„ä»¶ã€‚ èƒ½å¤Ÿåœ¨æœ¬åœ°æˆ– Kubernetes é›†ç¾¤ä¸­å®‰è£…å¹¶è¿è¡Œ Workflowsã€‚ æŒæ¡ç¼–å†™åŸºç¡€ Workflow YAML çš„èƒ½åŠ›ï¼Œäº†è§£å‚æ•°åŒ–ã€æ¨¡æ¿å¤ç”¨åŠå®šæ—¶è°ƒåº¦ä»»åŠ¡ï¼ˆCronWorkflowï¼‰ã€‚ ğŸ“… æ¯æ—¥ä»»åŠ¡å®‰æ’ # âœ… å‘¨ä¸€ï¼šWorkflows æ¦‚è¿°ä¸æ¶æ„ # å­¦ä¹ å†…å®¹ï¼š\nArgo Workflows æ˜¯ä»€ä¹ˆï¼Ÿè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ å·¥ä½œæµçš„åŸºæœ¬æœ¯è¯­ï¼ˆæ¨¡æ¿ã€æ­¥éª¤ã€å‚æ•°ç­‰ï¼‰ æ¶æ„ç»„ä»¶ï¼šWorkflow Controllerã€UI Serverã€CRD èµ„æ–™ï¼š\nå®˜æ–¹æ–‡æ¡£ï¼šhttps://argoproj.github.io/argo-workflows/ æ¶æ„å›¾å‚è€ƒï¼š âœ… å‘¨äºŒï¼šå®‰è£… Argo Workflows # æ“ä½œæ­¥éª¤ï¼š\nkubectl create namespace argo kubectl apply -n argo -f https://raw.githubusercontent.com/argoproj/argo-workflows/stable/manifests/install.yaml kubectl -n argo port-forward deployment/argo-server 2746:2746 è®¿é—® UIï¼šhttp://localhost:2746\néªŒè¯å®‰è£…ï¼š\nkubectl get pods -n argo âœ… å‘¨ä¸‰ï¼šåˆ›å»ºç¬¬ä¸€ä¸ª Workflow # ç¤ºä¾‹ YAMLï¼š\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: hello-world- spec: entrypoint: whalesay templates: - name: whalesay container: image: docker/whalesay command: [cowsay] args: [\u0026#34;hello world\u0026#34;] æäº¤å‘½ä»¤ï¼š\nkubectl create -f hello-world.yaml -n argo æŸ¥çœ‹æ‰§è¡Œï¼šArgo UI æˆ– kubectl get wf -n argo\nâœ… å‘¨å››ï¼šå‚æ•°ä¸æ¨¡æ¿å¤ç”¨ # ä½¿ç”¨å‚æ•°ï¼š\nargs: parameters: - name: message value: \u0026#34;Hello Argo\u0026#34; æ¨¡æ¿å¤ç”¨ï¼šå®šä¹‰å¤šä¸ªæ¨¡æ¿å¹¶é€šè¿‡ steps å¼•ç”¨\nç¤ºä¾‹é¡¹ç›®ï¼šhttps://github.com/argoproj/argo-workflows/tree/master/examples\nâœ… å‘¨äº”ï¼šå®šæ—¶ä»»åŠ¡ï¼ˆCronWorkflowï¼‰ # ç¤ºä¾‹ YAMLï¼š\napiVersion: argoproj.io/v1alpha1 kind: CronWorkflow metadata: name: hello-cron spec: schedule: \u0026#34;*/5 * * * *\u0026#34; workflowSpec: entrypoint: whalesay templates: - name: whalesay container: image: docker/whalesay command: [cowsay] args: [\u0026#34;Hello from cron!\u0026#34;] æäº¤å‘½ä»¤ï¼š\nkubectl create -f cron-workflow.yaml -n argo éªŒè¯å‘½ä»¤ï¼škubectl get cronworkflow -n argo\nğŸ“ æ€»ç»“å»ºè®® # æ¯æ™šå®Œæˆæ“ä½œè®°å½•ä¸€ä»½è¿è¡Œæˆªå›¾æˆ– UI æˆªå›¾ã€‚ ç¬”è®°è®°å½•é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•ã€‚ å¯å°è¯•å°† Workflow ä¸å…¶ä»–å®¹å™¨ä»»åŠ¡ç»„åˆæˆå¤šæ­¥éª¤æµç¨‹ã€‚ "},{"id":14,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/plan/","title":"plan","section":"Argo","content":" Argo å…¨å®¶æ¡¶å­¦ä¹ è®¡åˆ’ ğŸ“˜ï¼ˆ4 å‘¨ï¼‰ # ğŸ‘¤ åŸºç¡€æƒ…å†µ # èµ·å§‹æ—¥æœŸï¼š2025-05-** å­¦ä¹ ç›®æ ‡ï¼šæŒæ¡ Argo Workflowsã€CDã€Rolloutsã€Eventsï¼Œå…·å¤‡ GitOps å®è·µèƒ½åŠ› æ¯å¤©å­¦ä¹ æ—¶é—´ï¼šå·¥ä½œæ—¥æ™šä¸Š 7:30 ~ 9:15ï¼Œå‘¨æœ«å¯è¡¥å…… èƒŒæ™¯ï¼šå…·å¤‡ Kubernetes åŸºç¡€ âœ… å­¦ä¹ è¿›åº¦ä¸€è§ˆ # å‘¨æ¬¡ ä¸»é¢˜ çŠ¶æ€ ç¬¬ 1 å‘¨ Argo Workflows â˜ æœªå¼€å§‹ / âœ… å®Œæˆ ç¬¬ 2 å‘¨ Argo CD â˜ æœªå¼€å§‹ / âœ… å®Œæˆ ç¬¬ 3 å‘¨ Argo Rollouts \u0026amp; Events â˜ æœªå¼€å§‹ / âœ… å®Œæˆ ç¬¬ 4 å‘¨ ç»¼åˆå®æˆ˜ä¸ä¼˜åŒ– â˜ æœªå¼€å§‹ / âœ… å®Œæˆ ğŸ—“ æ¯å‘¨å­¦ä¹ å®‰æ’ # ğŸ“– ç¬¬ 1 å‘¨ï¼šArgo Workflows # æ—¥æœŸ å†…å®¹ çŠ¶æ€ ç¬”è®°é“¾æ¥ å‘¨ä¸€ Workflows æ¦‚è¿°ä¸æ¶æ„ â˜ å‘¨äºŒ å®‰è£… Argo Workflows â˜ å‘¨ä¸‰ ç¼–å†™ç¬¬ä¸€ä¸ª Workflow â˜ å‘¨å›› å‚æ•°åŒ–ä¸æ¨¡æ¿å¤ç”¨ â˜ å‘¨äº” CronWorkflow ä¸è°ƒåº¦ â˜ ğŸ“– ç¬¬ 2 å‘¨ï¼šArgo CD # æ—¥æœŸ å†…å®¹ çŠ¶æ€ ç¬”è®°é“¾æ¥ å‘¨ä¸€ Argo CD æ¶æ„ä¸ GitOps ç†è§£ â˜ å‘¨äºŒ å®‰è£…ä¸é…ç½® Argo CD â˜ å‘¨ä¸‰ GitOps åº”ç”¨éƒ¨ç½²å®è·µ â˜ å‘¨å›› åŒæ­¥ç­–ç•¥ä¸å¥åº·æ£€æŸ¥ â˜ å‘¨äº” RBAC ä¸å¤šç¯å¢ƒæ”¯æŒ â˜ ğŸ“– ç¬¬ 3 å‘¨ï¼šArgo Rollouts \u0026amp; Events # æ—¥æœŸ å†…å®¹ çŠ¶æ€ ç¬”è®°é“¾æ¥ å‘¨ä¸€ Rollouts æ¦‚è¿°ä¸ç­–ç•¥å¯¹æ¯” â˜ å‘¨äºŒ è“ç»¿å‘å¸ƒå®è·µ â˜ å‘¨ä¸‰ é‡‘ä¸é›€å‘å¸ƒ + æŒ‡æ ‡åˆ†æ â˜ å‘¨å›› Argo Events ç»“æ„ç†è§£ â˜ å‘¨äº” å®æˆ˜ï¼šWebhook/File/Kafka è§¦å‘ Workflow â˜ ğŸ“– ç¬¬ 4 å‘¨ï¼šç»¼åˆå®è·µ # æ—¥æœŸ å†…å®¹ çŠ¶æ€ ç¬”è®°é“¾æ¥ å‘¨ä¸€ æ•´ä½“è”åŠ¨æµç¨‹æ„å»º â˜ å‘¨äºŒ æ¨¡æ‹Ÿ CI/CD æµç¨‹ â˜ å‘¨ä¸‰ å®‰å…¨æ€§ \u0026amp; æƒé™ç®¡ç† â˜ å‘¨å›› æ€§èƒ½ä¼˜åŒ– \u0026amp; æŒ‡æ ‡ç›‘æ§ â˜ å‘¨äº” é¡¹ç›®æ¼”ç»ƒæ€»ç»“ \u0026amp; æ–‡æ¡£è¾“å‡º â˜ ğŸ“ æ¯æ—¥ç¬”è®°æ¨¡æ¿ï¼ˆå¯å¤åˆ¶å¤šä»½ä½¿ç”¨ï¼‰ # ### ğŸ“… æ—¥æœŸï¼š2025-05-xx #### ğŸ“š ä»Šæ—¥å­¦ä¹ å†…å®¹ - [ ] ä¸»é¢˜ï¼š - [ ] ç›®æ ‡ï¼š - [ ] æ“ä½œè®°å½•ï¼š - [ ] æŠ¥é”™ \u0026amp; è§£å†³æ–¹æ¡ˆï¼š #### ğŸ§  ä»Šæ—¥æ€»ç»“ - æ”¶è·ï¼š - ç–‘é—®ï¼š #### ğŸ§° æ˜æ—¥è®¡åˆ’ - [ ] ... "},{"id":15,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/metrics/prometheus/","title":"prometheus","section":"metrics","content":"prometheus æ¶æ„å›¾\n"},{"id":16,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/metrics/prometheus/operator/install/prometheus/","title":"prometheus","section":"install","content":" prometheus çš„å®‰è£… # ä½¿ç”¨ kube-prometheus å®‰è£…\nç»„ä»¶ # prometheus-adpter prometheus-operator alertmanager blackbox-exporter grafana prometheus kube-state-metrics node-exporter kubernetetsControllerPlan "},{"id":17,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/metrics/prometheus/develop/source-code/","title":"prometheus source code","section":"develop","content":" æ¨¡å—åˆ—è¡¨ # discoveryManagerScrape æœåŠ¡å‘ç° scrapeManager queryEngine ruleManager discoveryManagerNotify notifierManager tracingManager "},{"id":18,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/develop/reources/","title":"resources","section":"develop","content":" Groupã€Versionã€Resource æ ¸å¿ƒæ•°æ®ç»“æ„ # æ•´ä¸ªKubernetes ä½“ç³»æ¶æ„ä¸­ï¼Œèµ„æºæ˜¯Kubernetesæœ€é‡è¦çš„æ¦‚å¿µï¼Œå¯ä»¥è¯´Kubernetsçš„ç”Ÿæ€ç³»ç»Ÿéƒ½å›´ç»•ç€èµ„æºè¿ä½œã€‚\nKubernetesç³»ç»Ÿè™½ç„¶æœ‰ç›¸å½“å¤æ‚å’Œä¼—å¤šçš„åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªèµ„æºæ§åˆ¶ç³»ç»Ÿâ€”â€”æ³¨å†Œã€ç®¡ç†ã€è°ƒåº¦èµ„æºå¹¶ç»´æŠ¤èµ„æºçš„çŠ¶æ€\nKubernetes å°†èµ„æºåˆ†ç»„å’Œç‰ˆæœ¬åŒ–ï¼Œå½¢æˆGroupï¼ˆèµ„æºç»„ï¼‰ã€Versionï¼ˆèµ„æºç‰ˆæœ¬ï¼‰ã€Resourceï¼ˆèµ„æºï¼‰\nGroupï¼šèµ„æºç»„ï¼Œåœ¨Kubernetes API Server ä¸­ä¹Ÿå¯ç§°å…¶ä¸ºAPIGroup Versionï¼šèµ„æºç‰ˆæœ¬ï¼Œåœ¨Kubernets API Server ä¸­ä¹Ÿå¯ç§°å…¶ä¸ºAPIVersions Resourceï¼šèµ„æºï¼Œåœ¨Kubernetes API Server ä¸­ä¹Ÿå¯ç§°å…¶ä¸ºAPIResource Kindï¼šèµ„æºç§ç±»ï¼Œæè¿°Resource çš„ç§ç±»ï¼Œä¸Resourceä¸ºåŒä¸€çº§åˆ« Kubernetes ç³»ç»Ÿæ”¯æŒå¤šä¸ªGroupã€‚æ¯ä¸ªGroupæ”¯æŒå¤šä¸ªVersionï¼Œæ¯ä¸ªVersionæ”¯æŒå¤šä¸ªResourceï¼ŒåŒæ—¶éƒ¨åˆ†èµ„æºä¼šæ‹¥æœ‰è‡ªå·±çš„å­èµ„æº\nèµ„æºç»„ã€èµ„æºç‰ˆæœ¬ã€èµ„æºã€å­èµ„æºçš„å®Œæ•´è¡¨è¾¾å½¢å¼ä¸º\u0026lt;group\u0026gt;/\u0026lt;version\u0026gt;/\u0026lt;resource\u0026gt;/\u0026lt;status\u0026gt;,ä»¥å¸¸ç”¨çš„Deploymentèµ„æºä¸ºä¾‹ï¼Œå…¶å®Œæ•´è¡¨ç°å½¢å¼ä¸ºapps/v1/deployments/status\nèµ„æºå¯¹è±¡ç”± èµ„æºç»„ + èµ„æºç‰ˆæœ¬ + èµ„æºç§ç±»ç»„æˆï¼Œä¾‹å¦‚Deployment èµ„æºæ˜¯å®ä¾‹åŒ–åæ‹¥æœ‰èµ„æºç»„ã€èµ„æºç‰ˆæœ¬åŠèµ„æºç§ç±»ï¼Œå…¶è¡¨ç°å½¢å¼ä¸º/,Kind=,ä¾‹å¦‚apps/v1ï¼ŒKind= Deployment\næ¯ä¸€ä¸ªèµ„æºéƒ½æ‹¥æœ‰ä¸€å®šæ•°é‡çš„èµ„æºæ“ä½œæ–¹æ³•ï¼ˆå³Verbsï¼‰ï¼Œèµ„æºæ“ä½œæ–¹æ³•ç”¨äºEtcdé›†ç¾¤å­˜å‚¨ä¸­å¯¹èµ„æºå¯¹è±¡çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œã€‚ç›®å‰Kubernetesç³»ç»Ÿæ”¯æŒ8ç§èµ„æºæ“ä½œæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watchæ“ä½œæ–¹æ³•\nKubernetesçš„èµ„æºä¹Ÿåˆ†ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯Kubernetes Resourceï¼ˆkubernetes å†…ç½®èµ„æºï¼‰ å’Œ Custom Resourceï¼ˆè‡ªå®šä¹‰èµ„æºï¼‰ã€‚å¼€å‘è€…é€šè¿‡CRDï¼ˆå³Custom Resource Definitionsï¼‰å¯å®ç°è‡ªå®šä¹‰èµ„æºï¼Œå®ƒå…è®¸ç”¨æˆ·å°†è‡ªå·±å®šä¹‰çš„èµ„æºæ·»åŠ åˆ°Kubenetes ç³»ç»Ÿä¸­ï¼Œå¹¶åƒä½¿ç”¨kubernetes å†…ç½®èµ„æºä¸€æ ·ä½¿ç”¨å®ƒä»¬\n"},{"id":19,"href":"/docs/linux/%E7%BD%91%E7%BB%9C/tcp%E5%8D%8F%E8%AE%AE/","title":"tcp åè®®","section":"ç½‘ç»œ","content":" è¯¦è§£ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ # ä¸‰æ¬¡æ¡æ‰‹ï¼ˆå»ºç«‹è¿æ¥ï¼‰ # TCPé‡‡ç”¨ ä¸‰æ¬¡æ¡æ‰‹ï¼ˆThree-Way Handshakeï¼‰ è¿‡ç¨‹æ¥å»ºç«‹å¯é è¿æ¥ï¼š\nå®¢æˆ·ç«¯å‘é€ SYNï¼ˆåŒæ­¥åºåˆ—å·ï¼‰ï¼š å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª SYN æŠ¥æ–‡ï¼Œè¡¨ç¤ºè¯·æ±‚å»ºç«‹è¿æ¥ã€‚ è¯¥æŠ¥æ–‡çš„ SYN=1ï¼Œå¹¶åŒ…å«ä¸€ä¸ªåˆå§‹åºåˆ—å· seq=xã€‚ æœåŠ¡å™¨å›åº” SYN-ACKï¼š æœåŠ¡å™¨æ”¶åˆ° SYN åï¼Œå‘é€ SYN=1, ACK=1ï¼Œå¹¶é™„å¸¦è‡ªå·±çš„åˆå§‹åºåˆ—å· seq=yï¼Œç¡®è®¤å®¢æˆ·ç«¯çš„ seq=x+1ã€‚ å®¢æˆ·ç«¯å›åº” ACKï¼š å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ SYN-ACK åï¼Œå‘é€ ACK=1ï¼Œç¡®è®¤ seq=y+1ï¼ŒåŒæ—¶æºå¸¦ seq=x+1ã€‚ å››æ¬¡æŒ¥æ‰‹ï¼ˆæ–­å¼€è¿æ¥ï¼‰ # TCP é‡‡ç”¨ å››æ¬¡æŒ¥æ‰‹ï¼ˆFour-Way Handshakeï¼‰ æ–­å¼€è¿æ¥ï¼š\nå®¢æˆ·ç«¯å‘é€ FINï¼š å®¢æˆ·ç«¯æƒ³è¦æ–­å¼€è¿æ¥ï¼Œå‘é€ FIN=1ï¼Œè¡¨ç¤ºæ— æ•°æ®å¯å‘ã€‚ æœåŠ¡å™¨å‘é€ ACKï¼š æœåŠ¡å™¨æ”¶åˆ° FIN åï¼Œå›å¤ ACK=1ï¼Œä½†å¯èƒ½ä»æœ‰æœªå‘é€çš„æ•°æ®ã€‚ æœåŠ¡å™¨å‘é€ FINï¼š æœåŠ¡å™¨ç¡®è®¤æ•°æ®å‘é€å®Œæ¯•ï¼Œå‘é€ FIN=1 æ–­å¼€è¿æ¥ã€‚ å®¢æˆ·ç«¯å‘é€ ACKï¼Œå®Œæˆæ–­å¼€ï¼š å®¢æˆ·ç«¯ç¡®è®¤ FINï¼Œå›å¤ ACK=1ï¼Œè¿æ¥æ­£å¼å…³é—­ã€‚ "},{"id":20,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/questions/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%97%A0%E7%8A%B6%E6%80%81%E6%9C%8D%E5%8A%A1kubernetes%E7%9A%84%E5%86%85%E9%83%A8%E6%B5%81%E7%A8%8B/","title":"åˆ›å»ºä¸€ä¸ªæ— çŠ¶æ€æœåŠ¡","section":"questions","content":" åˆ›å»ºä¸€ä¸ªdeploymentèµ„æº # å½“åˆ›å»ºä¸€ä¸ªdeploymentæ—¶ï¼Œkubernetes å†…éƒ¨æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ\nåˆ›å»º Deployment èµ„æº ç”¨æˆ·é€šè¿‡ kubectl apply æˆ– API ç›´æ¥åˆ›å»ºä¸€ä¸ª Deployment èµ„æºã€‚ kube-apiserver æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå°† Deployment å¯¹è±¡å†™å…¥ etcd æ•°æ®åº“ã€‚ controller-manager å¤„ç† Deployment kube-controller-manager ç›‘å¬ Deployment èµ„æºï¼ˆé€šè¿‡ watch æœºåˆ¶ï¼‰ã€‚ å‘ç°æ–°å»ºçš„ Deploymentï¼ŒDeploymentController è®¡ç®—å‡ºéœ€è¦åˆ›å»ºçš„ ReplicaSetï¼ˆå¦‚æœæ˜¯æ›´æ–°ï¼Œè¿˜ä¼šè¿›è¡Œæ»šåŠ¨å‡çº§ï¼‰ã€‚ controller-manager é€šè¿‡ kube-apiserver åˆ›å»º ReplicaSet èµ„æºã€‚ controller-manager å¤„ç† ReplicaSet kube-controller-manager ç›‘å¬ ReplicaSet èµ„æºï¼ˆé€šè¿‡ watch æœºåˆ¶ï¼‰ã€‚ å‘ç°æ–°å»ºçš„ ReplicaSetï¼ŒReplicaSetController è®¡ç®—å‡ºéœ€è¦åˆ›å»ºçš„ Podã€‚ controller-manager é€šè¿‡ kube-apiserver åˆ›å»º Pod èµ„æºã€‚ kube-scheduler è¿›è¡Œè°ƒåº¦ kube-scheduler ç›‘å¬ Pod èµ„æºçš„å˜æ›´ï¼ˆé€šè¿‡ watch æœºåˆ¶ï¼‰ã€‚ å‘ç° Pod å¤„äº Pending çŠ¶æ€ï¼Œè°ƒåº¦å™¨è®¡ç®—å‡ºåˆé€‚çš„ Nodeï¼ˆæ ¹æ® CPUã€å†…å­˜ã€è°ƒåº¦ç­–ç•¥ç­‰ï¼‰ã€‚ kube-scheduler é€šè¿‡ kube-apiserver æ›´æ–° Pod çš„ spec.nodeNameï¼Œåˆ†é…åˆ°åˆé€‚çš„èŠ‚ç‚¹ã€‚ kubelet è´Ÿè´£æ‹‰èµ·å®¹å™¨ kubelet ç›‘å¬ kube-apiserverï¼Œå‘ç°è¢«åˆ†é…åˆ°è‡ªå·±èŠ‚ç‚¹çš„ Podã€‚ kubelet é€šè¿‡ Container Runtime Interface (CRI) æ‰§è¡Œï¼š åˆ›å»ºç½‘ç»œï¼ˆè°ƒç”¨ CNI æ’ä»¶ï¼Œåˆ†é… IPï¼‰ã€‚ æŒ‚è½½å­˜å‚¨ï¼ˆè°ƒç”¨ CSI æ’ä»¶ï¼ŒæŒ‚è½½ Volumeï¼‰ã€‚ å¯åŠ¨å®¹å™¨ï¼ˆè°ƒç”¨ CRIï¼Œä½¿ç”¨ containerd æˆ– Docker ç­‰åˆ›å»ºå®¹å™¨ï¼‰ã€‚ kubelet é€šè¿‡ kube-apiserver æ›´æ–° Pod çŠ¶æ€ï¼ˆRunningï¼‰ã€‚ åˆ›å»ºä¸€ä¸ªserviceèµ„æº # kube-proxy ç›‘å¬ kube-apiserver ä¸Šçš„ service èµ„æºçš„åˆ›å»ºï¼š å½“ kube-proxy ç›‘è§†åˆ°æ–°çš„æœåŠ¡èµ„æºï¼ˆServiceï¼‰æ—¶ï¼Œå®ƒä¼šæ ¹æ® Service ä¸­çš„æ ‡ç­¾ï¼ˆlabelsï¼‰æ¥ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„ Podã€‚è¿™äº› Pod æ˜¯ä¸è¯¥ Service ç›¸å…³è”çš„ç›®æ ‡ï¼ˆåç«¯ï¼‰ã€‚é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œkube-proxy åˆ›å»ºä¸€ä¸ª Endpoints èµ„æºå¯¹è±¡ï¼ŒæŒ‡å‘è¿™äº› Podã€‚ kube-proxy ç›‘å¬ endpoint èµ„æºçš„å˜åŒ–ï¼š Endpoints èµ„æºå¯¹è±¡è¢«åˆ›å»ºæˆ–æ›´æ–°ï¼Œkube-proxy å°±ä¼šåŠ¨æ€åœ°æ ¹æ®æ–°çš„ Endpoint ä¿¡æ¯æ¥ä¿®æ”¹å…¶ç½‘ç»œè§„åˆ™ï¼ˆå¦‚ iptables æˆ– ipvsï¼‰ã€‚ kube-proxy æ ¹æ® Endpoint ä¸­çš„ Pod åœ°å€åˆ›å»ºæˆ–æ›´æ–°ç›¸åº”çš„ iptables æˆ– ipvs è§„åˆ™ï¼Œè¿™æ ·æµé‡å°±å¯ä»¥é€šè¿‡æ­£ç¡®çš„åç«¯ Pod è¿›è¡Œè·¯ç”±ã€‚ "},{"id":21,"href":"/docs/%E7%AE%97%E6%B3%95/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/1.-%E8%85%90%E7%83%82%E7%9A%84%E6%A9%98%E5%AD%90/","title":"è…çƒ‚çš„æ©˜å­","section":"æ‹“æ‰‘æ’åº","content":" è…çƒ‚çš„æ©˜å­ # leetcode 994\nåœ¨ç»™å®šçš„ m x n ç½‘æ ¼ grid ä¸­ï¼Œæ¯ä¸ªå•å…ƒæ ¼å¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ä¸ªå€¼ä¹‹ä¸€ï¼š\nå€¼ 0 ä»£è¡¨ç©ºå•å…ƒæ ¼ï¼› å€¼ 1 ä»£è¡¨æ–°é²œæ©˜å­ï¼› å€¼ 2 ä»£è¡¨è…çƒ‚çš„æ©˜å­ã€‚ æ¯åˆ†é’Ÿï¼Œè…çƒ‚çš„æ©˜å­ å‘¨å›´ 4 ä¸ªæ–¹å‘ä¸Šç›¸é‚» çš„æ–°é²œæ©˜å­éƒ½ä¼šè…çƒ‚ã€‚\nè¿”å› ç›´åˆ°å•å…ƒæ ¼ä¸­æ²¡æœ‰æ–°é²œæ©˜å­ä¸ºæ­¢æ‰€å¿…é¡»ç»è¿‡çš„æœ€å°åˆ†é’Ÿæ•°ã€‚å¦‚æœä¸å¯èƒ½ï¼Œè¿”å› -1 ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šgrid = [[2,1,1],[1,1,0],[0,1,1]]\nè¾“å‡ºï¼š4\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šgrid = [[2,1,1],[0,1,1],[1,0,1]]\nè¾“å‡ºï¼š-1\nè§£é‡Šï¼šå·¦ä¸‹è§’çš„æ©˜å­ï¼ˆç¬¬ 2 è¡Œï¼Œ ç¬¬ 0 åˆ—ï¼‰æ°¸è¿œä¸ä¼šè…çƒ‚ï¼Œå› ä¸ºè…çƒ‚åªä¼šå‘ç”Ÿåœ¨ 4 ä¸ªæ–¹å‘ä¸Šã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šgrid = [[0,2]]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šå› ä¸º 0 åˆ†é’Ÿæ—¶å·²ç»æ²¡æœ‰æ–°é²œæ©˜å­äº†ï¼Œæ‰€ä»¥ç­”æ¡ˆå°±æ˜¯ 0 ã€‚\ntype Point struct { x, y, time int } func orangesRotting(grid [][]int) int { rows, cols := len(grid), len(grid[0]) freshCount := 0 queue := []*Point{} directions := [][]int{{1,0}, {-1, 0}, {0, 1}, {0, -1}} totalTime := 0 for i:=0; i \u0026lt; (rows); i++{ for j := 0; j \u0026lt; (cols); j++{ if grid[i][j] == 2{ queue = append(queue, \u0026amp;Point{i, j, 0}) }else if grid[i][j] == 1{ freshCount ++ } } } for len(queue) != 0{ p := queue[0] queue = queue[1:] for _, direction := range directions { newX, newY := p.x + direction[0], p.y + direction[1] if newX \u0026gt;= 0 \u0026amp;\u0026amp; newX \u0026lt; rows \u0026amp;\u0026amp; newY \u0026gt;= 0 \u0026amp;\u0026amp; newY \u0026lt; cols \u0026amp;\u0026amp; grid[newX][newY] == 1{ grid[newX][newY] = 2 queue = append(queue, \u0026amp;Point{newX, newY, p.time + 1}) freshCount -- totalTime = p.time + 1 } } } if freshCount != 0{ return -1 } return totalTime } "},{"id":22,"href":"/docs/%E7%AE%97%E6%B3%95/%E5%8F%8C%E6%8C%87%E9%92%88/1.%E6%8E%A5%E9%9B%A8%E6%B0%B4/","title":"æ¥é›¨æ°´","section":"åŒæŒ‡é’ˆ","content":" æ¥é›¨æ°´ # leetcode 45\nç»™å®š n ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šheight = [0,1,0,2,1,0,1,3,2,1,2,1] è¾“å‡ºï¼š6 è§£é‡Šï¼šä¸Šé¢æ˜¯ç”±æ•°ç»„ [0,1,0,2,1,0,1,3,2,1,2,1] è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ 6 ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚ ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šheight = [4,2,0,3,2,5] è¾“å‡ºï¼š9\nfunc trap(height []int) int { left, right := 0, len(height) -1 leftMax, rightMax := 0, 0 totalWater := 0 for left \u0026lt; right{ if height[left] \u0026lt; height[right]{ if height[left] \u0026lt; leftMax{ totalWater += leftMax - height[left] }else{ leftMax = height[left] } left ++ } else{ if height[right] \u0026gt;= rightMax{ rightMax = height[right] }else{ totalWater += rightMax - height[right] } right-- } } fmt.Println(left, right) return totalWater } "},{"id":23,"href":"/docs/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%A0%91/1.-%E5%89%8D%E5%BA%8F%E9%81%8D%E5%8E%86/","title":"å‰åºéå†","section":"äºŒå‰æ ‘","content":" å‰åºéå† # æ ¹ â†’ å·¦å­æ ‘ â†’ å³å­æ ‘\nfunc preOrderTraversal(root *TreeNode) []int { if root == nil { return []int{} } stack, res := []*TreeNode{root}, []int{} for len(stack) \u0026gt; 0 { node := stack[len(stack)-1] stack = stack[:len(stack)-1] res = append(res, node.Val) if node.Right != nil { stack = append(stack, node.Right) } if node.Left != nil { stack = append(stack, node.Left) } } return res } "},{"id":24,"href":"/docs/%E7%AE%97%E6%B3%95/%E5%A0%86/1.-%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/","title":"æ•°æ®æµçš„ä¸­ä½æ•°","section":"å †","content":" æ•°æ®æµçš„ä¸­ä½æ•° # leetcode 295\nä¸­ä½æ•°æ˜¯æœ‰åºæ•´æ•°åˆ—è¡¨ä¸­çš„ä¸­é—´å€¼ã€‚å¦‚æœåˆ—è¡¨çš„å¤§å°æ˜¯å¶æ•°ï¼Œåˆ™æ²¡æœ‰ä¸­é—´å€¼ï¼Œä¸­ä½æ•°æ˜¯ä¸¤ä¸ªä¸­é—´å€¼çš„å¹³å‡å€¼ã€‚\nä¾‹å¦‚ arr = [2,3,4] çš„ä¸­ä½æ•°æ˜¯ 3 ã€‚\nä¾‹å¦‚ arr = [2,3] çš„ä¸­ä½æ•°æ˜¯ (2 + 3) / 2 = 2.5 ã€‚\nå®ç° MedianFinder ç±»:\nMedianFinder() åˆå§‹åŒ– MedianFinder å¯¹è±¡ã€‚\nvoid addNum(int num) å°†æ•°æ®æµä¸­çš„æ•´æ•° num æ·»åŠ åˆ°æ•°æ®ç»“æ„ä¸­ã€‚\ndouble findMedian() è¿”å›åˆ°ç›®å‰ä¸ºæ­¢æ‰€æœ‰å…ƒç´ çš„ä¸­ä½æ•°ã€‚ä¸å®é™…ç­”æ¡ˆç›¸å·® 10-5 ä»¥å†…çš„ç­”æ¡ˆå°†è¢«æ¥å—ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ [\u0026ldquo;MedianFinder\u0026rdquo;, \u0026ldquo;addNum\u0026rdquo;, \u0026ldquo;addNum\u0026rdquo;, \u0026ldquo;findMedian\u0026rdquo;, \u0026ldquo;addNum\u0026rdquo;, \u0026ldquo;findMedian\u0026rdquo;]\n[[], [1], [2], [], [3], []] è¾“å‡º [null, null, null, 1.5, null, 2.0]\nè§£é‡Š MedianFinder medianFinder = new MedianFinder();\nmedianFinder.addNum(1); // arr = [1]\nmedianFinder.addNum(2); // arr = [1, 2]\nmedianFinder.findMedian(); // è¿”å› 1.5 ((1 + 2) / 2)\nmedianFinder.addNum(3); // arr[1, 2, 3]\nmedianFinder.findMedian(); // return 2.0\ntype MaxHeap struct{ nums []int } func (h MaxHeap) Len() int { return len(h.nums) } func (h MaxHeap) Less(i, j int) bool { return h.nums[i] \u0026gt; h.nums[j] } // å¤§æ ¹å † func (h MaxHeap) Swap(i, j int) { h.nums[i], h.nums[j] = h.nums[j], h.nums[i] } func (h *MaxHeap) Push(x interface{}) { h.nums = append(h.nums, x.(int)) } func (h *MaxHeap) Pop() interface{} { old := h.nums n := len(old) x := old[n-1] h.nums = old[:n-1] return x } // å°æ ¹å †ï¼ˆå­˜è¾ƒå¤§çš„ä¸€åŠæ•°æ®ï¼‰ type MinHeap struct{ nums []int } func (h MinHeap) Len() int { return len(h.nums) } func (h MinHeap) Less(i, j int) bool { return h.nums[i] \u0026lt; h.nums[j] } // å°æ ¹å † func (h MinHeap) Swap(i, j int) { h.nums[i], h.nums[j] = h.nums[j], h.nums[i] } func (h *MinHeap) Push(x interface{}) { h.nums = append(h.nums, x.(int)) } func (h *MinHeap) Pop() interface{} { old := h.nums n := len(old) x := old[n-1] h.nums = old[:n-1] return x } // æ•°æ®æµä¸­ä½æ•° type MedianFinder struct { maxHeap *MaxHeap // å¤§æ ¹å † minHeap *MinHeap // å°æ ¹å † } // åˆå§‹åŒ– func Constructor() MedianFinder { return MedianFinder{ maxHeap: \u0026amp;MaxHeap{}, minHeap: \u0026amp;MinHeap{}, } } // æ·»åŠ æ•°å­— func (mf *MedianFinder) AddNum(num int) { heap.Push(mf.maxHeap, num) // å…ˆæ”¾å…¥å¤§æ ¹å † heap.Push(mf.minHeap, heap.Pop(mf.maxHeap)) // å¹³è¡¡åˆ°å°æ ¹å † // å¦‚æœå°æ ¹å †å…ƒç´ å¤šäºå¤§æ ¹å †ï¼Œåˆ™è°ƒæ•´ if mf.minHeap.Len() \u0026gt; mf.maxHeap.Len() { heap.Push(mf.maxHeap, heap.Pop(mf.minHeap)) } } // è·å–ä¸­ä½æ•° func (mf *MedianFinder) FindMedian() float64 { if mf.maxHeap.Len() \u0026gt; mf.minHeap.Len() { return float64(mf.maxHeap.nums[0]) } return float64(mf.maxHeap.nums[0]+mf.minHeap.nums[0]) / 2.0 } "},{"id":25,"href":"/docs/%E7%AE%97%E6%B3%95/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/","title":"è´ªå¿ƒç®—æ³•","section":"ç®—æ³•","content":"æœ¬ç« èŠ‚ä»‹ç»è´ªå¿ƒç®—æ³•\nåŸºæœ¬æ€æƒ³ # å±€éƒ¨æœ€ä¼˜è§£ï¼šåœ¨æ¯ä¸€æ­¥å†³ç­–ä¸­ï¼Œé€‰æ‹©å½“å‰çŠ¶æ€ä¸‹æœ€ä¼˜çš„å±€éƒ¨è§£ æ— åæ•ˆæ€§ï¼šå½“å‰çš„é€‰æ‹©ä¸ä¼šå½±å“åç»­çš„é€‰æ‹©ï¼Œå³ä¸ä¾èµ–äºæœªæ¥çš„é€‰æ‹© å¸Œæœ›å¯¼è‡´å…¨å±€æœ€ä¼˜è§£ï¼šé€šè¿‡ä¸€ç³»åˆ—å±€éƒ¨æœ€ä¼˜è§£ï¼Œæœ€ç»ˆå¾—åˆ°å…¨å±€æœ€ä¼˜è§£ é€‚ç”¨æ¡ä»¶ # è´ªå¿ƒé€‰æ‹©æ€§è´¨ï¼šé—®é¢˜çš„å…¨å±€æœ€ä¼˜è§£å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—å±€éƒ¨æœ€ä¼˜é€‰æ‹©å¾—åˆ° æœ€ä¼˜å­ç»“æ„ï¼šé—®é¢˜çš„æœ€ä¼˜è§£åŒ…å«å­é—®é¢˜çš„æœ€ä¼˜è§£ æ­¥éª¤ # é—®é¢˜åˆ†è§£ï¼šå°†é—®é¢˜åˆ†ä¸ºè‹¥å¹²ä¸ªå­é—®é¢˜ å±€éƒ¨æœ€ä¼˜é€‰æ‹©ï¼šå¯¹æ¯ä¸ªå­é—®é¢˜ï¼Œé€‰æ‹©ä¸€ä¸ªå±€éƒ¨æœ€ä¼˜è§£ åˆå¹¶è§£ï¼šå°†å±€éƒ¨æœ€ä¼˜è§£åˆå¹¶ä¸ºå…¨å±€è§£ ç»å…¸åº”ç”¨ # æ´»åŠ¨é€‰æ‹©é—®é¢˜ï¼šé€‰æ‹©æœ€å¤šçš„äº’ä¸é‡å çš„æ´»åŠ¨ã€‚ éœå¤«æ›¼ç¼–ç ï¼šæ„é€ æœ€ä¼˜å‰ç¼€ç¼–ç ã€‚ æœ€å°ç”Ÿæˆæ ‘ï¼šå¦‚Primç®—æ³•å’ŒKruskalç®—æ³•ã€‚ æœ€çŸ­è·¯å¾„é—®é¢˜ï¼šå¦‚Dijkstraç®—æ³•ã€‚ èƒŒåŒ…é—®é¢˜çš„åˆ†æ•°ç‰ˆæœ¬ï¼šé€‰æ‹©å•ä½ä»·å€¼æœ€é«˜çš„ç‰©å“ã€‚ ä¼˜ç¼ºç‚¹ # ä¼˜ç‚¹\nç®€å•æ˜“å®ç° é€šå¸¸å…·æœ‰è¾ƒé«˜çš„æ•ˆç‡ ç¼ºç‚¹ ä¸æ€»æ˜¯èƒ½å¾—åˆ°å…¨å±€æœ€ä¼˜è§£ éœ€è¦é—®é¢˜å…·æœ‰è´ªå¿ƒé€‰æ‹©æ€§è´¨å’Œæœ€ä¼˜å­ç»“æ„ "},{"id":26,"href":"/docs/%E7%AE%97%E6%B3%95/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/first/","title":"è·³è·ƒæ¸¸æˆ 2","section":"è´ªå¿ƒç®—æ³•","content":" è·³è·ƒæ¸¸æˆ 2 # leetcode 45\nç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„ 0 ç´¢å¼•æ•´æ•°æ•°ç»„ numsã€‚åˆå§‹ä½ç½®ä¸º nums[0]ã€‚\næ¯ä¸ªå…ƒç´  nums[i] è¡¨ç¤ºä»ç´¢å¼• i å‘åè·³è½¬çš„æœ€å¤§é•¿åº¦ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ åœ¨ nums[i] å¤„ï¼Œä½ å¯ä»¥è·³è½¬åˆ°ä»»æ„ nums[i + j] å¤„:\n0 \u0026lt;= j \u0026lt;= nums[i] i + j \u0026lt; n è¿”å›åˆ°è¾¾ nums[n - 1] çš„æœ€å°è·³è·ƒæ¬¡æ•°ã€‚ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹å¯ä»¥åˆ°è¾¾ nums[n - 1]ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: nums = [2,3,1,1,4] è¾“å‡º: 2 è§£é‡Š: è·³åˆ°æœ€åä¸€ä¸ªä½ç½®çš„æœ€å°è·³è·ƒæ•°æ˜¯ 2ã€‚ ä»ä¸‹æ ‡ä¸º 0 è·³åˆ°ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼Œè·³ 1 æ­¥ï¼Œç„¶åè·³ 3 æ­¥åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚ ç¤ºä¾‹ 2:\nè¾“å…¥: nums = [2,3,0,1,4] è¾“å‡º: 2\nfunc jump(nums []int) int { n := len(nums) if n \u0026lt;= 1{ return 0 } steps , curEnd, maxReach := 0, 0, 0 for i :=0 ; i\u0026lt; n ; i ++{ maxReach = max(maxReach, i + nums[i]) if i == curEnd{ steps ++ curEnd = maxReach if curEnd \u0026gt;= n-1{ break } } } return steps } "},{"id":27,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/questions/%E7%BD%91%E7%BB%9C/","title":"ç½‘ç»œ","section":"questions","content":" kubernetes å®¹å™¨æä¾›ä¸€ä¸ªæœåŠ¡ï¼Œå¤–éƒ¨è®¿é—®æ…¢ï¼Œå¦‚ä½•æ’æŸ¥æ˜¯å®¹å™¨ç½‘ç»œåŸå› è¿˜æ˜¯æœåŠ¡æœ¬èº«çš„é—®é¢˜ # å¦‚æœå®¹å™¨å†…éƒ¨æ²¡æœ‰sh å’Œç½‘ç»œå·¥å…·ï¼Œå¦‚ä½•æŸ¥çœ‹pod å†…éƒ¨çš„ç½‘ç»œè¿æ¥ # ä½¿ç”¨ kubectl debug kubernetes æä¾›äº†kubectl debugè®©ä½ å¯ä»¥åœ¨podçš„ç½‘ç»œnamespace å†…è¿è¡Œä¸€ä¸ªä¸´æ—¶å®¹å™¨ï¼Œè¯¥å®¹å™¨å¯ä»¥åŒ…å«ç½‘ç»œå·¥å…·ï¼Œå¦‚netstatã€ssã€curlã€tcpdumpç­‰\nkubectl debug -it \u0026lt;pod-name\u0026gt; --image=busybox --target=\u0026lt;container-name\u0026gt; ä½¿ç”¨nsenter è¿›å…¥podçš„ç½‘ç»œNamespace å¦‚æœä½ æœ‰é›†ç¾¤èŠ‚ç‚¹çš„æƒé™ï¼Œå¯ä»¥æ‰¾åˆ°podè¿è¡Œçš„èŠ‚ç‚¹ï¼Œå¹¶ä½¿ç”¨nsenter è¿›å…¥podçš„ç½‘ç»œçš„namespace # å…ˆæ‰¾åˆ° Pod è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ kubectl get pod \u0026lt;pod-name\u0026gt; -o wide # SSH è¿›å…¥è¯¥èŠ‚ç‚¹ï¼Œç„¶åæ‰¾åˆ° Pod å¯¹åº”çš„å®¹å™¨ ID docker ps | grep \u0026lt;pod-name\u0026gt; # å¦‚æœæ˜¯ Docker è¿è¡Œæ—¶ crictl ps | grep \u0026lt;pod-name\u0026gt; # å¦‚æœæ˜¯ containerd æˆ– CRI-O è¿è¡Œæ—¶ # è·å–ç½‘ç»œ namespaceï¼Œå¹¶ä½¿ç”¨ nsenter è¿›å…¥ PID=$(docker inspect --format \u0026#39;{{.State.Pid}}\u0026#39; \u0026lt;container-id\u0026gt;) # Docker PID=$(crictl inspect --output go-template --template \u0026#39;{{.info.pid}}\u0026#39; \u0026lt;container-id\u0026gt;) # containerd nsenter -t $PID -n netstat -an nsenter -t $PID -n ss -tnlp ä½¿ç”¨tcpdumpåœ¨Node ä¸ŠæŠ“åŒ… tcpdump -i any port \u0026lt;pod-port\u0026gt; kubectl get pod \u0026lt;pod-name\u0026gt; -o jsonpath=\u0026#39;{.status.podIP}\u0026#39; tcpdump -i any host \u0026lt;pod-IP\u0026gt; "},{"id":28,"href":"/docs/","title":"æ–‡æ¡£é¦–é¡µ","section":"beiçš„ä¸ªäººåšå®¢","content":" æ¬¢è¿ä½¿ç”¨ Hugo Book ä¸»é¢˜ï¼ # "},{"id":29,"href":"/docs/go/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/","title":"æ€§èƒ½æµ‹è¯•","section":"Go","content":"æœ¬ç« èŠ‚ä»‹ç» golang çš„æ€§èƒ½æµ‹è¯•\n"},{"id":30,"href":"/docs/%E7%AE%97%E6%B3%95/%E5%88%86%E6%B2%BB%E6%B3%95/1.-%E5%AF%BB%E6%89%BE%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%80%E5%B0%8F%E5%80%BC/","title":"å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼","section":"åˆ†æ²»æ³•","content":" å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ # leetcode 153\nå·²çŸ¥ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ï¼Œé¢„å…ˆæŒ‰ç…§å‡åºæ’åˆ—ï¼Œç»ç”± 1 åˆ° n æ¬¡ æ—‹è½¬ åï¼Œå¾—åˆ°è¾“å…¥æ•°ç»„ã€‚ä¾‹å¦‚ï¼ŒåŸæ•°ç»„ nums = [0,1,2,4,5,6,7] åœ¨å˜åŒ–åå¯èƒ½å¾—åˆ°ï¼š\nè‹¥æ—‹è½¬ 4 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° [4,5,6,7,0,1,2]\nè‹¥æ—‹è½¬ 7 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° [0,1,2,4,5,6,7]\næ³¨æ„ï¼Œæ•°ç»„ [a[0], a[1], a[2], \u0026hellip;, a[n-1]] æ—‹è½¬ä¸€æ¬¡ çš„ç»“æœä¸ºæ•°ç»„ [a[n-1], a[0], a[1], a[2], \u0026hellip;, a[n-2]] ã€‚\nç»™ä½ ä¸€ä¸ªå…ƒç´ å€¼ äº’ä¸ç›¸åŒ çš„æ•°ç»„ nums ï¼Œå®ƒåŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åˆ—çš„æ•°ç»„ï¼Œå¹¶æŒ‰ä¸Šè¿°æƒ…å½¢è¿›è¡Œäº†å¤šæ¬¡æ—‹è½¬ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›æ•°ç»„ä¸­çš„ æœ€å°å…ƒç´  ã€‚\nä½ å¿…é¡»è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums = [3,4,5,1,2]\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šåŸæ•°ç»„ä¸º [1,2,3,4,5] ï¼Œæ—‹è½¬ 3 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums = [4,5,6,7,0,1,2]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šåŸæ•°ç»„ä¸º [0,1,2,4,5,6,7] ï¼Œæ—‹è½¬ 4 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums = [11,13,15,17]\nè¾“å‡ºï¼š11\nè§£é‡Šï¼šåŸæ•°ç»„ä¸º [11,13,15,17] ï¼Œæ—‹è½¬ 4 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚\nfunc findMin(nums []int) int { left, right := 0, len(nums) -1 for left \u0026lt; right{ mid := (left + right) / 2 if nums[mid] \u0026gt; nums[right]{ left = mid + 1 }else{ right = mid } } return nums[left] } "},{"id":31,"href":"/docs/%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/1.-%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97/","title":"æœ€é•¿å…¬å…±å­åºåˆ—","section":"åŠ¨æ€è§„åˆ’","content":" æœ€é•¿å…¬å…±å­åºåˆ— # leetcode 300\nç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² text1 å’Œ text2ï¼Œè¿”å›è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿ å…¬å…±å­åºåˆ— çš„é•¿åº¦ã€‚å¦‚æœä¸å­˜åœ¨ å…¬å…±å­åºåˆ— ï¼Œè¿”å› 0 ã€‚\nä¸€ä¸ªå­—ç¬¦ä¸²çš„ å­åºåˆ— æ˜¯æŒ‡è¿™æ ·ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼šå®ƒæ˜¯ç”±åŸå­—ç¬¦ä¸²åœ¨ä¸æ”¹å˜å­—ç¬¦çš„ç›¸å¯¹é¡ºåºçš„æƒ…å†µä¸‹åˆ é™¤æŸäº›å­—ç¬¦ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ä»»ä½•å­—ç¬¦ï¼‰åç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚\nä¾‹å¦‚ï¼Œ\u0026ldquo;ace\u0026rdquo; æ˜¯ \u0026ldquo;abcde\u0026rdquo; çš„å­åºåˆ—ï¼Œä½† \u0026ldquo;aec\u0026rdquo; ä¸æ˜¯ \u0026ldquo;abcde\u0026rdquo; çš„å­åºåˆ—ã€‚ ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ å…¬å…±å­åºåˆ— æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰€å…±åŒæ‹¥æœ‰çš„å­åºåˆ—ã€‚\nfunc longestCommonSubsequence(text1 string, text2 string) int { m, n := len(text1), len(text2) dp := make([][]int, m+1) for i := range dp { dp[i] = make([]int, n+1) } for i := 1; i \u0026lt;= m; i++ { for j := 1; j \u0026lt;= n; j++ { if text1[i-1] == text2[j-1] { dp[i][j] = dp[i-1][j-1] + 1 } else { dp[i][j] = max(dp[i-1][j], dp[i][j-1]) } } } return dp[m][n] } "},{"id":32,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/develop/questions/","title":"Questions","section":"develop","content":" # "},{"id":33,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-workflow/","title":"argo workflow","section":"Argo","content":"ä»‹ç»ä½¿ç”¨argo workflow\n"},{"id":34,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/operate/install/calico/","title":"calico","section":"install","content":"xxx\n"},{"id":35,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/cilium/","title":"Cilium","section":"äº‘åŸç”Ÿ","content":"æœ¬ç« èŠ‚ä»‹ç»Cilium\n"},{"id":36,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/develop/client-go/","title":"client-go","section":"develop","content":"æ¬¢è¿ä½¿ç”¨client-go\n"},{"id":37,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/develop/controller-runtime/","title":"controller runtime","section":"develop","content":"æ¬¢è¿ä½¿ç”¨controller runtime\n"},{"id":38,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/develop/","title":"develop","section":"Kubernetes","content":"æ¬¢è¿ä½¿ç”¨kubernetes\n"},{"id":39,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/develop/client-go/informer/indexr/","title":"Indexer","section":"informer","content":" Indexer # "},{"id":40,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/develop/client-go/informer/","title":"informer","section":"client-go","content":" "},{"id":41,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-cd/introduce/","title":"introduce","section":"argo cd","content":" ğŸ“˜ Argo CD å­¦ä¹ ç¬”è®°ï¼šç¬¬ 1 å¤© - GitOps ä¸æ¶æ„ç†è§£ # âœ… ä»€ä¹ˆæ˜¯ GitOpsï¼Ÿ # GitOps æ˜¯ä¸€ç§é€šè¿‡ Git ä»“åº“ä½œä¸º**å•ä¸€äº‹å®æ¥æºï¼ˆsingle source of truthï¼‰**æ¥ç®¡ç†å’Œéƒ¨ç½²åŸºç¡€è®¾æ–½å’Œåº”ç”¨ç¨‹åºçš„æ¨¡å¼ã€‚å…¶æ ¸å¿ƒç†å¿µæ˜¯ï¼š\nå£°æ˜å¼é…ç½®ï¼šä½¿ç”¨ Git ä¿å­˜ Kubernetes ç­‰èµ„æºçš„ YAML é…ç½® è‡ªåŠ¨éƒ¨ç½²ï¼šå½“ Git ä¸­é…ç½®å˜åŒ–æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å°†å˜åŒ–åŒæ­¥åˆ°é›†ç¾¤ä¸­ å›æ»šä¸å®¡è®¡ï¼šåŸºäº Git çš„æäº¤è®°å½•ï¼Œå¯è½»æ¾å›æ»šã€å®¡è®¡å˜æ›´å†å² ğŸ“Œ GitOps ä¸ CI/CD çš„åŒºåˆ« # é¡¹ç›® CI/CD GitOps è§¦å‘æ–¹å¼ é€šå¸¸åŸºäºäº‹ä»¶ï¼ˆå¦‚ Pushï¼‰è§¦å‘æµæ°´çº¿ ä»¥ Git ä¸ºé©±åŠ¨æºï¼Œé€šè¿‡å¯¹æ¯”é…ç½®å®ç°éƒ¨ç½² æ ¸å¿ƒå·¥å…· Jenkins/GitLab CI/GitHub Actions ç­‰ Argo CDã€Flux çŠ¶æ€åŒæ­¥ å¤–éƒ¨å·¥å…·æ¨é€çŠ¶æ€ Git ä¸­é…ç½®æ˜¯é›†ç¾¤çš„ç›®æ ‡çŠ¶æ€ å›æ»šæœºåˆ¶ ä¾èµ–æµæ°´çº¿å’Œæ„å»ºäº§ç‰© ç›´æ¥ git revert å¹¶åŒæ­¥å³å¯ å¯è§‚æµ‹æ€§ CI/CD å·¥å…·æ—¥å¿— Git + çŠ¶æ€å¯¹æ¯” + Argo CD ç•Œé¢ ğŸ§© Argo CD æ¶æ„å›¾ä¸ç»„ä»¶ # æ ¸å¿ƒç»„ä»¶è§£é‡Šï¼š # ç»„ä»¶ è¯´æ˜ API Server æä¾› gRPC å’Œ REST æ¥å£ï¼Œä¸å‰ç«¯äº¤äº’ï¼Œå¤„ç† CLI/API è¯·æ±‚ Repository Server æ‹‰å– Git ä»“åº“çš„å†…å®¹ï¼Œç”Ÿæˆ manifests Application Controller è´Ÿè´£ç›‘æ§å’ŒåŒæ­¥ Kubernetes èµ„æº Argo CD UI æä¾›ç›´è§‚çš„ Web ç•Œé¢ç”¨äºç®¡ç† Application Dexï¼ˆå¯é€‰ï¼‰ ç”¨äºå®ç° SSO ç™»å½•çš„èº«ä»½è®¤è¯æœåŠ¡ ğŸ”§ æ”¯æŒçš„ Git ç±»å‹ä¸æ¨¡æ¿å·¥å…· # æ”¯æŒçš„ Git ä»“åº“ç±»å‹ï¼š # âœ… GitHub / GitHub Enterprise âœ… GitLab / GitLab Self-Hosted âœ… Bitbucket / Bitbucket Server âœ… Giteaã€Azure DevOps ç­‰ æ”¯æŒè®¤è¯æ–¹å¼ï¼šHTTPS/SSHã€Tokenã€ç”¨æˆ·åå¯†ç ç­‰\næ”¯æŒçš„é…ç½®æ¨¡æ¿æŠ€æœ¯ï¼š # ç±»å‹ æè¿° çº¯ K8s YAML æœ€ç®€å•çš„å£°æ˜å¼é…ç½® Kustomize åŸºäº overlay çš„é…ç½®ç®¡ç†ï¼Œé€‚åˆå¤šç¯å¢ƒ Helm æ¨¡æ¿åŒ–éƒ¨ç½²ï¼Œæ”¯æŒä¼ å€¼ã€åµŒå¥—æ¨¡æ¿ Jsonnet JSON-based ç¼–ç¨‹å¼é…ç½® æ’ä»¶æ–¹å¼ å¯è‡ªå®šä¹‰ parser å·¥å…·ï¼Œå¦‚ kptã€cdk8s ç­‰ ğŸ“š æ¨èé˜…è¯» # GitOps å®˜æ–¹å®šä¹‰ï¼š https://opengitops.dev Argo CD æ¶æ„æ–‡æ¡£ï¼š https://argo-cd.readthedocs.io/en/stable/operator-manual/architecture/ GitOps vs CI/CD åšå®¢ï¼šhttps://www.weave.works/blog/gitops-operations-by-pull-request "},{"id":42,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-event/introduce/","title":"introduce","section":"argo event","content":" ğŸ“¡ Argo Events æ¶æ„ç†è§£ # Argo Events æ˜¯ Argo é¡¹ç›®çš„ä¸€ä¸ªäº‹ä»¶é©±åŠ¨å¼•æ“ï¼Œä¸“ä¸º Kubernetes åŸç”Ÿç¯å¢ƒè®¾è®¡ï¼Œæ”¯æŒé€šè¿‡å¤–éƒ¨äº‹ä»¶è‡ªåŠ¨è§¦å‘å·¥ä½œæµã€éƒ¨ç½²ã€ä»»åŠ¡æ‰§è¡Œç­‰åŠ¨ä½œï¼Œæ˜¯æ„å»º GitOps è‡ªåŠ¨åŒ–çš„å…³é”®å·¥å…·ä¹‹ä¸€ã€‚\nâœ… æ ¸å¿ƒæ¦‚å¿µ # 1. EventSource # å®šä¹‰äº‹ä»¶æ¥æºï¼ˆä¾‹å¦‚ Webhookã€S3 ä¸Šä¼ ã€Kafka æ¶ˆæ¯ã€Cron è®¡åˆ’ä»»åŠ¡ç­‰ï¼‰ï¼ŒArgo Events ä¼šç›‘å¬è¿™äº›äº‹ä»¶æºå¹¶äº§ç”Ÿäº‹ä»¶ã€‚\napiVersion: argoproj.io/v1alpha1 kind: EventSource metadata: name: webhook-source spec: webhook: example: endpoint: /trigger method: POST port: 12000 2. Sensor # Sensor ç›‘å¬ EventSource çš„äº‹ä»¶ï¼Œå½“æ»¡è¶³è§¦å‘æ¡ä»¶æ—¶ï¼Œæ¿€æ´» Triggerã€‚å¯ä»¥è®¾ç½®ä¾èµ–å…³ç³»ã€æ¡ä»¶åˆ¤æ–­ã€‚\napiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: webhook-sensor spec: dependencies: - name: example-dep eventSourceName: webhook-source eventName: example triggers: - template: name: trigger-workflow k8s: group: argoproj.io version: v1alpha1 resource: workflows operation: create source: resource: apiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: triggered-wf- spec: entrypoint: whalesay templates: - name: whalesay container: image: docker/whalesay command: [cowsay] args: [\u0026#34;Hello from event\u0026#34;] 3. Trigger # æŒ‡å®šäº‹ä»¶è§¦å‘åçš„è¡Œä¸ºï¼Œä¾‹å¦‚å¯åŠ¨ Argo Workflowã€Kubernetes Jobã€å‘é€é€šçŸ¥ç­‰ã€‚æ”¯æŒæ¨¡æ¿åŒ–ã€å‚æ•°æ³¨å…¥ã€æ¡ä»¶è§¦å‘ç­‰å¤æ‚é€»è¾‘ã€‚\nğŸ”„ æ”¯æŒçš„è§¦å‘å™¨ç±»å‹ # ç±»å‹ æè¿° webhook æ¥æ”¶ HTTP è¯·æ±‚ï¼ˆå¦‚ GitLab Pushã€Jenkins é€šçŸ¥ï¼‰ s3 / minio æ–‡ä»¶ä¸Šä¼ è§¦å‘å·¥ä½œæµï¼ˆä¾‹å¦‚æ—¥å¿—ã€æ¨¡å‹ï¼‰ kafka / nats é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥è§¦å‘æµç¨‹ calendar / cron å®šæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œä»£æ›¿ CronWorkflow file æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå˜åŒ–è§¦å‘ resource ç›‘å¬ Kubernetes å¯¹è±¡å˜åŒ–ï¼ˆå¦‚ Pod çŠ¶æ€ï¼‰ amqp, mqtt, sqslike ä¼ä¸šé›†æˆå¸¸ç”¨æ¶ˆæ¯æº slack æ¶ˆæ¯è§¦å‘è‡ªåŠ¨å“åº”ï¼ˆå¦‚ bot æµç¨‹ï¼‰ å®Œæ•´æ”¯æŒåˆ—è¡¨å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://argoproj.github.io/argo-events/sources/\nğŸ§© æ¶æ„å›¾ # æ¶æ„ç®€è¦è¯´æ˜ # ç»„ä»¶ åŠŸèƒ½ EventSource Controller åˆ›å»ºå¹¶ç›‘å¬äº‹ä»¶æ¥æº Sensor Controller æ£€æµ‹äº‹ä»¶æ˜¯å¦æ»¡è¶³è§¦å‘æ¡ä»¶ EventBusï¼ˆNATSï¼‰ å†…éƒ¨äº‹ä»¶æ€»çº¿ï¼ˆå¯é€‰ï¼‰ç”¨äºå¼‚æ­¥è§£è€¦ Trigger Handler æ‰§è¡Œå…·ä½“çš„è§¦å‘æ“ä½œï¼ˆå¦‚åˆ›å»º Workflowï¼‰ ğŸ“š æ¨èèµ„æ–™ # å®˜æ–¹æ–‡æ¡£ï¼šhttps://argoproj.github.io/argo-events/ GitHubï¼šhttps://github.com/argoproj/argo-events ç¤ºä¾‹åˆé›†ï¼šhttps://github.com/argoproj/argo-events/tree/master/examples "},{"id":43,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-rollout/introduce/","title":"introduce","section":"argo rollout","content":" ğŸš€ Argo Rollouts æ¦‚è¿°ä¸å‘å¸ƒç­–ç•¥ # âœ… ä»€ä¹ˆæ˜¯ Argo Rolloutsï¼Ÿ # Argo Rollouts æ˜¯ä¸€ä¸ª Kubernetes æ§åˆ¶å™¨ï¼Œç”¨äºå®ç°é«˜çº§çš„éƒ¨ç½²ç­–ç•¥ï¼Œå¦‚ï¼š\nè“ç»¿éƒ¨ç½²ï¼ˆBlue-Green Deploymentï¼‰ é‡‘ä¸é›€å‘å¸ƒï¼ˆCanary Releaseï¼‰ å®éªŒåˆ†æï¼ˆAnalysis Runï¼‰ æ”¯æŒè‡ªåŠ¨å›æ»šã€æ‰‹åŠ¨æ¨è¿›ã€AB æµ‹è¯•ç­‰èƒ½åŠ› å®ƒæ˜¯å¯¹åŸç”Ÿ Kubernetes Deployment çš„å¢å¼ºç‰ˆï¼Œæä¾›æ›´ç²¾ç»†çš„å‘å¸ƒæ§åˆ¶ä¸è§‚å¯Ÿèƒ½åŠ›ã€‚\nğŸ”„ Deployment vs Rollout # ç‰¹æ€§ Kubernetes Deployment Argo Rollouts åŸºæœ¬æ»šåŠ¨æ›´æ–° âœ… æœ‰ âœ… æœ‰ è“ç»¿å‘å¸ƒ âŒ æ—  âœ… æ”¯æŒ é‡‘ä¸é›€å‘å¸ƒ âŒ æ—  âœ… æ”¯æŒ æ‰‹åŠ¨æ§åˆ¶å‘å¸ƒé˜¶æ®µ âŒ æ—  âœ… æ”¯æŒ è‡ªåŠ¨åˆ†æå¹¶å†³ç­– âŒ æ—  âœ… æ”¯æŒ ç‰ˆæœ¬å¯¹æ¯”å’Œè§‚å¯Ÿçª—å£ âŒ æ—  âœ… æ”¯æŒ æŒ‡æ ‡åˆ¤æ–­ï¼ˆPrometheus ç­‰ï¼‰ âŒ æ—  âœ… æ”¯æŒ Web UI æ”¯æŒ âŒ æ—  âœ… æœ‰ï¼ˆArgo Rollouts UI æ’ä»¶ï¼‰ å®éªŒ/AB æµ‹è¯• âŒ æ—  âœ… æ”¯æŒ ğŸš¦ æ”¯æŒçš„å‘å¸ƒç­–ç•¥ # 1. é‡‘ä¸é›€å‘å¸ƒï¼ˆCanaryï¼‰ # å°†æ–°ç‰ˆæœ¬æµé‡é€æ­¥æ”¾é‡ï¼Œæ¯”å¦‚ 10% -\u0026gt; 30% -\u0026gt; 100%ï¼Œæ¯ä¸ªé˜¶æ®µå¯é€šè¿‡ metrics åˆ†æåˆ¤æ–­æ˜¯å¦æ¨è¿›ã€‚\nstrategy: canary: steps: - setWeight: 10 - pause: {duration: 1m} - setWeight: 50 - pause: {} 2. è“ç»¿éƒ¨ç½²ï¼ˆBlue-Greenï¼‰ # éƒ¨ç½²æ–°ç‰ˆæœ¬äºâ€œé¢„è§ˆâ€ç¯å¢ƒï¼Œæ‰‹åŠ¨æˆ–è‡ªåŠ¨åˆ‡æ¢æµé‡ã€‚\nstrategy: blueGreen: activeService: my-app-active previewService: my-app-preview autoPromotionEnabled: false 3. å®éªŒåˆ†æï¼ˆAnalysis Runï¼‰ # å¯æ’å…¥ Prometheus/Datadog/New Relic ç­‰æŒ‡æ ‡å¹³å°ï¼Œè¿›è¡Œè‡ªåŠ¨åŒ–åˆ¤æ–­æ˜¯å¦å›æ»šæˆ–æ¨è¿›ã€‚\nanalysis: templates: - name: success-rate-check metrics: - name: error-rate provider: prometheus: query: rate(http_requests_total{status=~\u0026#34;5..\u0026#34;}[1m]) ğŸ§© Argo Rollouts æ¶æ„å›¾ # å…³é”®ç»„ä»¶è¯´æ˜ï¼š # ç»„ä»¶ è¯´æ˜ Rollout Controller æ§åˆ¶å™¨æ ¸å¿ƒï¼Œæ›¿ä»£åŸç”Ÿ Deployment æ§åˆ¶å™¨ Rollout CRD å®šä¹‰æ›¿ä»£ Deployment çš„é«˜çº§å¯¹è±¡ AnalysisRun æ‰§è¡Œåˆ†ææ¨¡æ¿ã€è¿æ¥å¤–éƒ¨æŒ‡æ ‡æº Experiment å¹¶è¡Œéƒ¨ç½²å¤šä¸ªç‰ˆæœ¬ï¼Œç”¨äº AB æµ‹è¯• UI æ’ä»¶ å¯é›†æˆè‡³ Argo CD è§‚å¯Ÿ rollout çŠ¶æ€ ğŸ“š æ¨èé˜…è¯» # å®˜æ–¹æ–‡æ¡£ï¼šhttps://argo-rollouts.readthedocs.io/ GitHub é¡¹ç›®ï¼šhttps://github.com/argoproj/argo-rollouts ç¤ºä¾‹ YAMLï¼šhttps://github.com/argoproj/argo-rollouts/tree/master/examples "},{"id":44,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-workflow/introduce/","title":"introduce","section":"argo workflow","content":" ğŸ“˜ Argo Workflows åŸºç¡€æ¦‚å¿µ # âœ… Argo Workflows æ˜¯ä»€ä¹ˆï¼Ÿ # Argo Workflows æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Kubernetes ä¸Šè¿è¡Œ å®¹å™¨åŒ–å·¥ä½œæµ çš„å¼€æºå·¥å…·ã€‚å®ƒå…è®¸ä½ é€šè¿‡è‡ªå®šä¹‰çš„ YAML æ–‡ä»¶ï¼Œå®šä¹‰ä¸€ç³»åˆ—ä»»åŠ¡çš„æ‰§è¡Œæµç¨‹ï¼Œè¿™äº›ä»»åŠ¡ä»¥å®¹å™¨çš„å½¢å¼è¿è¡Œï¼Œå¹¶å¯ä»¥é€šè¿‡æ­¥éª¤æˆ–ä¾èµ–é¡ºåºè¿›è¡Œç¼–æ’ã€‚\nå®ƒä¸»è¦ç”¨äºï¼š\nCI/CD æµç¨‹ç¼–æ’ æ•°æ®å¤„ç†æµæ°´çº¿ è‡ªåŠ¨åŒ–æµ‹è¯•ä»»åŠ¡ æ‰¹å¤„ç†ä½œä¸šè¿è¡Œ æœºå™¨å­¦ä¹ ä»»åŠ¡æ‰§è¡Œï¼ˆå¦‚ Kubeflow Pipelinesï¼‰ Argo Workflows é€šè¿‡ CRDï¼ˆè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼‰æ‰©å±•äº† Kubernetesï¼ŒåŸç”Ÿé›†æˆåœ¨é›†ç¾¤ä¸­è¿è¡Œï¼Œæ— éœ€å¼•å…¥å¤–éƒ¨æœåŠ¡ã€‚\nğŸ”§ åŸºæœ¬æœ¯è¯­è§£é‡Š # æœ¯è¯­ å«ä¹‰ Workflow å·¥ä½œæµçš„å®ä¾‹ï¼Œæ˜¯ä»»åŠ¡çš„è¿è¡Œå•å…ƒ Template å¯å¤ç”¨çš„ä»»åŠ¡æ¨¡æ¿ï¼Œæ¯ä¸ª template å®šä¹‰ä¸€ä¸ªæ“ä½œ Step æŒ‡å®šä»»åŠ¡çš„é¡ºåºæ‰§è¡Œé€»è¾‘ DAG æœ‰å‘æ— ç¯å›¾ï¼Œç”¨äºå®šä¹‰ä»»åŠ¡ä¹‹é—´çš„ä¾èµ– Parameter å‚æ•°å˜é‡ï¼Œå…è®¸æ¨¡æ¿ä¼ å…¥æ•°æ® Artifact æ–‡ä»¶æˆ–æ•°æ®å¯¹è±¡ï¼Œåœ¨ä»»åŠ¡ä¹‹é—´ä¼ é€’æˆ–ä¿å­˜ç»“æœ Entrypoint å®šä¹‰ Workflow çš„èµ·å§‹æ¨¡æ¿ WorkflowTemplate å¯ä»¥å…¨å±€å¤ç”¨çš„æ¨¡æ¿å®šä¹‰ï¼ˆè·¨ Workflow å…±äº«ï¼‰ ç¤ºæ„ç»“æ„ï¼š\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: hello-world- spec: entrypoint: hello templates: - name: hello container: image: alpine:3.7 command: [\u0026#34;echo\u0026#34;] args: [\u0026#34;hello world\u0026#34;] ğŸ§© Argo Workflows æ¶æ„ç»„ä»¶ # ç»„ä»¶ ä½œç”¨ Workflow Controller æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œç›‘å¬å¹¶è°ƒåº¦ Workflow çš„æ¯ä¸€æ­¥ä»»åŠ¡ argo-server (UI Server) æä¾› Web UI ç®¡ç†ç•Œé¢ï¼Œå¯æŸ¥çœ‹æ‰§è¡ŒçŠ¶æ€ã€æ—¥å¿— CRD åŒ…æ‹¬ Workflowã€WorkflowTemplateã€CronWorkflow ç­‰èµ„æºï¼Œæ‰©å±• Kubernetes Executor Sidecar å®¹å™¨ï¼Œè´Ÿè´£æ‰§è¡Œæ¯ä¸ªä»»åŠ¡çš„å‘½ä»¤å¹¶æŠ¥å‘ŠçŠ¶æ€ Artifact Repository ä»»åŠ¡ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼ˆå¦‚ S3ã€OSSã€PVCï¼‰ ğŸ“š æ¨èå­¦ä¹ èµ„æº # å®˜ç½‘æ–‡æ¡£ï¼š https://argoproj.github.io/argo-workflows GitHub é¡¹ç›®ï¼š https://github.com/argoproj/argo-workflows æ ·ä¾‹åº“ï¼š https://github.com/argoproj/argo-workflows/tree/master/examples "},{"id":45,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/backstage/introduce/","title":"introduce","section":"Backstage","content":" Backstage è¯¦è§£ä»‹ç» # ğŸ¯ ä»€ä¹ˆæ˜¯ Backstageï¼Ÿ # Backstage æ˜¯ç”± Spotify å¼€æºçš„å¼€å‘è€…é—¨æˆ·å¹³å°æ¡†æ¶ï¼Œç”¨äºæ„å»ºé›†ä¸­åŒ–çš„å¼€å‘è€…ä½“éªŒå¹³å°ï¼ˆDeveloper Portalï¼‰ï¼Œå¸®åŠ©ç»„ç»‡ç»Ÿä¸€ç®¡ç†è½¯ä»¶ç»„ä»¶ã€CI/CD æµç¨‹ã€ç›‘æ§å·¥å…·ã€æ–‡æ¡£ç­‰èµ„æºã€‚\nGitHub åœ°å€ï¼š https://github.com/backstage/backstage\nğŸ§  Backstage åŸç†ä¸æ¶æ„ # Backstage åŸºäºæ’ä»¶æ¶æ„ï¼Œæä¾›ç»Ÿä¸€çš„ UI ç•Œé¢æ¥èšåˆä¸åŒçš„å¼€å‘å·¥å…·å’Œèµ„æºã€‚å…¶æ ¸å¿ƒåŸç†ä¸ºï¼š\nè½¯ä»¶ç›®å½•ï¼ˆSoftware Catalogï¼‰ï¼šæ³¨å†Œç®¡ç†ç»„ç»‡å†…çš„æ‰€æœ‰è½¯ä»¶ç»„ä»¶ï¼ˆå¦‚å¾®æœåŠ¡ã€åº“ã€æ–‡æ¡£ç­‰ï¼‰ã€‚ æ’ä»¶æœºåˆ¶ï¼šé€šè¿‡æ’ä»¶ç³»ç»Ÿå®ç°åŠŸèƒ½æ‰©å±•ï¼Œå¦‚ CI/CDã€ç›‘æ§ã€API ç®¡ç†ç­‰ã€‚ ç»Ÿä¸€çš„ UI ç•Œé¢ï¼šåŸºäº React æ„å»ºï¼Œé€šè¿‡æ’ä»¶åŠ¨æ€æ¸²æŸ“å†…å®¹ã€‚ é…ç½®é©±åŠ¨ï¼šåŸºäº YAML æ–‡ä»¶é…ç½®è½¯ä»¶ç»„ä»¶å…ƒæ•°æ®ã€‚ +---------------------+ | Developer | +---------------------+ | v +---------------------+ +---------------------+ | Backstage Frontend | \u0026lt;-----\u0026gt; | Backstage Backend | +---------------------+ +---------------------+ | | v v +----------------+ +--------------------------+ | Plugins | | Software Catalog + Auth | +----------------+ +--------------------------+ | v +---------------------------+ | External Tools (CI/CD, | | Monitoring, Docs, etc.) | +---------------------------+ ğŸ§© æ ¸å¿ƒåŠŸèƒ½æ¨¡å— # è½¯ä»¶ç›®å½•ï¼ˆCatalogï¼‰ï¼šé›†ä¸­æ³¨å†Œå’Œç®¡ç†æ‰€æœ‰ç»„ä»¶ã€‚ TechDocsï¼šæ”¯æŒä»¥ Markdown ä¸ºåŸºç¡€çš„æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆå’Œå±•ç¤ºã€‚ CI/CD é›†æˆï¼šæ”¯æŒ Jenkinsã€GitHub Actionsã€GitLab ç­‰ã€‚ ç›‘æ§å¯è§†åŒ–ï¼šé›†æˆ Grafanaã€Prometheusã€Sentry ç­‰å·¥å…·ã€‚ æƒé™æ§åˆ¶ï¼šæ”¯æŒ RBACã€LDAPã€OAuth ç­‰ã€‚ ğŸ§± æŠ€æœ¯æ ˆ # ç»„ä»¶ æŠ€æœ¯ å‰ç«¯ React + TypeScript åç«¯ Node.js + Express æ’ä»¶ç³»ç»Ÿ æ’ä»¶åŸºäº React å’Œ Node æ„å»º é…ç½®ç®¡ç† YAML éƒ¨ç½² æ”¯æŒ Docker / Kubernetes ğŸ”Œ æ’ä»¶æœºåˆ¶ # Backstage æ’ä»¶åˆ†ä¸ºä¸¤ç§ï¼š\nå‰ç«¯æ’ä»¶ï¼šæä¾› UI åŠŸèƒ½ï¼Œç‹¬ç«‹æ¨¡å—åŒ–ã€‚ åç«¯æ’ä»¶ï¼šä¸å¤–éƒ¨æœåŠ¡äº¤äº’ï¼Œå¦‚æ•°æ®åº“ã€CI æœåŠ¡ç­‰ã€‚ å¯ä»¥é€šè¿‡ npx @backstage/create-app å¿«é€Ÿåˆå§‹åŒ–æ’ä»¶å’Œé¡¹ç›®ã€‚\nğŸš€ éƒ¨ç½²æ–¹å¼ # æ”¯æŒä»¥ä¸‹éƒ¨ç½²æ–¹å¼ï¼š\nDocker Compose Kubernetesï¼ˆHelm Charts å¯ç”¨ï¼‰ é™æ€æ–‡ä»¶ + Node åç«¯æœåŠ¡ ğŸŒ ä½¿ç”¨åœºæ™¯ # å¤šå›¢é˜Ÿåä½œç»Ÿä¸€å…¥å£ DevOps å·¥å…·é›†æˆ å†…éƒ¨æœåŠ¡å‘ç°ä¸æ²»ç† è‡ªåŠ¨åŒ–æ–‡æ¡£å¹³å° å¾®æœåŠ¡æ²»ç†é—¨æˆ· ğŸŒ ç¤¾åŒºä¸ç”Ÿæ€ # æä¾›ä¸°å¯Œçš„å®˜æ–¹æ’ä»¶ æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶å¸‚åœº ä¸ CNCF ç­‰ç¤¾åŒºåˆä½œç´§å¯† ğŸ“š å‚è€ƒæ–‡æ¡£ # å®˜æ–¹æ–‡æ¡£ï¼šhttps://backstage.io/docs æ’ä»¶å¸‚åœºï¼šhttps://backstage.io/plugins "},{"id":46,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/certmanager/introduce/","title":"introduce","section":"CertManager","content":" cert-manager ä»‹ç»ä¸åŸç†æ–‡æ¡£ # ä¸€ã€ä»€ä¹ˆæ˜¯ cert-managerï¼Ÿ # cert-manager æ˜¯ä¸€ä¸ª Kubernetes æ’ä»¶ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç®¡ç†å’Œé¢å‘ TLS è¯ä¹¦ã€‚å®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·ä»å¤šä¸ªè¯ä¹¦é¢å‘æœºæ„ï¼ˆå¦‚ Let\u0026rsquo;s Encryptã€HashiCorp Vaultã€è‡ªå»º CAï¼‰è‡ªåŠ¨è¯·æ±‚å’Œç»­ç­¾è¯ä¹¦ï¼Œä»è€Œç¡®ä¿é›†ç¾¤ä¸­çš„æœåŠ¡é€šä¿¡å®‰å…¨ã€‚\nå®˜ç½‘åœ°å€ï¼šhttps://cert-manager.io/\näºŒã€ä½œç”¨ # è‡ªåŠ¨åŒ– TLS è¯ä¹¦ç”³è¯·å’Œç»­æœŸ æ”¯æŒå¤šç§ Issuerï¼ˆé¢å‘è€…ï¼‰ç±»å‹ï¼Œå¦‚ ACMEï¼ˆLet\u0026rsquo;s Encryptï¼‰ã€CAã€Vault ç­‰ ç»Ÿä¸€ Kubernetes ä¸­è¯ä¹¦çš„ç®¡ç†æ–¹å¼ é…åˆ Ingress æ§åˆ¶å™¨ä½¿ç”¨ï¼Œå®ç° HTTPS è‡ªåŠ¨åŒ– ä¸ Kubernetes åŸç”Ÿå¯¹è±¡é›†æˆï¼Œå¦‚ Secretã€Ingressã€Service ç­‰ ä¸‰ã€æ ¸å¿ƒæ¦‚å¿µ # åç§° è¯´æ˜ Issuer è¡¨ç¤ºä¸€ä¸ªè¯ä¹¦é¢å‘è€…ï¼Œå¯ä¸ºå‘½åç©ºé—´çº§åˆ«æˆ–å…¨å±€ï¼ˆClusterIssuerï¼‰ Certificate è¡¨ç¤ºä¸€ä¸ªè¯ä¹¦è¯·æ±‚ï¼Œcert-manager ä¼šæ®æ­¤å»ç”³è¯·è¯ä¹¦å¹¶ç”Ÿæˆ Secret Challenge ACME åè®®ä¸­çš„æ ¡éªŒæŒ‘æˆ˜è¿‡ç¨‹ï¼Œç”¨äºéªŒè¯åŸŸåæ‰€æœ‰æƒ Order ä¸€ä¸ª ACME åè®®ä¸­å‘èµ·çš„è¯ä¹¦ç”³è¯·è®¢å• Secret å­˜å‚¨é¢å‘åçš„è¯ä¹¦å’Œç§é’¥ï¼Œç”¨äºæŒ‚è½½åˆ° Pod æˆ–é…ç½®åˆ° Ingress ä¸­ å››ã€å·¥ä½œåŸç† # äº”ã€æ¶æ„å›¾ï¼ˆMermaidï¼‰ # graph TD A[User / YAML] --\u0026gt;|Create Certificate| B[cert-manager Controller] B --\u0026gt; C[Check Issuer or ClusterIssuer] C --\u0026gt; D{Issuer Type} D --\u0026gt;|ACME| E[ACME Solver] E --\u0026gt; F[Challenge + Order] F --\u0026gt; G[ACME CA (e.g., Let\u0026#39;s Encrypt)] D --\u0026gt;|CA / Vault| H[Internal CA / Vault API] G --\u0026gt; I[Signed Certificate] H --\u0026gt; I I --\u0026gt; J[Secret Created / Updated] J --\u0026gt; K[Used by Ingress / Pod] å…­ã€å¸¸è§ä½¿ç”¨åœºæ™¯ # é…åˆ NGINX Ingress Controller å®ç°è‡ªåŠ¨ HTTPS è‡ªåŠ¨é¢å‘å’Œç»­æœŸ Pod ä¹‹é—´ mTLS æ‰€éœ€çš„è¯ä¹¦ å¯¹æ¥å†…éƒ¨ CAï¼Œæä¾›å¯ä¿¡ä»»çš„å†…éƒ¨è¯ä¹¦ç­¾å‘æœåŠ¡ ä¸ Vault é›†æˆï¼Œå®ç°é«˜åº¦å®‰å…¨çš„è¯ä¹¦å­˜å‚¨å’Œè®¿é—® ä¸ƒã€å‚è€ƒèµ„æº # cert-manager å®˜æ–¹æ–‡æ¡£ Kubernetes Ingress TLS é…ç½®æŒ‡å— "},{"id":47,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/cilium/introduce/","title":"introduce","section":"Cilium","content":" ğŸš€ Cilium ç®€ä»‹ã€æ¶æ„ä¸ä½œç”¨ # ğŸ“Œ ä¸€ã€Cilium æ˜¯ä»€ä¹ˆï¼Ÿ # Cilium æ˜¯ä¸€ä¸ªåŸºäº eBPF æŠ€æœ¯æ„å»ºçš„äº‘åŸç”Ÿç½‘ç»œå’Œå®‰å…¨å¹³å°ï¼Œå®ƒä½œä¸º Kubernetes çš„ CNI æ’ä»¶ï¼Œæä¾›äº†é«˜æ€§èƒ½çš„å®¹å™¨ç½‘ç»œè¿æ¥ã€ç½‘ç»œå®‰å…¨ç­–ç•¥ã€æµé‡å¯è§‚æµ‹æ€§ä»¥åŠ Service Mesh èƒ½åŠ›ã€‚\nâœ¨ æ ¸å¿ƒç‰¹ç‚¹ï¼š # ğŸ§  åŸºäº Linux eBPF æŠ€æœ¯ï¼Œæ€§èƒ½ä¼˜å¼‚ã€æ— ä¾µå…¥ ğŸ” æ”¯æŒ L3/L4/L7 ç½‘ç»œç­–ç•¥ï¼ˆæ”¯æŒ HTTP/gRPC/Kafka ç­‰ï¼‰ â™»ï¸ æ— éœ€ Sidecar çš„ Service Mesh èƒ½åŠ› ğŸ‘€ å†…å»º Hubble å®ç°ç½‘ç»œæµé‡å¯è§†åŒ–ä¸è¿½è¸ª ğŸŒ æ”¯æŒå¤šé›†ç¾¤äº’è”ï¼ˆClusterMeshï¼‰ ğŸ—ï¸ äºŒã€Cilium æ¶æ„ # Cilium æ¶æ„ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªç»„ä»¶ç»„æˆï¼š\n1ï¸âƒ£ Cilium Agent # æ¯ä¸ª Node ä¸Šè¿è¡Œ ç®¡ç†å’Œç¼–è¯‘ eBPF ç¨‹åºï¼Œæ³¨å…¥åˆ°å†…æ ¸ å¤„ç†æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€ç­–ç•¥åŒæ­¥ç­‰ 2ï¸âƒ£ eBPF ç¨‹åºï¼ˆè¿è¡Œåœ¨å†…æ ¸ï¼‰ # æŒ‚è½½åœ¨ XDPã€TCã€Socket ç­‰é’©å­ç‚¹ä¸Š å®ç°æ•°æ®åŒ…çš„è§£æã€è¿‡æ»¤ã€é‡å®šå‘ã€è½¬å‘ æ€§èƒ½é«˜ï¼Œè¿è¡Œåœ¨å†…æ ¸æ€ 3ï¸âƒ£ Hubble # åŸºäº eBPF çš„å¯è§‚æµ‹æ€§å¹³å° æ”¶é›†ç½‘ç»œæµé‡äº‹ä»¶ã€DNSã€HTTP ç­‰ä¿¡æ¯ æä¾› CLI ä¸ UI å·¥å…·ï¼Œæ”¯æŒ Grafana é›†æˆ 4ï¸âƒ£ Cilium CLI # ç®¡ç†å·¥å…·ï¼Œæ”¯æŒå®‰è£…ã€è¯Šæ–­ã€ç­–ç•¥æµ‹è¯•ç­‰ 5ï¸âƒ£ Cilium Operator # æ§åˆ¶å¹³é¢ç»„ä»¶ï¼Œå¤„ç† CRDã€Kubernetes èµ„æºå˜æ›´ 6ï¸âƒ£ ClusterMeshï¼ˆå¤šé›†ç¾¤ï¼‰ # å®ç°å¤šä¸ª Kubernetes é›†ç¾¤ä¹‹é—´çš„ Pod äº’è” åŒæ­¥æœåŠ¡ã€ç­–ç•¥ã€èº«ä»½ä¿¡æ¯ ğŸ› ï¸ ä¸‰ã€Cilium çš„ä¸»è¦ä½œç”¨ # ğŸ“Œ åœºæ™¯ æè¿° ğŸ”— CNI æ’ä»¶ æä¾›å®¹å™¨ç½‘ç»œè¿æ¥ï¼Œæ”¯æŒ IPv4/IPv6ã€Overlayã€BGP ç­‰ ğŸ›¡ï¸ ç½‘ç»œå®‰å…¨ç­–ç•¥ æ”¯æŒä» L3ï¼ˆIPï¼‰åˆ° L7ï¼ˆHTTP Pathï¼‰çš„å¤šå±‚è®¿é—®æ§åˆ¶ ğŸ§© Service Mesh æ”¯æŒæ—  Sidecar æ¨¡å¼ï¼Œæ”¯æŒ mTLSã€L7 ç­–ç•¥ã€æµé‡æ§åˆ¶ ğŸ” å¯è§‚æµ‹æ€§ Hubble æä¾›æµé‡è¿½è¸ªã€æŒ‡æ ‡ã€è·¯å¾„åˆ†æç­‰åŠŸèƒ½ ğŸšª Egress Gateway ç²¾ç»†æ§åˆ¶ Pod çš„å‡ºå£è®¿é—®åœ°å€ä¸ IP ğŸŒ å¤šé›†ç¾¤é€šä¿¡ æ”¯æŒ ClusterMeshï¼Œå¤šä¸ªé›†ç¾¤å…±äº«ç½‘ç»œä¸ç­–ç•¥ ğŸ“ˆ å››ã€é€‚ç”¨åœºæ™¯ # ğŸš€ æ„å»ºé«˜æ€§èƒ½ Kubernetes ç½‘ç»œå¹³å° ğŸ§µ å¯¹æœåŠ¡é—´é€šä¿¡è¿›è¡Œç²¾ç»†åŒ–æ§åˆ¶ï¼ˆå¦‚ L7 HTTP ç­–ç•¥ï¼‰ ğŸ§¼ æ›¿ä»£ä¼ ç»Ÿ Service Mesh å®ç°é›¶ Sidecar åŒ– ğŸ›¡ï¸ æ„å»ºé›¶ä¿¡ä»»ç½‘ç»œæ¶æ„ï¼ˆmTLS + ç­–ç•¥ï¼‰ ğŸ”„ è·¨é›†ç¾¤ç½‘ç»œç®¡ç† ğŸ§ª ç½‘ç»œè§‚æµ‹ã€è°ƒè¯•ä¸å®‰å…¨å®¡è®¡ ğŸ§¾ äº”ã€æ€»ç»“ # Cilium æ˜¯ä¸€ä¸ªé›†ç½‘ç»œè¿æ¥ã€å®‰å…¨ç­–ç•¥ã€å¯è§†åŒ–ä¸æœåŠ¡ç½‘æ ¼åŠŸèƒ½äºä¸€ä½“çš„ç°ä»£åŒ–å¹³å°ï¼Œç‰¹åˆ«é€‚åˆå¯¹æ€§èƒ½ã€å®‰å…¨ã€å¯è§‚æµ‹æ€§æœ‰è¾ƒé«˜è¦æ±‚çš„ç”Ÿäº§é›†ç¾¤ç¯å¢ƒã€‚å‡­å€Ÿ eBPF æŠ€æœ¯ä¼˜åŠ¿ï¼ŒCilium æ­£é€æ¸æˆä¸ºä¸‹ä¸€ä»£ Kubernetes ç½‘ç»œæ ‡å‡†çš„æœ‰åŠ›ç«äº‰è€…ã€‚\n"},{"id":48,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/operate/","title":"operate","section":"Kubernetes","content":"æ¬¢è¿ä½¿ç”¨kubernetes\n"},{"id":49,"href":"/docs/%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/","title":"åŠ¨æ€è§„åˆ’","section":"ç®—æ³•","content":"æœ¬ç« èŠ‚ä»‹ç»è´ªå¿ƒç®—æ³•\nåŸºæœ¬åŸç† # æœ€ä¼˜å­ç»“æ„ ä¸€ä¸ªé—®é¢˜çš„æœ€ä¼˜è§£åŒ…å«å…¶å­é—®é¢˜çš„æœ€ä¼˜è§£ï¼Œæ¢å¥è¯è¯´ï¼Œé—®é¢˜çš„æœ€ä¼˜è§£å¯ä»¥é€šè¿‡å­é—®é¢˜çš„æœ€ä¼˜è§£æ¨åˆ°å‡ºæ¥ é‡å å­é—®é¢˜ åœ¨æ±‚è§£è¿‡ç¨‹ä¸­ï¼Œå­é—®é¢˜ä¼šè¢«å¤šæ¬¡é‡å¤è®¡ç®—ï¼ŒåŠ¨æ€è§„åˆ’é€šè¿‡å­˜å‚¨å­é—®é¢˜çš„è§£ï¼ˆé€šå¸¸ä½¿ç”¨è¡¨æ ¼æˆ–æ•°ç»„ï¼‰ï¼Œé¿å…é‡å¤è®¡ç®— é€‚ç”¨æ¡ä»¶ # æœ€ä¼˜åŒ–é—®é¢˜ï¼š èƒŒåŒ…é—®é¢˜ï¼ˆ0-1 èƒŒåŒ…ã€å®Œå…¨èƒŒåŒ…ï¼‰ æœ€çŸ­è·¯å¾„é—®é¢˜ï¼ˆFloyd-Warshall ç®—æ³•ï¼‰ æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰ æœ€å¤§å­æ•°ç»„å’Œ è®¡æ•°é—®é¢˜ï¼š ç»„åˆæ•°é—®é¢˜ è·¯å¾„è®¡æ•°é—®é¢˜ åºåˆ—é—®é¢˜ï¼š æ–æ³¢é‚£å¥‘æ•°åˆ— ç¼–è¾‘è·ç¦»ï¼ˆLevenshtein è·ç¦»ï¼‰ æ­¥éª¤ # å®šä¹‰çŠ¶æ€ æ˜ç¡®é—®é¢˜çš„çŠ¶æ€è¡¨ç¤ºï¼Œé€šå¸¸ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡æè¿°é—®é¢˜çš„å­é—®é¢˜ ç¡®å®šçŠ¶æ€è½¬ç§»æ–¹ç¨‹ æ‰¾åˆ°çŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼Œå³å¦‚ä½•ä»å­é—®é¢˜çš„è§£æ¨å¯¼å‡ºå½“å‰é—®é¢˜çš„è§£ åˆå§‹åŒ– ç¡®å®šåˆå§‹çŠ¶æ€çš„å€¼ï¼Œé€šå¸¸é—®é¢˜çš„æœ€å°è§„æ¨¡æƒ…å†µ è®¡ç®—é¡ºåº æŒ‰ç…§ä¸€å®šçš„é¡ºåºè®¡ç®—çŠ¶æ€ï¼Œé€šå¸¸æ˜¯è‡ªåº•å‘ä¸Šï¼ˆä»æœ€å°å­é—®é¢˜å¼€å§‹ï¼‰æˆ–è‡ªé¡¶å‘ä¸‹ï¼ˆé€’å½’ + è®°å¿†åŒ–ï¼‰ è¿”å›ç»“æœ æ ¹æ®çŠ¶æ€æˆ–æ•°ç»„è¿”å›æœ€ç»ˆé—®é¢˜çš„è§£ ä¼˜åŒ– # ç©ºé—´ä¼˜åŒ–ï¼š å¦‚æœçŠ¶æ€è½¬ç§»æ–¹ç¨‹åªä¾èµ–äºå‰ä¸€ä¸ªçŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨æ»šåŠ¨æ•°ç»„æˆ–å˜é‡æ¥å‡å°‘ç©ºé—´å¤æ‚åº¦ã€‚ ä¾‹å¦‚ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—é—®é¢˜å¯ä»¥ä¼˜åŒ–ä¸ºåªä½¿ç”¨ä¸¤ä¸ªå˜é‡ã€‚ è®°å¿†åŒ–æœç´¢ï¼š è‡ªé¡¶å‘ä¸‹çš„é€’å½’æ–¹æ³•ï¼Œé€šè¿‡ç¼“å­˜å­é—®é¢˜çš„è§£æ¥é¿å…é‡å¤è®¡ç®—ã€‚ "},{"id":50,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/operate/%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BAkubeconfig/","title":"å¦‚ä½•åˆ›å»ºkubeConfig","section":"operate","content":" å¦‚ä½•åˆ›å»ºkubeConfig # åˆ›å»ºclusterRole kubectl create clusterrole monitor \u0026ndash;resource=prometheusrule \u0026ndash;verb=\u0026quot;*\u0026quot;\nåˆ›å»ºclusterRoleBinding kubectl create clusterrolebinding monitor \u0026ndash;clusterrole=rule \u0026ndash;user monitor\nç”Ÿæˆæ™®é€šç”¨æˆ·ä»¤ç‰Œ cd /etc/kubernetes/pki #ä½ çš„é›†ç¾¤è¯ä¹¦ç›®å½• user=monitor organization=monitoring clustername=cluster02 # ã€é›†ç¾¤åœ°å€ï¼Œä¾‹å¦‚ï¼šhttps://172.21.114.169:6443ã€‘ api_addr=https://192.168.31.208:6443 time_days=365 #å¤åˆ¶ç²˜è´´ä¸‹é¢çš„ä»£ç å³å¯ umask 077;openssl genrsa -out $user.key 2048 openssl req -new -key $user.key -out $user.csr -subj \u0026#34;/O=$organization/CN=$user\u0026#34; openssl x509 -req -in $user.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out $user.crt -days $time_days kubectl config set-cluster $clustername --server=$api_addr --certificate-authority=ca.crt --embed-certs=true --kubeconfig=/root/$user.config kubectl config set-credentials $user --client-certificate=$user.crt --client-key=$user.key --embed-certs=true --kubeconfig=/root/$user.config kubectl config set-context $user@$clustername --cluster=$clustername --user=$user --kubeconfig=/root/$user.config kubectl config use-context $user@$clustername --kubeconfig=/root/$user.config "},{"id":51,"href":"/docs/go/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","title":"æ•°æ®ç»“æ„","section":"Go","content":"æœ¬ç« èŠ‚ä»‹ç» golang çš„æ•°æ®ç»“æ„\n"},{"id":52,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/","title":"äº‘åŸç”Ÿ","section":"æ–‡æ¡£é¦–é¡µ","content":" ç”Ÿäº§ç¯å¢ƒäº‘åŸç”Ÿéƒ¨ç½²æ¶æ„å›¾ # æ¶æ„å›¾ï¼ˆæ–‡å­—ç‰ˆï¼‰ # +--------------------------------------------------------------------------------------------------------+ | Kubernetes é›†ç¾¤ | | | | +---------------------+ +-------------------+ +---------------------+ | | | Cilium CNI |\u0026lt;--\u0026gt;| NetworkPolicy/EBPF |\u0026lt;--\u0026gt;| Pod ç½‘ç»œé€šä¿¡ä¸å®‰å…¨ç­–ç•¥ | | | +---------------------+ +-------------------+ +---------------------+ | | | | +---------------------+ | | | cert-manager |----\u0026gt; è‡ªåŠ¨ç­¾å‘/ç»­æœŸ TLS è¯ä¹¦ï¼ˆæ•´åˆ ACME / Vault / Issuerï¼‰ | | +---------------------+ | | | | +---------------------+ | | | Keycloak |----\u0026gt; OIDC/SAML ç™»å½•è®¤è¯ï¼ˆæ•´åˆ ArgoCDã€Harborã€Grafana ç­‰ï¼‰ | | +---------------------+ | | | | +---------------------+ +---------------------+ | | | Harbor |\u0026lt;--\u0026gt; é•œåƒä»“åº“ï¼ˆç§æœ‰ä»“åº“ï¼Œç»“åˆ Keycloak OIDCï¼‰ | | | +---------------------+ +---------------------+ | | | | +----------------------+ +----------------------+ +---------------------------+ | | | Argo Workflows | | Argo CD | | Argo Events / Rollouts | | | | (CIæµæ°´çº¿è°ƒåº¦å™¨) | | (GitOps éƒ¨ç½²) | | ï¼ˆäº‹ä»¶é©±åŠ¨ / ç°åº¦å‘å¸ƒï¼‰ | | | +----------------------+ +----------------------+ +---------------------------+ | | â†‘ GitOpsè§¦å‘æ„å»º â†‘ ä»Gitæ‹‰å–åº”ç”¨éƒ¨ç½²é…ç½® â†‘ CRDs / äº‹ä»¶é©±åŠ¨CIæµç¨‹ | | | | +---------------------+ +---------------------+ +--------------------------+ | | | Prometheus |\u0026lt;---| Node Exporter / Kubelet |\u0026lt;-- Kubernetes æŒ‡æ ‡æ”¶é›† | | +---------------------+ +---------------------+ +--------------------------+ | | â†“ Alertmanager â†“ Grafana (é›†æˆKeycloakç™»å½•) | | å‘Šè­¦è§„åˆ™ä¸é€šçŸ¥ å¯è§†åŒ–ç›‘æ§é¢æ¿ | | | | +---------------------+ | | | Loki |\u0026lt;--- æ—¥å¿—æ”¶é›†ï¼ˆæ•´åˆ promtail / fluentbitï¼‰ | | +---------------------+ | | | +--------------------------------------------------------------------------------------------------------+ â˜ï¸ Cloud-Native Production Environment Architecture # ğŸ§© Central Platform: # ğŸ§± Kubernetes Cluster: Orchestrates containers and manages workloads. ğŸ› ï¸ Key Components: # ğŸ§‘â€ğŸ’» Backstage: Developer portal providing software catalog, CI/CD integration, documentation, and monitoring dashboards. ğŸ“¦ Harbor: Private container registry to manage container images securely. ğŸ•¸ï¸ Cilium: Provides networking, security policies, observability using eBPF technology. ğŸ” Cert-manager: Automates the issuance and renewal of TLS certificates. ğŸ›¡ï¸ Keycloak: Identity and access management system providing authentication and authorization. ğŸš€ Argo Suite: ğŸ“¥ Argo CD: GitOps continuous deployment tool. ğŸ” Argo Workflows: Workflow orchestration and CI pipelines. ğŸ§² Argo Events/Rollouts: Event-driven workflows and canary deployments. ğŸ“ˆ Prometheus: Monitoring and alerting toolkit. ğŸ“„ Loki: Log aggregation system for collecting and managing logs. ğŸ”— Integration and Interactions: # Backstage interacts with all components, providing a unified view for developers and administrators. Harbor is integrated with Kubernetes and Keycloak for secure image management. Cilium manages cluster networking, providing observability data to Prometheus. Cert-manager integrates with Kubernetes and Keycloak for automated certificate management. Keycloak provides centralized authentication services for Kubernetes, Backstage, Harbor, and Argo Suite. Argo Suite integrates with Kubernetes and Git repositories for streamlined deployments and CI/CD processes. Prometheus gathers metrics from all components, with dashboards presented via Backstage. Loki aggregates logs from Kubernetes and applications, accessible via dashboards. âœ¨ This architecture ensures scalability, security, observability, and ease of use for cloud-native application deployment and management.\n"},{"id":53,"href":"/docs/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%A0%91/2.-%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86/","title":"ä¸­åºéå†","section":"äºŒå‰æ ‘","content":" ä¸­åºéå† # å·¦å­æ ‘ â†’ æ ¹ â†’ å³å­æ ‘\nfunc inorderTraversal(root *TreeNode) []int { if root == nil { return []int{} } stack, res := []*TreeNode{}, []int{} cur := root for cur != nil \u0026amp;\u0026amp; len(stack) \u0026gt; 0 { for cur != nil { stack = append(stack, cur) cur = cur.Left } cur = stack[len(stack)-1] stack = stack[:len(stack)-1] res = append(res, cur.Val) cur = cur.Right } return res } "},{"id":54,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/operate/install/argo/","title":"argo","section":"install","content":"xxx\n"},{"id":55,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-cd/","title":"argo cd","section":"Argo","content":"ä»‹ç»ä½¿ç”¨argo cd\n"},{"id":56,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/certmanager/","title":"CertManager","section":"äº‘åŸç”Ÿ","content":"ä»‹ç»ä½¿ç”¨CertManager\n"},{"id":57,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/operate/kubelet/cri/containerd/","title":"containerd","section":"CRI","content":"ä»‹ç»ä½¿ç”¨containerdä½œä¸ºkubernetes CNIç½‘ç»œæ’ä»¶çš„ä½¿ç”¨\n"},{"id":58,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/operate/kubelet/cri/","title":"CRI","section":"operate","content":"ä»‹ç»ä½¿ç”¨containerdä½œä¸ºkubernetes CNIç½‘ç»œæ’ä»¶çš„ä½¿ç”¨\n"},{"id":59,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/develop/client-go/example/","title":"example","section":"client-go","content":" example code\nåˆ›å»ºCRD ç»“æ„ /pkg/apis/example/v1/types.go\ntype MyResource struct { metav1.TypeMeta `json:\u0026#34;,inline\u0026#34;` metav1.ObjectMeta `json:\u0026#34;metadata,omitempty\u0026#34;` Spec MyResourceSpec `json:\u0026#34;spec\u0026#34;` } // MyResourceSpec defines the desired state of MyResource type MyResourceSpec struct { Foo string `json:\u0026#34;foo\u0026#34;` Bar int `json:\u0026#34;bar\u0026#34;` } ä½¿ç”¨code-generator å·¥å…·è‡ªåŠ¨ç”ŸæˆclientSetã€informerã€lister bash hack/update-codegen.sh å®šä¹‰controller ç»“æ„ /pkg/controller/contronller.go\ntype Controller struct { kubeclientset kubernetes.Interface myresourceClientset clientset.Interface myresourceLister listers.MyResourceLister myresourceSynced cache.InformerSynced workqueue workqueue.TypedRateLimitingInterface[string] } åˆå§‹åŒ–controller /pkg/controller/contronller.go\nfunc NewController( kubeclientset kubernetes.Interface, myresourceClientset clientset.Interface, myresourceInformer v1.MyResourceInformer) *Controller { controller := \u0026amp;Controller{ kubeclientset: kubeclientset, myresourceClientset: myresourceClientset, myresourceLister: myresourceInformer.Lister(), myresourceSynced: myresourceInformer.Informer().HasSynced, workqueue: workqueue.NewTypedRateLimitingQueueWithConfig( workqueue.DefaultTypedControllerRateLimiter[string](), workqueue.TypedRateLimitingQueueConfig[string]{ Name: \u0026#34;my-controller\u0026#34;, }, ), } myresourceInformer.Informer().AddEventHandler(cache.ResourceEventHandlerFuncs{ AddFunc: controller.enqueueMyResource, UpdateFunc: func(old, new interface{}) { controller.enqueueMyResource(new) }, DeleteFunc: controller.enqueueMyResource, }) return controller } set up /metrics and /healthzæ¥å£ /pkg/controller/contronller.go\n// Set up metrics server http.Handle(\u0026#34;/metrics\u0026#34;, promhttp.Handler()) go func() { klog.Fatal(http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil)) }() // Set up health check server http.HandleFunc(\u0026#34;/healthz\u0026#34;, health.HealthCheck) go func() { klog.Fatal(http.ListenAndServe(\u0026#34;:8081\u0026#34;, nil)) }() ä½¿ç”¨leaderelection ç¼–å†™é«˜å¯ç”¨controller /cmd/my-controller.go\nlock := \u0026amp;resourcelock.LeaseLock{ LeaseMeta: metav1.ObjectMeta{ Name: leaseLockName, Namespace: leaseLockNamespace, }, Client: kubeClient.CoordinationV1(), LockConfig: resourcelock.ResourceLockConfig{ Identity: os.Getenv(\u0026#34;POD_NAME\u0026#34;), // Use the pod name as the identity }, } leaderelection.RunOrDie(context.TODO(), leaderelection.LeaderElectionConfig{ Lock: lock, ReleaseOnCancel: true, LeaseDuration: 15 * time.Second, RenewDeadline: 10 * time.Second, RetryPeriod: 2 * time.Second, Callbacks: leaderelection.LeaderCallbacks{ OnStartedLeading: func(ctx context.Context) { klog.Info(\u0026#34;Started leading\u0026#34;) informerFactory.Start(ctx.Done()) // Start the controller logic }, OnStoppedLeading: func() { klog.Info(\u0026#34;Stopped leading\u0026#34;) le \u0026lt;- struct{}{} }, OnNewLeader: func(identity string) { if identity == os.Getenv(\u0026#34;POD_NAME\u0026#34;) { klog.Info(\u0026#34;I am the leader\u0026#34;) } else { klog.Infof(\u0026#34;New leader elected: %s\u0026#34;, identity) } }, }, }) å¯åŠ¨controller /cmd/my-controller.go\nmyController.Run(2, ctx.Done()) ä¸šåŠ¡é€»è¾‘å†™åœ¨ pkg/controller/contronller.go\nfunc (c *Controller) syncHandler(key string) error { namespace, name, err := cache.SplitMetaNamespaceKey(key) if err != nil { runtime.HandleError(fmt.Errorf(\u0026#34;invalid resource key: %s\u0026#34;, key)) return nil } myresource, err := c.myresourceLister.MyResources(namespace).Get(name) if err != nil { if errors.IsNotFound(err) { runtime.HandleError(fmt.Errorf(\u0026#34;myresource \u0026#39;%s\u0026#39; in work queue no longer exists\u0026#34;, key)) return nil } return err } fmt.Printf(\u0026#34;Sync/Add/Update for MyResource %s\\n\u0026#34;, myresource.GetName()) return nil } "},{"id":60,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-cd/install/","title":"install","section":"argo cd","content":" ğŸš€ Argo CD + ApplicationSet å®‰è£…æŒ‡å—ï¼ˆç”Ÿäº§æ¨èï¼‰ # æœ¬æŒ‡å—åŒ…å« Argo CD ä¸ ApplicationSet Controller çš„å®Œæ•´å®‰è£…æµç¨‹ï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚\nâœ… ä¸€ã€å‡†å¤‡å·¥ä½œ # Kubernetes é›†ç¾¤ï¼ˆv1.21+ æ¨èï¼‰ Helm 3.x å…·å¤‡é›†ç¾¤ç®¡ç†å‘˜æƒé™ åŸŸåï¼ˆå¦‚ä½¿ç”¨ SSO æˆ– Ingressï¼‰ ğŸ§° äºŒã€æ·»åŠ  Argo Helm ä»“åº“ # helm repo add argo https://argoproj.github.io/argo-helm helm repo update ğŸ“¦ ä¸‰ã€å®‰è£… Argo CDï¼ˆå« ApplicationSetï¼‰ # helm install argocd argo/argo-cd --namespace argocd --create-namespace --set server.service.type=ClusterIP --set dex.enabled=true --set applicationset.enabled=true --set configs.params.server.insecure=false éªŒè¯æœåŠ¡çŠ¶æ€ # kubectl get pods -n argocd kubectl port-forward svc/argocd-server -n argocd 8080:443 è®¿é—® UI: https://localhost:8080\nè·å–åˆå§‹ admin å¯†ç  # kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\u0026#34;{.data.password}\u0026#34; | base64 -d ğŸ§© å››ã€ApplicationSet Controller ç®€ä»‹ # ApplicationSet å…è®¸ä½ æ‰¹é‡åˆ›å»ºå’ŒåŠ¨æ€ç”Ÿæˆå¤šä¸ª Applicationï¼Œé€‚ç”¨äºï¼š\nå¤šå¾®æœåŠ¡éƒ¨ç½² å¤šç¯å¢ƒ/å¤šé›†ç¾¤ GitOps è‡ªåŠ¨åŒ–ç”Ÿæˆ YAML åº”ç”¨èµ„æº å¸¸ç”¨ Generators åŒ…æ‹¬ï¼š\nGit Generatorï¼ˆæ ¹æ®ç›®å½•ç»“æ„ç”Ÿæˆï¼‰ List Generatorï¼ˆé™æ€å®šä¹‰å¤šä¸ªæœåŠ¡ï¼‰ Cluster Generatorï¼ˆä¸ºæ¯ä¸ªé›†ç¾¤ç”Ÿæˆä¸€ä¸ªåº”ç”¨ï¼‰ å®˜æ–¹æ–‡æ¡£ï¼šhttps://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/\nğŸ”’ äº”ã€å¯ç”¨ SSOï¼ˆå¯é€‰ï¼Œç”Ÿäº§å»ºè®®ï¼‰ # ä¿®æ”¹ argocd-cm å’Œ argocd-secret é…ç½®ï¼Œå¯ç”¨ OIDC/OAuth2 è®¤è¯ï¼ˆå¦‚ GitHubã€Dexã€Auth0ï¼‰ã€‚\nå®Œæ•´é…ç½®è§ç”Ÿäº§éƒ¨ç½²æ–‡æ¡£\ndata: oidc.config: | name: GitHub issuer: https://github.com/login/oauth clientID: YOUR_CLIENT_ID clientSecret: $oidc.github.clientSecret ğŸ“£ å…­ã€é›†æˆ Argo CD Notificationsï¼ˆå¯é€‰ï¼‰ # kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-notifications/stable/manifests/install.yaml æ·»åŠ é€šçŸ¥é€šé“ï¼ˆSlack/Webhook/Emailï¼‰å¹¶é…ç½® argocd-notifications-cm å’Œ Secretã€‚\nğŸ›¡ ä¸ƒã€ç”Ÿäº§éƒ¨ç½²å»ºè®® # ç±»åˆ« æ¨èåšæ³• é«˜å¯ç”¨æ€§ ä¸º controller/server è®¾ç½®å‰¯æœ¬æ•°ï¼Œä½¿ç”¨ LoadBalancer æˆ– Ingress å®‰å…¨æ€§ å¯ç”¨ SSOï¼Œç¦ç”¨é»˜è®¤ adminï¼Œé…ç½® RBAC å¤šé›†ç¾¤æ”¯æŒ æ³¨å†Œå¤šä¸ªé›†ç¾¤ï¼Œä½¿ç”¨ ApplicationSet è¿›è¡Œæ‰¹é‡ç®¡ç† å¯è§‚æµ‹æ€§ å¯ç”¨ Prometheusã€Grafana ç›‘æ§ èµ„æºéš”ç¦» ä½¿ç”¨ Argo CD Projects åŒºåˆ†ä¸šåŠ¡/ç¯å¢ƒ å­˜å‚¨ä¸å¤‡ä»½ æ‰€æœ‰ manifests å­˜å…¥ Gitï¼Œé…ç½®å®šæœŸå¤‡ä»½ ğŸ”— æ¨èæ–‡æ¡£ # Argo CD Helm Chartï¼šhttps://github.com/argoproj/argo-helm/tree/main/charts/argo-cd ApplicationSet ç¤ºä¾‹ï¼šhttps://github.com/argoproj-labs/applicationset Argo CD Operator Manualï¼šhttps://argo-cd.readthedocs.io/en/stable/operator-manual/ "},{"id":61,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-event/install/","title":"install","section":"argo event","content":" ğŸš€ Argo Events ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å— # æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•åœ¨ Kubernetes ä¸Šä»¥ç”Ÿäº§çº§é…ç½®éƒ¨ç½² Argo Eventsï¼Œç»“åˆ NATS ä½œä¸º EventBusã€Ingress æ›éœ² Webhookã€TLS å®‰å…¨ã€ä»¥åŠ Prometheus ç›‘æ§ç­‰å¢å¼ºåŠŸèƒ½ã€‚\nâœ… ä¸€ã€å®‰è£…å‰å‡†å¤‡ # Kubernetes 1.21+ é›†ç¾¤ å·²å®‰è£… Ingress Controllerï¼ˆå¦‚ NGINXï¼‰ å¯é€‰ç»„ä»¶ï¼šPrometheusã€Cert-Managerã€Argo Workflows ğŸ§± äºŒã€éƒ¨ç½² Argo Events æ§åˆ¶å™¨ + CRD # kubectl create ns argo-events kubectl apply -n argo-events -f https://github.com/argoproj/argo-events/releases/latest/download/install.yaml è¿™ä¼šå®‰è£…ï¼š\nCRDs: EventSource, Sensor, EventBus æ§åˆ¶å™¨ Deployment ğŸ“¡ ä¸‰ã€éƒ¨ç½² NATS EventBusï¼ˆé»˜è®¤æ¨èï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: EventBus metadata: name: default namespace: argo-events spec: nats: native: replicas: 3 auth: token containerTemplate: resources: requests: cpu: 100m memory: 128Mi åˆ›å»ºå‘½ä»¤ï¼š\nkubectl apply -f eventbus-nats.yaml ğŸŒ å››ã€æš´éœ² Webhook Sourceï¼ˆä½¿ç”¨ Ingress + TLSï¼‰ # EventSource ç¤ºä¾‹ï¼šWebhook # apiVersion: argoproj.io/v1alpha1 kind: EventSource metadata: name: webhook-source namespace: argo-events spec: service: ports: - port: 12000 targetPort: 12000 webhook: push: endpoint: /webhook method: POST port: 12000 é…ç½® Ingress # apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: events-webhook namespace: argo-events annotations: cert-manager.io/cluster-issuer: letsencrypt-prod spec: tls: - hosts: [events.example.com] secretName: webhook-cert rules: - host: events.example.com http: paths: - path: /webhook pathType: Prefix backend: service: name: webhook-source-eventsource-svc port: number: 12000 ğŸ” äº”ã€å®‰å…¨ä¸è®¤è¯å»ºè®® # ç±»åˆ« å»ºè®® æ¥å£è®¤è¯ ä½¿ç”¨ç½‘å…³æˆ– Ingress å±‚çš„ Basic Auth æˆ– JWT éªŒè¯ TLS åŠ å¯† ä½¿ç”¨ Cert-Manager è‡ªåŠ¨ç­¾å‘è¯ä¹¦ Secret åŠ å¯† ä½¿ç”¨ Sealed Secrets æˆ– External Secret ç®¡ç†å™¨ RBAC æœ€å°æƒé™ é™åˆ¶ Sensor æ§åˆ¶å™¨çš„è§’è‰²ä¸ºæœ€å°å¯è¿è¡Œæƒé™ ğŸ“ˆ å…­ã€ç›‘æ§ä¸å¯è§‚æµ‹æ€§ # å¯ç”¨ metrics # æ‰€æœ‰ Argo Events æ§åˆ¶å™¨é»˜è®¤æ”¯æŒ Prometheus metricsï¼Œå¯é€šè¿‡å¦‚ä¸‹é…ç½®æš´éœ²ç«¯å£ï¼š\nspec: containers: - name: sensor-controller ports: - name: metrics containerPort: 8080 Prometheus é…ç½®æŠ“å– # scrape_configs: - job_name: \u0026#39;argo-events\u0026#39; kubernetes_sd_configs: - role: pod relabel_configs: - source_labels: [__meta_kubernetes_pod_label_app] regex: argo-events action: keep ğŸ”„ ä¸ƒã€è‡ªåŠ¨è§¦å‘ Argo Workflows ç¤ºä¾‹ï¼ˆSensorï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: webhook-sensor namespace: argo-events spec: dependencies: - name: push eventSourceName: webhook-source eventName: push triggers: - template: name: start-workflow k8s: operation: create source: resource: apiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: triggered- spec: entrypoint: hello templates: - name: hello container: image: alpine command: [echo] args: [\u0026#34;Hello Argo Events\u0026#34;] âœ… æ€»ç»“éƒ¨ç½²è¦ç‚¹ # ç»„ä»¶ æ˜¯å¦å¿…é¡» è¯´æ˜ EventSource/Sensor Controller âœ… æ˜¯ äº‹ä»¶å¤„ç†æ ¸å¿ƒ EventBusï¼ˆNATSï¼‰ âœ… æ˜¯ é»˜è®¤æ¶ˆæ¯é€šé“ Ingress + Cert-Manager âœ… æ¨è Webhook å®‰å…¨æ¥å…¥ Prometheus â›” å¯é€‰ å¯è§‚æµ‹æ€§å¢å¼º Argo Workflows â›” å¯é€‰ å¦‚æœä½¿ç”¨ Events è§¦å‘ Workflow ğŸ“š æ¨èèµ„æº # Argo Events å®˜ç½‘ï¼šhttps://argoproj.github.io/argo-events/ EventBus ç±»å‹ï¼šhttps://argoproj.github.io/argo-events/eventbus/ ç¤ºä¾‹åˆé›†ï¼šhttps://github.com/argoproj/argo-events/tree/master/examples "},{"id":62,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-rollout/install/","title":"install","section":"argo rollout","content":" ğŸš€ Argo Rollouts ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å— # æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½² Argo Rolloutsï¼Œé›†æˆç›‘æ§ç³»ç»Ÿï¼Œå®ç°é‡‘ä¸é›€å‘å¸ƒã€è“ç»¿éƒ¨ç½²ã€è‡ªåŠ¨åˆ†æç­‰é«˜çº§å‘å¸ƒç­–ç•¥ã€‚\nâœ… ä¸€ã€ç»„ä»¶åŠŸèƒ½æ¦‚è§ˆ # ç»„ä»¶ è¯´æ˜ Rollouts Controller æ›¿ä»£åŸç”Ÿ Deployment æ§åˆ¶å™¨ï¼Œå®ç°é«˜çº§å‘å¸ƒç­–ç•¥ AnalysisRun è¿›è¡Œ Prometheus ç­‰æŒ‡æ ‡åˆ†æ Experiment æ”¯æŒ AB æµ‹è¯•å¯¹æ¯”éƒ¨ç½²æ•ˆæœ Argo Rollouts Kubectl Plugin ç”¨äº CLI ç®¡ç† Rollout çŠ¶æ€ Dashboard UIï¼ˆå¯é€‰ï¼‰ ä¸ Argo CD é›†æˆçš„ Rollouts æ’ä»¶ç•Œé¢ ğŸ§± äºŒã€éƒ¨ç½² Rollouts Controller # æ–¹æ³•ä¸€ï¼šå¿«é€Ÿå®‰è£…ï¼ˆå®˜æ–¹ YAMLï¼‰ # kubectl create namespace argo-rollouts kubectl apply -n argo-rollouts -f https://github.com/argoproj/argo-rollouts/releases/latest/download/install.yaml æ–¹æ³•äºŒï¼šä½¿ç”¨ Helmï¼ˆæ¨èç”Ÿäº§ï¼‰ # helm repo add argo https://argoproj.github.io/argo-helm helm repo update helm install argo-rollouts argo/argo-rollouts --namespace argo-rollouts --create-namespace --set controller.replicaCount=2 --set metrics.enabled=true --set dashboard.enabled=true ğŸ”§ ä¸‰ã€é…ç½® Prometheus é›†æˆï¼ˆæŒ‡æ ‡åˆ†ææ”¯æŒï¼‰ # Rollouts é»˜è®¤æ”¯æŒå°† AnalysisRun æ•°æ®è¾“å‡ºåˆ° Prometheusï¼Œç¤ºä¾‹é…ç½®ï¼š\nanalysis: templates: - name: success-rate-check metrics: - name: error-rate provider: prometheus: address: http://prometheus.monitoring.svc.cluster.local:9090 query: rate(http_requests_total{status=~\u0026#34;5..\u0026#34;}[1m]) Prometheus åœ°å€éœ€è¦ä¸ä½ é›†ç¾¤ä¸­å®é™…éƒ¨ç½²çš„æœåŠ¡åŒ¹é…ã€‚\nğŸ¨ å››ã€ä¸ Argo CD é›†æˆ UI # å¦‚æœä½ ä½¿ç”¨ Argo CDï¼Œå¹¶å¯ç”¨äº† Rollouts Dashboard æ’ä»¶ï¼Œå¯ä»¥åœ¨åº”ç”¨ä¸­çœ‹åˆ° Rollout çŠ¶æ€å›¾ï¼š\n--set dashboard.enabled=true # åœ¨ Helm å®‰è£…æ—¶å¯ç”¨ UI å¯å±•ç¤ºï¼šå½“å‰é˜¶æ®µã€é‡‘ä¸é›€æ¯”ä¾‹ã€æ´»åŠ¨æœåŠ¡/é¢„è§ˆæœåŠ¡ç­‰ä¿¡æ¯ã€‚\nğŸ›¡ï¸ äº”ã€ç”Ÿäº§éƒ¨ç½²å»ºè®® # åˆ†ç±» å»ºè®® é«˜å¯ç”¨æ€§ controller è®¾ç½®ä¸ºå¤šå‰¯æœ¬ï¼Œä½¿ç”¨ readiness/liveness probe å®‰å…¨æ€§ é™åˆ¶ namespace è®¿é—®æƒé™ï¼Œå®¡è®¡ AnalysisRun è¾“å‡º æ—¥å¿—åˆ†æ é…åˆ Loki/EFK æ”¶é›† controller æ—¥å¿— æŒ‡æ ‡åˆ†æ å¼ºçƒˆå»ºè®®é…åˆ Prometheus/Datadog æµé‡æ§åˆ¶ å»ºè®®ä½¿ç”¨ Istio/Nginx æœåŠ¡ç½‘å…³è¿›è¡Œé‡‘ä¸é›€æµé‡æ§åˆ¶ è‡ªåŠ¨åŒ– å¯ç»“åˆ GitOpsï¼ˆArgo CDï¼‰ç®¡ç† Rollout YAML Rollback æ”¯æŒ å¯ç”¨ automatic rollback æ¡ä»¶åˆ¤æ–­ç­–ç•¥ ğŸ”„ å…­ã€é‡‘ä¸é›€/è“ç»¿å‘å¸ƒç­–ç•¥ç¤ºä¾‹ï¼ˆåŸºç¡€ï¼‰ # é‡‘ä¸é›€å‘å¸ƒç­–ç•¥ # strategy: canary: steps: - setWeight: 10 - pause: {duration: 2m} - setWeight: 50 - pause: {} analysis: templates: - templateName: success-rate-check è“ç»¿éƒ¨ç½²ç­–ç•¥ # strategy: blueGreen: activeService: app-service-active previewService: app-service-preview autoPromotionEnabled: false ğŸ“š æ¨èé˜…è¯» # å®˜æ–¹æ–‡æ¡£ï¼šhttps://argo-rollouts.readthedocs.io/ æŒ‡æ ‡åˆ†æé…ç½®ï¼šhttps://argo-rollouts.readthedocs.io/en/stable/features/analysis/ Prometheus ç›‘æ§æ¥å…¥ï¼šhttps://argo-rollouts.readthedocs.io/en/stable/features/metrics/ "},{"id":63,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-workflow/install/","title":"install","section":"argo workflow","content":" ğŸ“¦ Argo Workflows å®‰è£…ä¸å¯åŠ¨å‚æ•°è¯¦è§£ # âœ… å®‰è£… Argo Workflows # æ–¹æ³•ä¸€ï¼šå®˜æ–¹å¿«é€Ÿå®‰è£… # kubectl create namespace argo kubectl apply -n argo -f https://raw.githubusercontent.com/argoproj/argo-workflows/stable/manifests/install.yaml kubectl -n argo port-forward deployment/argo-server 2746:2746 æ–¹æ³•äºŒï¼šä½¿ç”¨ Helm å®‰è£…ï¼ˆæ¨èï¼‰ # helm repo add argo https://argoproj.github.io/argo-helm helm repo update helm install argo-workflows argo/argo-workflows --namespace argo --create-namespace --set server.secure=true --set controller.workflowNamespaces=\u0026#34;{argo}\u0026#34; --set useDefaultArtifactRepo=true âš™ï¸ argo-server å¸¸è§å¯åŠ¨å‚æ•°è¯´æ˜ # å‚æ•° ä½œç”¨ --secure æ˜¯å¦å¯ç”¨ TLSï¼ˆå»ºè®®å¼€å¯ï¼‰ --auth-mode è®¤è¯æ¨¡å¼ï¼Œå¯é€‰ï¼šserver, client, sso, hybrid --configmap é…ç½® Workflow Controller çš„é…ç½®æ¥æº --namespaced æ˜¯å¦å¯ç”¨å‘½åç©ºé—´éš”ç¦»ï¼ˆæ¯ä¸ªç”¨æˆ·åªèƒ½çœ‹è‡ªå·± namespace çš„ workflowï¼‰ --basehref è®¾ç½® UI è·¯ç”±å‰ç¼€ï¼ˆå¦‚éƒ¨ç½²åœ¨å­è·¯å¾„ä¸‹ï¼‰ --namespace è®¾ç½®é»˜è®¤çš„ namespace --loglevel è®¾ç½®æ—¥å¿—çº§åˆ«ï¼ˆä¾‹å¦‚ info, debugï¼‰ ğŸ” å¯ç”¨ SSOï¼ˆSingle Sign-Onï¼‰ # Argo Workflows æ”¯æŒåŸºäº OIDC çš„ SSO è®¤è¯ã€‚ä»¥ä¸‹ä¸ºåŸºæœ¬é…ç½®æ­¥éª¤ï¼š\næ­¥éª¤ä¸€ï¼šé…ç½® argo-server ä½¿ç”¨ SSO æ¨¡å¼ # --auth-mode sso --configmap workflow-controller-configmap æ­¥éª¤äºŒï¼šåˆ›å»º SSO é…ç½®ï¼ˆConfigMapï¼‰ # apiVersion: v1 kind: ConfigMap metadata: name: workflow-controller-configmap namespace: argo data: sso: | issuer: https://accounts.google.com clientId: my-client-id clientSecret: $SSO_CLIENT_SECRET redirectUrl: https://argo.example.com/oauth2/callback scopes: - email - profile rbac: enabled: true defaultPolicy: \u0026#39;role:readonly\u0026#39; scopes: [\u0026#39;groups\u0026#39;] æ³¨æ„ï¼šclientId ä¸ clientSecret æ¥è‡ªä½ çš„ OIDC æä¾›å•†ï¼ˆå¦‚ Googleã€Auth0ã€Dexï¼‰\nğŸ’¾ æ•°æ®æŒä¹…åŒ–é…ç½®ï¼ˆè¿æ¥æ•°æ®åº“ï¼‰ # Argo Workflows é»˜è®¤ä½¿ç”¨ Kubernetes çš„çŠ¶æ€è¿›è¡Œè°ƒåº¦ï¼Œä½†ä¹Ÿå¯é›†æˆ PostgreSQL ä»¥æå‡é«˜å¯ç”¨å’Œæ€§èƒ½ï¼ˆé€šå¸¸ç”¨äº Argo Server + Workflow Archiveï¼‰ã€‚\næ­¥éª¤ä¸€ï¼šé…ç½® PostgreSQL ä¿¡æ¯ # controller: persistence: archive: true postgresql: host: \u0026lt;postgres-host\u0026gt; port: 5432 database: argo tableName: argo_workflows userName: argo passwordSecret: name: argo-postgres-secret key: password æ­¥éª¤äºŒï¼šåˆ›å»ºå¯†é’¥ # apiVersion: v1 kind: Secret metadata: name: argo-postgres-secret namespace: argo type: Opaque data: password: \u0026lt;base64-encoded-password\u0026gt; ğŸ” éªŒè¯éƒ¨ç½² # kubectl get pods -n argo kubectl logs deployment/argo-server -n argo kubectl get workflow -n argo è®¿é—® UI: http://localhost:2746\nğŸ“š æ›´å¤šå‚è€ƒ # å®˜æ–¹ Helm Chart æ–‡æ¡£: https://github.com/argoproj/argo-helm/tree/main/charts/argo-workflows SSO æ–‡æ¡£: https://argoproj.github.io/argo-workflows/argo-server-sso/ Artifact Persistence: https://argoproj.github.io/argo-workflows/workflow-archive/ "},{"id":64,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/backstage/install/","title":"install","section":"Backstage","content":" Backstage Helm å®‰è£…æŒ‡å—ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ # æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨ Helm åœ¨ Kubernetes ä¸­éƒ¨ç½²ç”Ÿäº§çº§åˆ«çš„ Backstage å¼€å‘è€…é—¨æˆ·ã€‚\nğŸ§° å‰ç½®æ¡ä»¶ # ç¡®ä¿ä»¥ä¸‹ç»„ä»¶å·²å®‰è£…å¹¶é…ç½®ï¼š\nKubernetes é›†ç¾¤ï¼ˆç‰ˆæœ¬ â‰¥ 1.21ï¼‰ Helm 3.x Dockerï¼ˆæ„å»ºé•œåƒç”¨ï¼‰ å¯è®¿é—®çš„å®¹å™¨é•œåƒä»“åº“ PostgreSQL æ•°æ®åº“ï¼ˆå¯é€‰ï¼ŒHelm å¯è‡ªåŠ¨å®‰è£…ï¼‰ ğŸš€ æ­¥éª¤ä¸€ï¼šæ„å»ºå¹¶æ¨é€ Backstage é•œåƒ # # åˆå§‹åŒ–é¡¹ç›®ï¼ˆå¦‚æœªåˆ›å»ºï¼‰ npx @backstage/create-app cd my-backstage-app # æ„å»ºç”Ÿäº§é•œåƒ docker build -t my-org/backstage:latest . docker push my-org/backstage:latest ğŸ”§ æ­¥éª¤äºŒï¼šæ·»åŠ  Helm ä»“åº“ # helm repo add backstage https://backstage.github.io/charts helm repo update ğŸ“ æ­¥éª¤ä¸‰ï¼šåˆ›å»º values.yaml é…ç½®æ–‡ä»¶ # ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç”Ÿäº§é…ç½®ï¼š\nimage: repository: my-org/backstage tag: latest pullPolicy: IfNotPresent replicaCount: 2 ingress: enabled: true host: backstage.example.com annotations: nginx.ingress.kubernetes.io/ssl-redirect: \u0026#34;true\u0026#34; tls: - hosts: - backstage.example.com secretName: backstage-tls postgresql: enabled: true postgresqlPassword: strong-password appConfig: app: baseUrl: https://backstage.example.com backend: baseUrl: https://backstage.example.com cors: origin: https://backstage.example.com database: client: pg connection: host: postgres user: postgres password: strong-password database: backstage âœ… æ¨èä½¿ç”¨è‡ªå®šä¹‰åŸŸå + HTTPS + TLSã€‚\nğŸ›  æ­¥éª¤å››ï¼šå®‰è£… Backstage # helm install backstage backstage/backstage -n backstage --create-namespace -f values.yaml ğŸ” æ­¥éª¤äº”ï¼šæ›´æ–°éƒ¨ç½²ï¼ˆå¦‚æœ‰å˜æ›´ï¼‰ # helm upgrade backstage backstage/backstage -n backstage -f values.yaml ğŸ§ª æ­¥éª¤å…­ï¼šéªŒè¯éƒ¨ç½² # kubectl get pods -n backstage kubectl get svc -n backstage è®¿é—®ï¼šhttps://backstage.example.com\nğŸ“Œ é™„åŠ å»ºè®® # é…åˆ cert-manager è‡ªåŠ¨ç”Ÿæˆ TLS è¯ä¹¦ ä½¿ç”¨ External PostgreSQL å®ç°æŒä¹…åŒ–å’Œé«˜å¯ç”¨ ä½¿ç”¨ Fluent Bit æ”¶é›†æ—¥å¿—ï¼Œé…åˆ Loki æˆ– ELK ğŸ“š å‚è€ƒé“¾æ¥ # https://backstage.io/docs https://github.com/backstage/charts "},{"id":65,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/certmanager/install/","title":"install","section":"CertManager","content":" cert-manager ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å— # cert-manager ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å— # æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•åœ¨ Kubernetes ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½² cert-managerï¼Œå¹¶ç¡®ä¿å…¶å®‰å…¨ã€ç¨³å®šã€é«˜å¯ç”¨è¿è¡Œã€‚\nä¸€ã€å‡†å¤‡å·¥ä½œ # å·²éƒ¨ç½² Kubernetes é›†ç¾¤ï¼ˆç‰ˆæœ¬å»ºè®® \u0026gt;= 1.19ï¼‰ é›†ç¾¤ä¸­å·²å®‰è£… kubectlã€å…·å¤‡ç®¡ç†å‘˜æƒé™ æ¨èä¸º cert-manager åˆ›å»ºç‹¬ç«‹çš„å‘½åç©ºé—´ ç½‘ç»œèƒ½è®¿é—®ç›®æ ‡è¯ä¹¦é¢å‘æœºæ„ï¼ˆå¦‚ Let\u0026rsquo;s Encryptï¼‰ äºŒã€éƒ¨ç½²æ­¥éª¤ # 1. åˆ›å»ºå‘½åç©ºé—´ # kubectl create namespace cert-manager 2. æ·»åŠ  Jetstack Helm ä»“åº“ # helm repo add jetstack https://charts.jetstack.io helm repo update 3. å®‰è£… cert-managerï¼ˆä½¿ç”¨ CRDsï¼‰ # helm install cert-manager jetstack/cert-manager \\ --namespace cert-manager \\ --create-namespace \\ --version v1.14.3 \\ --set installCRDs=true âœ… è¯´æ˜ï¼šè¯·æ ¹æ®å®é™…éœ€è¦è°ƒæ•´ç‰ˆæœ¬å·ã€‚\n4. éªŒè¯éƒ¨ç½² # kubectl get pods -n cert-manager åº”çœ‹åˆ°å¦‚ä¸‹ç»„ä»¶æ­£åœ¨è¿è¡Œï¼š\ncert-manager cert-manager-webhook cert-manager-cainjector 5. åˆ›å»º ClusterIssuer ç¤ºä¾‹ï¼ˆä»¥ Let\u0026rsquo;s Encrypt ä¸ºä¾‹ï¼‰ # apiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: letsencrypt-prod spec: acme: server: https://acme-v02.api.letsencrypt.org/directory email: your-email@example.com privateKeySecretRef: name: letsencrypt-prod-account-key solvers: - http01: ingress: class: nginx kubectl apply -f clusterissuer.yaml 6. åˆ›å»º Certificate ç¤ºä¾‹ï¼ˆè‡ªåŠ¨ç­¾å‘è¯ä¹¦ï¼‰ # apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: my-tls-cert namespace: default spec: secretName: my-tls-cert-secret issuerRef: name: letsencrypt-prod kind: ClusterIssuer commonName: example.com dnsNames: - example.com - www.example.com 7. é…åˆ Ingress ä½¿ç”¨ # apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: example-ingress annotations: cert-manager.io/cluster-issuer: letsencrypt-prod spec: tls: - hosts: - example.com secretName: my-tls-cert-secret rules: - host: example.com http: paths: - path: / pathType: Prefix backend: service: name: example-service port: number: 80 ä¸‰ã€å®‰å…¨ä¸é«˜å¯ç”¨å»ºè®® # ä¸º cert-manager é…ç½®èµ„æºé™åˆ¶å’Œ pod disruption budget å°†è¯ä¹¦ Secret é…ç½®å¤‡ä»½ç­–ç•¥ï¼ˆå¦‚ Veleroï¼‰ ç›‘æ§è¯ä¹¦çŠ¶æ€ï¼Œç»“åˆ Prometheus/Grafana è®¾ç½®å‘Šè­¦ ä½¿ç”¨ DNS-01 éªŒè¯é€‚åº”å¤š ingress controller å’Œç§æœ‰ç½‘ç»œç¯å¢ƒ å»ºè®®ç»“åˆ ExternalDNS å’Œè‡ªåŠ¨åŒ– DNS æä¾›å•†ï¼ˆå¦‚ Cloudflareï¼‰ å››ã€å¸¸è§é—®é¢˜æ’æŸ¥ # é—®é¢˜ è§£å†³æ–¹æ¡ˆ Challenge ä¸€ç›´ pending æ£€æŸ¥ DNS æˆ– Ingress é…ç½®ï¼Œç¡®ä¿éªŒè¯è·¯å¾„å¯è¾¾ secret æœªåˆ›å»º ç¡®ä¿ Issuer æ­£ç¡®é…ç½®ï¼Œé‚®ç®±æ­£ç¡®ï¼ŒACME æœåŠ¡å¯è®¿é—® è¯ä¹¦æœªç»­ç­¾ æ£€æŸ¥ cert-manager æ—¥å¿—ï¼Œç¡®è®¤ webhookã€cainjector æ­£å¸¸è¿è¡Œ äº”ã€å‚è€ƒèµ„æ–™ # cert-manager å®˜æ–¹æ–‡æ¡£ Helm å®‰è£…å‚è€ƒ Let\u0026rsquo;s Encrypt ä½¿ç”¨æŒ‡å— "},{"id":66,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/cilium/install/","title":"install","section":"Cilium","content":" ğŸ—ï¸ åœ¨ç”Ÿäº§ç¯å¢ƒå®‰è£… Cilium å¹¶é›†æˆ Envoy # ä¸€ã€ç”Ÿäº§ç¯å¢ƒå®‰è£… Cilium # 1ï¸âƒ£ ç¯å¢ƒå‡†å¤‡ # Kubernetes v1.23+ï¼ˆå»ºè®® v1.25+ï¼‰ Linux å†…æ ¸ç‰ˆæœ¬ \u0026gt;= 5.10ï¼ˆæ”¯æŒé«˜çº§ eBPF ç‰¹æ€§ï¼‰ å·²å®‰è£… Helmã€kubectlã€containerd æˆ–å…¶ä»– CRI 2ï¸âƒ£ æ·»åŠ  Cilium Helm ä»“åº“ # helm repo add cilium https://helm.cilium.io/ helm repo update 3ï¸âƒ£ å®‰è£… Ciliumï¼ˆæ¨èå¼€å¯ kube-proxy æ›¿ä»£ï¼‰ # helm install cilium cilium/cilium \\ --version 1.14.4 \\ --namespace kube-system \\ --set kubeProxyReplacement=strict \\ --set k8sServiceHost=\u0026lt;API_SERVER_HOST\u0026gt; \\ --set k8sServicePort=6443 \\ --set enableHubble=true \\ --set hubble.relay.enabled=true \\ --set hubble.ui.enabled=true æ³¨æ„ï¼šæ›¿æ¢ \u0026lt;API_SERVER_HOST\u0026gt; ä¸ºä½ çš„ Kubernetes API Server åœ°å€ã€‚\n4ï¸âƒ£ å®‰è£… CLI å·¥å…·ï¼ˆå¯é€‰ï¼‰ # cilium status cilium connectivity test äºŒã€é›†æˆ Envoy å®ç° L7 ç­–ç•¥æˆ–æµé‡ä»£ç† # ğŸ“Œ Cilium ä¸­çš„ Envoy ç”¨æ³• # Cilium å†…éƒ¨é›†æˆäº† Envoy ä½œä¸ºé€æ˜ä»£ç†ï¼Œé…åˆ eBPF socket hooks å®ç° L7 ç½‘ç»œç­–ç•¥ä¸åº”ç”¨åè®®è¿‡æ»¤ï¼ˆå¦‚ HTTPã€gRPCã€Kafkaï¼‰ã€‚ä½ æ— éœ€æ‰‹åŠ¨éƒ¨ç½² Envoy Sidecarã€‚\nâœ… å¯ç”¨ L7 HTTP ç­–ç•¥åŠŸèƒ½ # Cilium é»˜è®¤å¯ç”¨äº†å†…ç½® Envoyï¼Œç”¨äºå¤„ç† L7 ç­–ç•¥ã€‚ä½ åªéœ€éƒ¨ç½² CiliumNetworkPolicy å³å¯å®ç°åº”ç”¨å±‚æ§åˆ¶ã€‚\nç¤ºä¾‹ç­–ç•¥ï¼šä»…å…è®¸ GET è¯·æ±‚ /api # apiVersion: cilium.io/v2 kind: CiliumNetworkPolicy metadata: name: l7-http-policy spec: endpointSelector: matchLabels: app: frontend ingress: - fromEndpoints: - matchLabels: app: backend toPorts: - ports: - port: \u0026#34;80\u0026#34; protocol: TCP rules: http: - method: GET path: \u0026#34;/api\u0026#34; Cilium ä¼šè‡ªåŠ¨åœ¨éœ€è¦æ—¶ä¸ºç›®æ ‡ Pod å¯åŠ¨ Envoy å®ä¾‹ï¼Œä½œä¸º L7 æ•°æ®æµçš„è¿‡æ»¤å™¨ã€‚\nä¸‰ã€éªŒè¯ä¸è°ƒè¯• # æŸ¥çœ‹ Envoy çŠ¶æ€ # cilium envoy config \u0026lt;pod-name\u0026gt; cilium monitor --type l7 æŸ¥çœ‹å¯è§†åŒ–ç•Œé¢ï¼ˆHubbleï¼‰ # kubectl port-forward -n kube-system svc/hubble-ui 12000:80 # æ‰“å¼€æµè§ˆå™¨ http://localhost:12000 å››ã€æ€»ç»“ # åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½² Cilium æ—¶æ¨èå¯ç”¨ kube-proxy æ›¿ä»£ï¼ˆstrict æ¨¡å¼ï¼‰ä»¥æå‡æ€§èƒ½ Cilium åŸç”Ÿé›†æˆ Envoyï¼Œæ— éœ€å•ç‹¬éƒ¨ç½² Sidecar å³å¯å®ç° L7 ç­–ç•¥æ§åˆ¶ æ­é… Hubble å¯å®ç°ç«¯åˆ°ç«¯ç½‘ç»œå¯è§†åŒ–ã€HTTP/gRPC è¯·æ±‚ç›‘æ§ Cilium æä¾›äº†è½»é‡ã€é«˜æ€§èƒ½çš„ Service Mesh æ›¿ä»£æ–¹æ¡ˆï¼Œé€‚åˆå¯¹å®‰å…¨ã€è§‚æµ‹ã€æ€§èƒ½æœ‰é«˜è¦æ±‚çš„ç”Ÿäº§é›†ç¾¤ç¯å¢ƒã€‚\n"},{"id":67,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/questions/","title":"questions","section":"Kubernetes","content":"æœ¬æ–‡ä»‹ç»kubernetes å¸¸è§çš„é—®é¢˜\n"},{"id":68,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/metrics/prometheus/questions/","title":"questions","section":"prometheus","content":"æœ¬äººä»‹ç»prometheus å¸¸è§çš„é—®é¢˜\n"},{"id":69,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/develop/client-go/informer/resync/","title":"Resync","section":"informer","content":" ReSync # "},{"id":70,"href":"/docs/go/sync/","title":"sync","section":"Go","content":"æœ¬ç« èŠ‚ä»‹ç» sync åŒ…çš„ä½¿ç”¨\n"},{"id":71,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/metrics/thanos/","title":"thanos","section":"metrics","content":" "},{"id":72,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/%E7%9B%91%E6%8E%A7/trace/","title":"trace","section":"ç›‘æ§","content":"ğŸ”¹ Trace çš„å·¥ä½œåŸç†\n1ï¸âƒ£ è¯·æ±‚è¿›å…¥ç³»ç»Ÿ â€¢\tå…¥å£ï¼ˆå¦‚ API Gatewayï¼‰ç”Ÿæˆä¸€ä¸ª Trace ID â€¢\tè®°å½• èµ·å§‹æ—¶é—´\n2ï¸âƒ£ è¯·æ±‚ä¼ æ’­ â€¢\tæ¯ä¸ªå¾®æœåŠ¡ åˆ›å»ºä¸€ä¸ª Span â€¢\tä¼ é€’ Trace IDï¼ˆä¸Šä¸‹æ–‡ï¼‰ â€¢\tè®°å½• æ—¶é—´ã€è¯·æ±‚å‚æ•°ã€å“åº”æ—¶é—´\n3ï¸âƒ£ è¯·æ±‚å®Œæˆ â€¢\tè®¡ç®— æ¯ä¸ªæœåŠ¡çš„æ‰§è¡Œæ—¶é—´ â€¢\tè®°å½• é”™è¯¯ä¿¡æ¯ â€¢\tä¸ŠæŠ¥ Trace æ•°æ®åˆ° å­˜å‚¨ \u0026amp; å¯è§†åŒ–ç³»ç»Ÿ\nğŸ”¹ Trace æ•°æ®ç»“æ„\nä¸€ä¸ª Trace ç”±å¤šä¸ª Span ç»„æˆï¼Œæ¯ä¸ª Span è®°å½•ï¼š\n{ \u0026#34;trace_id\u0026#34;: \u0026#34;abcd-1234\u0026#34;, \u0026#34;span_id\u0026#34;: \u0026#34;efgh-5678\u0026#34;, \u0026#34;parent_id\u0026#34;: \u0026#34;ijkl-9101\u0026#34;, \u0026#34;service\u0026#34;: \u0026#34;user-service\u0026#34;, \u0026#34;operation\u0026#34;: \u0026#34;GET /user/info\u0026#34;, \u0026#34;start_time\u0026#34;: 1710000000000, \u0026#34;duration_ms\u0026#34;: 30, \u0026#34;tags\u0026#34;: { \u0026#34;http.status_code\u0026#34;: 200, \u0026#34;db.query\u0026#34;: \u0026#34;SELECT * FROM users\u0026#34; } } ğŸš€ æ€»ç»“\nâœ… Trace é€‚ç”¨äºåˆ†å¸ƒå¼å¾®æœåŠ¡ï¼Œå¸®åŠ©åˆ†ææ…¢è¯·æ±‚ã€è°ƒç”¨é“¾\nâœ… æ ¸å¿ƒæ¦‚å¿µï¼šTraceã€Spanã€ä¸Šä¸‹æ–‡ä¼ æ’­ã€å­˜å‚¨ \u0026amp; å¯è§†åŒ–\nâœ… Jaegerã€OpenTelemetryã€Tempo æ˜¯å¸¸è§çš„ Trace æ–¹æ¡ˆ\nâœ… ç›¸æ¯”ä¼ ç»Ÿæ—¥å¿—ï¼ŒTrace æ›´é€‚åˆæ•…éšœæ’æŸ¥ \u0026amp; æ€§èƒ½ä¼˜åŒ–\n"},{"id":73,"href":"/docs/%E7%AE%97%E6%B3%95/%E5%9B%9E%E6%BA%AF/","title":"å›æº¯","section":"ç®—æ³•","content":"æœ¬ç« èŠ‚ä»‹ç»å›æº¯æ–¹æ³•\nåŸºæœ¬æ€æƒ³ # å°è¯•æ„å»ºè§£ï¼ˆæ¢ç´¢ï¼‰ å¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™å›é€€ï¼ˆå›æº¯ï¼‰ å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™è®°å½•è§£ æ­¥éª¤ # é€‰æ‹©ï¼ˆChooseï¼‰ï¼šå°è¯•åšå‡ºé€‰æ‹©ï¼Œå‘è§£ç©ºé—´æ·±å¤„æ¢ç´¢ã€‚ çº¦æŸï¼ˆConstraintï¼‰ï¼šæ£€æŸ¥å½“å‰é€‰æ‹©æ˜¯å¦æ»¡è¶³é—®é¢˜çº¦æŸæ¡ä»¶ï¼Œè‹¥ä¸æ»¡è¶³åˆ™å›é€€ã€‚ æ’¤é”€ï¼ˆUnchooseï¼‰ï¼šå¦‚æœè¯¥é€‰æ‹©å¯¼è‡´åç»­æ— è§£ï¼Œåˆ™æ’¤é”€é€‰æ‹©ï¼Œå›åˆ°ä¸Šä¸€æ­¥ã€‚ ä¼˜ç¼ºç‚¹ # ä¼˜ç‚¹\næ˜“äºå®ç°ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œé€’å½’æ€ç»´è‡ªç„¶é€‚é…å›æº¯æ³•ã€‚ èƒ½æ±‚æ‰€æœ‰è§£ï¼šé€‚ç”¨äºç»„åˆã€æ’åˆ—ã€å­é›†é—®é¢˜ï¼Œèƒ½éå†æ‰€æœ‰å¯èƒ½æ–¹æ¡ˆã€‚ é€‚ç”¨äºæ ‘å½¢ç»“æ„é—®é¢˜ï¼šå¦‚å†³ç­–æ ‘ã€DFS æœç´¢è·¯å¾„ã€‚ å¯ä»¥ç»“åˆå‰ªæä¼˜åŒ–ï¼šå¦‚ used[] è®°å½•çŠ¶æ€ã€æå‰ç»ˆæ­¢æ— æ•ˆæœç´¢ã€‚ ç¼ºç‚¹ æ—¶é—´å¤æ‚åº¦é«˜ï¼š ç»„åˆï¼šO(C(n, k)) â‰ˆ æŒ‡æ•°çº§ æ’åˆ—ï¼šO(n!)ï¼ˆéå¸¸é«˜ï¼‰ è¿·å®«ï¼šæœ€å O(4^n)ï¼ˆå››ä¸ªæ–¹å‘å°è¯•ï¼‰ é‡å¤è®¡ç®—ï¼š ä¾‹å¦‚ç¼–è¾‘è·ç¦»è®¡ç®—ï¼Œå›æº¯ä¼šé‡å¤è®¡ç®—å­é—®é¢˜ï¼Œå¯¼è‡´è¶…æ—¶ã€‚ ä¼˜åŒ–ï¼šè®°å¿†åŒ–æœç´¢ + å‰ªæã€‚ ä¸é€‚åˆå¤§è§„æ¨¡æ•°æ®ï¼š æœç´¢ç©ºé—´å¤ªå¤§æ—¶ï¼Œç›´æ¥è¶…æ—¶ï¼ éœ€è¦ä¼˜åŒ–ï¼Œå¦‚ å‰ªæã€DP ä»£æ›¿å›æº¯ã€‚ "},{"id":74,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-rollout/","title":"argo rollout","section":"Argo","content":"ä»‹ç»ä½¿ç”¨argo rollout\n"},{"id":75,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/operate/kubelet/cni/cilium/","title":"cilium","section":"CNI","content":"ä»‹ç»ä½¿ç”¨ciliumä½œä¸ºkubernetes CNIç½‘ç»œæ’ä»¶çš„ä½¿ç”¨\n"},{"id":76,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/operate/kubelet/cni/","title":"CNI","section":"operate","content":"ä»‹ç»ä½¿ç”¨ciliumä½œä¸ºkubernetes CNIç½‘ç»œæ’ä»¶çš„ä½¿ç”¨\n"},{"id":77,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-cd/example/","title":"example","section":"argo cd","content":" ğŸš€ Argo CD å¤šé›†ç¾¤ã€å¤šç¯å¢ƒã€Helm ç®¡ç† + Project éš”ç¦»ç¤ºä¾‹ï¼ˆç”Ÿäº§çº§å¤æ‚å®è·µï¼‰ # æœ¬ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Argo CD + ApplicationSet ç®¡ç†å¤šä¸ªé›†ç¾¤ã€å¤šç¯å¢ƒã€å¤šæœåŠ¡ï¼Œç»“åˆ Helmã€Argo CD Project å’Œ RBACï¼Œæ„å»ºç”Ÿäº§çº§ GitOps å¹³å°ã€‚\nğŸ“ Git ä»“åº“ç»“æ„å‡è®¾ # git-repo/ â””â”€â”€ services/ â”œâ”€â”€ svc-a/ â”‚ â””â”€â”€ charts/ â”‚ â”œâ”€â”€ dev/values.yaml â”‚ â”œâ”€â”€ stage/values.yaml â”‚ â””â”€â”€ prod/values.yaml â”œâ”€â”€ svc-b/ â”‚ â””â”€â”€ charts/ â”‚ â”œâ”€â”€ dev/values.yaml â”‚ â””â”€â”€ prod/values.yaml ğŸ§© 1. åˆ›å»º Argo CD Projectï¼ˆéš”ç¦»æœåŠ¡ä¸ç¯å¢ƒï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: AppProject metadata: name: svc-a namespace: argocd spec: description: svc-a service deployments sourceRepos: - https://github.com/your-org/your-repo.git destinations: - namespace: svc-a-* server: https://kubernetes.default.svc - namespace: svc-a-* server: https://k8s-stage.example.com - namespace: svc-a-* server: https://k8s-prod.example.com clusterResourceWhitelist: - group: \u0026#34;*\u0026#34; kind: \u0026#34;*\u0026#34; namespaceResourceWhitelist: - group: \u0026#34;*\u0026#34; kind: \u0026#34;*\u0026#34; âš™ï¸ 2. ApplicationSet ç¤ºä¾‹ï¼ˆæ”¯æŒå¤šç¯å¢ƒ + å¤šé›†ç¾¤ + Helm + Projectï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: ApplicationSet metadata: name: svc-a-apps namespace: argocd spec: generators: - matrix: generators: - git: repoURL: https://github.com/your-org/your-repo.git revision: main directories: - path: services/svc-a/charts/* - list: elements: - env: dev cluster: https://kubernetes.default.svc - env: stage cluster: https://k8s-stage.example.com - env: prod cluster: https://k8s-prod.example.com template: metadata: name: svc-a-{{env}} spec: project: svc-a source: repoURL: https://github.com/your-org/your-repo.git targetRevision: main path: services/svc-a/charts/{{env}} helm: valueFiles: - values.yaml destination: server: \u0026#39;{{cluster}}\u0026#39; namespace: svc-a-{{env}} syncPolicy: automated: prune: true selfHeal: true syncOptions: - CreateNamespace=true ğŸ”’ 3. RBAC ç¤ºä¾‹ï¼ˆå¯é€‰ï¼‰ # ä¸ºç‰¹å®šç”¨æˆ·ç»„é™åˆ¶è®¿é—® svc-a é¡¹ç›®ä¸ç¯å¢ƒï¼š\napiVersion: v1 kind: ConfigMap metadata: name: argocd-rbac-cm namespace: argocd data: policy.csv: | g, dev-team, role:svc-a-dev p, role:svc-a-dev, applications, get, svc-a-*, allow p, role:svc-a-dev, projects, get, svc-a, allow âœ… é«˜çº§åŠŸèƒ½å›é¡¾ # åŠŸèƒ½ æè¿° Project èµ„æºéš”ç¦» æ¯ä¸ªæœåŠ¡ç‹¬ç«‹ Projectï¼Œå¯è®¾ç½®ç‹¬ç«‹æƒé™ å¤šé›†ç¾¤éƒ¨ç½² æ ¹æ®ç¯å¢ƒåŒ¹é…ä¸åŒ Kubernetes API server å¤šç¯å¢ƒæ”¯æŒ ä½¿ç”¨ Helm çš„å­ç›®å½• values ç®¡ç† dev/stage/prod Matrix Generator æ”¯æŒæœåŠ¡ + ç¯å¢ƒç»„åˆç”Ÿæˆå¤šä¸ªåº”ç”¨ è‡ªåŠ¨åŒæ­¥ä¸è‡ªæ„ˆ automated + selfHeal æå‡å¯é æ€§ å‘½åç©ºé—´è‡ªåŠ¨åˆ›å»º æ”¯æŒ CreateNamespace=true RBAC æ§åˆ¶ ç²¾ç»†åŒ–æ§åˆ¶ç”¨æˆ·è®¿é—®æƒé™ ğŸ“¦ ç”Ÿäº§éƒ¨ç½²æ³¨æ„äº‹é¡¹ # é›†ç¾¤éœ€æå‰é€šè¿‡ argocd cluster add æ·»åŠ å¹¶è®¾ç½® RBAC æ¯ä¸ªæœåŠ¡å»ºè®®ç”¨ç‹¬ç«‹ Project ç®¡ç† Helm charts å­˜æ”¾è·¯å¾„åº”ä¸€è‡´è§„èŒƒ ä½¿ç”¨ä¸“æœ‰ Git åˆ†æ”¯ç®¡ç†ç¯å¢ƒï¼ˆå¯æ‰©å±• Git Generator æ¡ä»¶ï¼‰ ç»“åˆé€šçŸ¥ç³»ç»Ÿç›‘æ§åŒæ­¥å¤±è´¥çŠ¶æ€ ğŸ”— æ¨èèµ„æº # Project é…ç½®æ–‡æ¡£ï¼šhttps://argo-cd.readthedocs.io/en/stable/user-guide/projects/ Matrix Generator æ–‡æ¡£ï¼šhttps://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/MATRIX-Generator/ Helm æ”¯æŒè¯´æ˜ï¼šhttps://argo-cd.readthedocs.io/en/stable/user-guide/helm/ "},{"id":78,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-workflow/example/","title":"example","section":"argo workflow","content":" ğŸš€ æœ€å¤æ‚çš„ Argo Workflow ç¤ºä¾‹ # æœ¬ç¤ºä¾‹æ¶µç›– Argo Workflow çš„æ ¸å¿ƒé«˜çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š\nDAG + æ­¥éª¤å¼æ··ç”¨ å‚æ•°ä¼ é€’ä¸è¾“å‡º Artifact ä½¿ç”¨ Script æ¨¡æ¿ Sidecar å®¹å™¨ æ¡ä»¶æ‰§è¡Œï¼ˆwhenï¼‰ é‡è¯•ç­–ç•¥ å¹¶å‘æ§åˆ¶ TTL ç­–ç•¥ æŒä¹…åŒ–å­˜å‚¨ï¼ˆArtifact S3 ç¤ºä¾‹ï¼‰ æ‰‹åŠ¨æš‚åœä¸ç»§ç»­ å·¥ä½œæµæ¨¡æ¿å¤ç”¨ï¼ˆWorkflowTemplateï¼‰ ğŸ§¾ Workflow YAML ç¤ºä¾‹ # apiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: complex-workflow- spec: entrypoint: main-dag arguments: parameters: - name: env value: \u0026#34;prod\u0026#34; ttlStrategy: secondsAfterSuccess: 3600 parallelism: 2 templates: - name: main-dag dag: tasks: - name: generate template: generate-data - name: process dependencies: [generate] template: process-data arguments: artifacts: - name: input-data from: \u0026#34;{{tasks.generate.outputs.artifacts.out-data}}\u0026#34; - name: conditional-step dependencies: [generate] template: conditional-script when: \u0026#34;{{inputs.parameters.env}} == prod\u0026#34; - name: deploy dependencies: [process, conditional-step] template: deploy-app - name: generate-data outputs: artifacts: - name: out-data path: /tmp/output.txt container: image: alpine command: [sh, -c] args: [\u0026#34;echo \u0026#39;data-content\u0026#39; \u0026gt; /tmp/output.txt\u0026#34;] - name: process-data inputs: artifacts: - name: input-data path: /tmp/input.txt container: image: python:3.8 command: [python] args: - -c - | with open(\u0026#39;/tmp/input.txt\u0026#39;) as f: data = f.read() print(f\u0026#34;Processed: {data}\u0026#34;) - name: conditional-script script: image: bash:5.1 command: [bash] source: | echo \u0026#34;Running only in production\u0026#34; - name: deploy-app container: image: curlimages/curl command: [\u0026#34;curl\u0026#34;] args: [\u0026#34;-X\u0026#34;, \u0026#34;POST\u0026#34;, \u0026#34;http://example.com/deploy\u0026#34;] - name: sidecar-demo container: image: busybox command: [sh, -c] args: [\u0026#34;echo main container \u0026amp;\u0026amp; sleep 10\u0026#34;] sidecars: - name: logger image: busybox command: [\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;] args: [\u0026#34;while true; do echo sidecar running; sleep 2; done\u0026#34;] mirrorVolumeMounts: true - name: retry-step retryStrategy: limit: 3 retryPolicy: \u0026#34;Always\u0026#34; container: image: alpine command: [sh, -c] args: [\u0026#34;exit 1\u0026#34;] - name: approval-step suspend: {} ğŸ§  åŠŸèƒ½è¯´æ˜å¯¹ç…§è¡¨ # åŠŸèƒ½æ¨¡å— è¯´æ˜ DAG æ¨¡å¼ ä½¿ç”¨ main-dag æ¨¡æ¿æ„å»ºä»»åŠ¡ä¾èµ– Artifact ä»»åŠ¡é—´é€šè¿‡ /tmp/output.txt æ–‡ä»¶ä¼ é€’æ•°æ® å‚æ•°ä¼ é€’ é€šè¿‡ arguments.parameters æ§åˆ¶éƒ¨ç½²ç¯å¢ƒ æ¡ä»¶æ‰§è¡Œ åªæœ‰åœ¨ env == prod æ—¶æ‰è¿è¡Œ conditional-script Script æ¨¡æ¿ å†…è” bash è„šæœ¬ Sidecar å®¹å™¨ sidecar-demo å±•ç¤ºæ—¥å¿—é‡‡é›† Sidecar é‡è¯•ç­–ç•¥ retry-step ä¼šå¤±è´¥å¹¶æœ€å¤šé‡è¯• 3 æ¬¡ Suspend æ‰‹åŠ¨æ‰¹å‡† approval-step æ¨¡æ‹Ÿäººå·¥å®¡æ ¸ç‚¹ TTL ç­–ç•¥ å®Œæˆ 3600 ç§’åè‡ªåŠ¨æ¸…ç† å¹¶å‘é™åˆ¶ parallelism: 2 é™åˆ¶å¹¶å‘ä»»åŠ¡æ•°ä¸º 2 ğŸ“¦ è¦æ±‚çš„ç¯å¢ƒä¾èµ– # å·²å®‰è£… Argo Workflows Controller \u0026amp; Server Artifact å­˜å‚¨ï¼ˆå¦‚ MinIOã€S3ï¼‰å·²é…ç½®ï¼ˆç¤ºä¾‹ç•¥å»å…·ä½“ configï¼‰ å¦‚æœä½¿ç”¨ WorkflowTemplateï¼Œå¯æ‹†åˆ† generate, process, deploy ä¸ºå¯å¤ç”¨æ¨¡æ¿ ğŸ“Œ å°æç¤º # å¯ä»¥é€šè¿‡ Argo UI æˆ– CLI æäº¤æ­¤ Workflow è‹¥éœ€æ‰‹åŠ¨ Resume suspend ä»»åŠ¡ï¼š argo resume \u0026lt;workflow-name\u0026gt; ğŸ”— ç›¸å…³å‚è€ƒ # Argo å®˜æ–¹æ–‡æ¡£ï¼šhttps://argoproj.github.io/argo-workflows/ ç¤ºä¾‹ä»“åº“ï¼šhttps://github.com/argoproj/argo-workflows/tree/master/examples "},{"id":79,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/backstage/example/","title":"example","section":"Backstage","content":" Backstage ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¤ºä¾‹ï¼ˆå¤æ‚ç”¨ä¾‹ï¼‰ # æœ¬æ–‡å±•ç¤ºä¸€ä¸ªåŒ…å«å¤šä¸ªæ’ä»¶ã€æƒé™æ§åˆ¶ã€è‡ªå®šä¹‰æœåŠ¡ç›®å½•ã€CI/CD é›†æˆã€æ–‡æ¡£ç”Ÿæˆå’Œ Kubernetes å¯è§‚æµ‹æ€§çš„å¤æ‚ Backstage ä½¿ç”¨åœºæ™¯ã€‚\nğŸ§© ç³»ç»Ÿæ¶æ„å›¾ç¤ºæ„ # å¼€å‘è€… --\u0026gt; Backstage Portal --\u0026gt; æ’ä»¶ç³»ç»Ÿ | +--\u0026gt; Catalog (æœåŠ¡æ³¨å†Œ) +--\u0026gt; TechDocs (æ–‡æ¡£å¹³å°) +--\u0026gt; ArgoCD Plugin (CI/CD çŠ¶æ€) +--\u0026gt; Kubernetes Plugin (é›†ç¾¤çŠ¶æ€) +--\u0026gt; Auth (GitHub OAuth) +--\u0026gt; External Monitoring (Prometheus/Grafana) ğŸ—ƒ è½¯ä»¶ç›®å½•é…ç½®ï¼ˆcatalog-info.yamlï¼‰ # apiVersion: backstage.io/v1alpha1 kind: Component metadata: name: payment-service description: æ”¯ä»˜æœåŠ¡ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰æ”¯ä»˜ç›¸å…³é€»è¾‘ annotations: github.com/project-slug: myorg/payment-service backstage.io/techdocs-ref: dir:. argocd/app-name: payment-service prometheus.io/rule: payment-alerts spec: type: service lifecycle: production owner: team-payments system: payments-platform dependsOn: - component:default/database ğŸ”’ èº«ä»½è®¤è¯ä¸æƒé™æ§åˆ¶ # ä½¿ç”¨ GitHub OAuth + RBAC ç­–ç•¥ï¼š\nauth: providers: github: production: clientId: \u0026lt;client-id\u0026gt; clientSecret: \u0026lt;client-secret\u0026gt; enterpriseInstanceUrl: https://github.myorg.com permission: enabled: true policies: - policy: allow resourceType: component actions: [\u0026#39;read\u0026#39;] subjects: - group: developers - policy: deny resourceType: component actions: [\u0026#39;delete\u0026#39;] ğŸš€ CI/CD å¯è§†åŒ–ï¼ˆArgoCD æ’ä»¶ï¼‰ # åœ¨ app-config.yaml ä¸­é…ç½®ï¼š\nargocd: appLocatorMethods: - type: config instances: - name: main url: https://argocd.example.com token: ${ARGOCD_TOKEN} å‰ç«¯æ’ä»¶å¯å±•ç¤º Argo åº”ç”¨éƒ¨ç½²çŠ¶æ€ã€‚\nğŸ“„ æŠ€æœ¯æ–‡æ¡£ï¼ˆTechDocsï¼‰ # é¡¹ç›®ç»“æ„ï¼š\n. â”œâ”€â”€ docs â”‚ â””â”€â”€ index.md â”œâ”€â”€ mkdocs.yml â””â”€â”€ catalog-info.yaml ç¤ºä¾‹ mkdocs.yml:\nsite_name: Payment Service Docs nav: - Home: index.md plugins: - techdocs-core æ„å»ºå¹¶éƒ¨ç½² TechDocsï¼š\nyarn techdocs:build yarn techdocs:publish ğŸ›° Kubernetes æ’ä»¶é…ç½® # é…ç½®å¤šä¸ªé›†ç¾¤çš„è®¿é—®å‡­è¯ï¼š\nkubernetes: clusterLocatorMethods: - type: config clusters: - name: prod-cluster url: https://k8s-prod-api.example.com authProvider: serviceAccount serviceAccountToken: ${K8S_TOKEN} skipTLSVerify: false å¯è§†åŒ–å±•ç¤º Podã€Serviceã€Deployment çŠ¶æ€ã€‚\nğŸ“Š ç›‘æ§ç³»ç»Ÿé›†æˆï¼ˆPrometheus + Grafanaï¼‰ # Prometheus é…ç½®ï¼š\nprometheus: instances: - name: main url: http://prometheus.monitoring.svc:9090 Grafanaï¼š\nå¯é€šè¿‡ iframe åµŒå…¥ Grafana ä»ªè¡¨ç›˜è‡³è‡ªå®šä¹‰æ’ä»¶æˆ–é¡µé¢ã€‚\nğŸ¯ ç»“è¯­ # é€šè¿‡ Backstage çš„æ’ä»¶åŒ–æ¶æ„ï¼Œå¯ä»¥å°† DevOps å·¥å…·é“¾æ•´åˆè¿›ä¸€ä¸ªç»Ÿä¸€å¹³å°ï¼Œæå‡å¼€å‘è€…æ•ˆç‡ã€‚æ­¤ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªé›†æˆ ArgoCDã€Kubernetesã€Prometheusã€TechDocs ç­‰å¤æ‚æ’ä»¶çš„ç”Ÿäº§ç¯å¢ƒç”¨ä¾‹ã€‚\nğŸ“š å‚è€ƒé“¾æ¥ # https://backstage.io/docs https://github.com/backstage/backstage "},{"id":80,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/certmanager/example/","title":"example","section":"CertManager","content":" cert-manager å¤æ‚ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¤ºä¾‹ # cert-manager å¤æ‚ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¤ºä¾‹ # æœ¬ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ cert-manager å®ç°ä»¥ä¸‹ç›®æ ‡ï¼š\nä½¿ç”¨ Let\u0026rsquo;s Encrypt ä½œä¸ºè¯ä¹¦é¢å‘æœºæ„ ä½¿ç”¨ DNS-01 éªŒè¯ï¼ˆæ”¯æŒå¤š ingress controller å’Œç§æœ‰ç¯å¢ƒï¼‰ å°†è¯ä¹¦åº”ç”¨äº Ingressï¼ˆæ”¯æŒå¤šåŸŸåï¼‰ è‡ªåŠ¨ç»­æœŸä¸ Secret ç®¡ç† å¤šç§Ÿæˆ·æ”¯æŒï¼ˆClusterIssuer + å‘½åç©ºé—´ Certificateï¼‰ ä¸€ã€å‰ææ¡ä»¶ # Kubernetes é›†ç¾¤å·²éƒ¨ç½² cert-manager DNS æä¾›å•†æ”¯æŒ API æ§åˆ¶ï¼ˆå¦‚ Cloudflareã€AliDNSã€Route53ï¼‰ é›†ç¾¤å¯è®¿é—® DNS APIï¼ˆé…ç½® Secret ä»¥ä¾›è®¤è¯ï¼‰ äºŒã€é…ç½® Cloudflare DNS API Secret # apiVersion: v1 kind: Secret metadata: name: cloudflare-api-token-secret namespace: cert-manager type: Opaque stringData: api-token: CLOUDFLARE_API_TOKEN è¯·å°† CLOUDFLARE_API_TOKEN æ›¿æ¢ä¸ºå®é™… tokenã€‚å»ºè®®ä½¿ç”¨ read/write æƒé™æ§åˆ¶å­åŸŸåã€‚\nä¸‰ã€åˆ›å»º ClusterIssuer ä½¿ç”¨ DNS-01 éªŒè¯ # apiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: letsencrypt-dns spec: acme: email: your-email@example.com server: https://acme-v02.api.letsencrypt.org/directory privateKeySecretRef: name: letsencrypt-dns-account-key solvers: - dns01: cloudflare: email: your-email@example.com apiTokenSecretRef: name: cloudflare-api-token-secret key: api-token å››ã€åˆ›å»ºç”Ÿäº§ Certificate å¯¹è±¡ï¼ˆå¤šåŸŸå + è‡ªå®šä¹‰ DNSï¼‰ # apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: multi-domain-cert namespace: production spec: secretName: tls-multi-domain duration: 2160h # 90å¤© renewBefore: 360h # 15å¤©å‰ç»­æœŸ issuerRef: name: letsencrypt-dns kind: ClusterIssuer commonName: app.example.com dnsNames: - app.example.com - api.example.com - dashboard.example.com äº”ã€é…ç½®æ”¯æŒ HTTPS çš„ Ingress # apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: example-ingress namespace: production annotations: kubernetes.io/ingress.class: nginx cert-manager.io/cluster-issuer: letsencrypt-dns spec: tls: - hosts: - app.example.com - api.example.com - dashboard.example.com secretName: tls-multi-domain rules: - host: app.example.com http: paths: - path: / pathType: Prefix backend: service: name: app-service port: number: 80 - host: api.example.com http: paths: - path: / pathType: Prefix backend: service: name: api-service port: number: 80 - host: dashboard.example.com http: paths: - path: / pathType: Prefix backend: service: name: dashboard-service port: number: 80 å…­ã€å»ºè®®ä¸æ³¨æ„äº‹é¡¹ # æ¨èä¸ºæ¯ä¸ªç§Ÿæˆ·æˆ–ä¸šåŠ¡çº¿ä½¿ç”¨ç‹¬ç«‹çš„ Certificate + Secret å¯ä½¿ç”¨ ExternalDNS å®ç°è‡ªåŠ¨åŒ– DNS ç®¡ç† é…åˆ Prometheus ç›‘æ§è¯ä¹¦å‰©ä½™æœ‰æ•ˆæœŸï¼ˆcert-manager æä¾› metricsï¼‰ ä¿æŒ cert-manager Controllerã€webhook å’Œ cainjector é«˜å¯ç”¨éƒ¨ç½² ä¸ƒã€æ•…éšœæ’æŸ¥ # kubectl describe certificate multi-domain-cert -n production kubectl logs -l app=cert-manager -n cert-manager å…«ã€å‚è€ƒæ–‡æ¡£ # cert-manager DNS-01 å®˜æ–¹æ–‡æ¡£ Cloudflare API Token æƒé™é…ç½® "},{"id":81,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/cilium/example/","title":"example","section":"Cilium","content":" ğŸ§  Cilium ç”Ÿäº§ç¯å¢ƒå¤æ‚ç¤ºä¾‹ï¼ˆL7 ç­–ç•¥ + Egress Gateway + ClusterMeshï¼‰ # æœ¬ç¤ºä¾‹æ¨¡æ‹Ÿä¸€ä¸ªå…¸å‹çš„ç”Ÿäº§å¾®æœåŠ¡æ¶æ„åœºæ™¯ï¼ŒåŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š\nä½¿ç”¨ Cilium ä½œä¸º CNI åŸºäºæ ‡ç­¾çš„ L3/L4 ç­–ç•¥æ§åˆ¶ ç²¾ç»†çš„ L7 HTTP ç­–ç•¥ï¼ˆåŸºäºè·¯å¾„ã€æ–¹æ³•ï¼‰ Egress Gateway é™å®š Pod å‡ºå£ IP è·¨å‘½åç©ºé—´ç­–ç•¥ å¤šé›†ç¾¤é€šä¿¡ï¼ˆClusterMesh ç®€è¦é…ç½®ï¼‰ ğŸ“¦ åº”ç”¨æ‹“æ‰‘è¯´æ˜ # frontend (namespace: frontend) | |--\u0026gt; backend (namespace: backend) | |--\u0026gt; external API (egress: api.external.com) ğŸ“‘ 1. è·¨å‘½åç©ºé—´çš„ L7 ç­–ç•¥ # apiVersion: cilium.io/v2 kind: CiliumNetworkPolicy metadata: name: allow-frontend-to-backend namespace: backend spec: endpointSelector: matchLabels: app: backend ingress: - fromEndpoints: - matchLabels: app: frontend - namespaceSelector: matchLabels: name: frontend toPorts: - ports: - port: \u0026#34;8080\u0026#34; protocol: TCP rules: http: - method: \u0026#34;GET\u0026#34; path: \u0026#34;/api/v1/status\u0026#34; - method: \u0026#34;POST\u0026#34; path: \u0026#34;/api/v1/submit\u0026#34; ğŸŒ 2. Egress Gateway é…ç½®ï¼ˆå‡ºå…¬ç½‘ä½¿ç”¨å›ºå®š IPï¼‰ # Egress Gateway Policy # apiVersion: cilium.io/v2alpha1 kind: CiliumEgressGatewayPolicy metadata: name: backend-egress spec: egress: - podSelector: matchLabels: app: backend namespaceSelector: matchLabels: name: backend destinationCIDRs: - \u0026#34;0.0.0.0/0\u0026#34; egressGateway: nodeSelector: matchLabels: role: egress-gw å¯¹åº”èŠ‚ç‚¹éœ€è®¾ç½®æ ‡è¯†ï¼škubectl label node \u0026lt;node\u0026gt; role=egress-gw\nğŸ” 3. DNS-based ç­–ç•¥ï¼ˆåªå…è®¸è®¿é—®ç‰¹å®šåŸŸåï¼‰ # apiVersion: cilium.io/v2 kind: CiliumNetworkPolicy metadata: name: dns-egress-policy namespace: backend spec: endpointSelector: matchLabels: app: backend egress: - toFQDNs: - matchName: \u0026#34;api.external.com\u0026#34; â˜ï¸ 4. ClusterMesh åŸºç¡€é…ç½®æ­¥éª¤ï¼ˆç®€ç•¥ï¼‰ # # åœ¨ä¸¤ä¸ªé›†ç¾¤ä¸­éƒ½å®‰è£… Cilium ä¸”å¼€å¯ ClusterMesh helm upgrade cilium cilium/cilium --namespace kube-system --set cluster.name=cluster-a --set cluster.id=1 --set clustermesh.useAPIServer=true --set etcd.enabled=true ä½¿ç”¨å…±äº« DNS æˆ– CoreDNS + etcd è¿æ¥ä¸¤ä¸ªé›†ç¾¤ æœåŠ¡å’Œèº«ä»½ä¼šåœ¨ä¸¤ä¸ªé›†ç¾¤é—´åŒæ­¥ âœ… 5. éªŒè¯ç­–ç•¥ # cilium status cilium monitor --type l7 cilium connectivity test kubectl exec \u0026lt;frontend-pod\u0026gt; -- curl -X GET backend.backend.svc.cluster.local:8080/api/v1/status ğŸ§¾ æ€»ç»“ # æ­¤ç¤ºä¾‹æ¼”ç¤ºäº† Cilium åœ¨å®é™…ç”Ÿäº§ä¸­å¦‚ä½•ç»„åˆå¤šä¸ªåŠŸèƒ½ï¼š\nç²¾ç¡®çš„åº”ç”¨å±‚è®¿é—®æ§åˆ¶ï¼ˆHTTP Path/Methodï¼‰ å‘½åç©ºé—´éš”ç¦» å¤–éƒ¨æœåŠ¡è®¿é—®æ§åˆ¶ Egress IP ç®¡ç† å¤šé›†ç¾¤æœåŠ¡äº’é€šï¼ˆClusterMeshï¼‰ Cilium å¯æ›¿ä»£å¤šç§ä¼ ç»Ÿç»„ä»¶ï¼Œæä¾›ç»Ÿä¸€çš„ã€é«˜æ€§èƒ½çš„ç½‘ç»œ + å®‰å…¨ + å¯è§‚æµ‹å¹³å°ã€‚\n"},{"id":82,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/keycloak/","title":"Keycloak","section":"äº‘åŸç”Ÿ","content":"ä»‹ç»ä½¿ç”¨Keycloak + OIDC\n"},{"id":83,"href":"/docs/%E7%AE%97%E6%B3%95/%E5%8F%8C%E6%8C%87%E9%92%88/","title":"åŒæŒ‡é’ˆ","section":"ç®—æ³•","content":"æœ¬ç« èŠ‚ä»‹ç»åŒæŒ‡é’ˆ\nåŸºæœ¬æ€æƒ³ # åŒæŒ‡é’ˆï¼ˆTwo Pointersï¼‰ æ˜¯ä¸€ç§å¸¸ç”¨çš„ç®—æ³•ä¼˜åŒ–æŠ€å·§ï¼Œé€šè¿‡ä¸¤ä¸ªæŒ‡é’ˆï¼ˆç´¢å¼•ï¼‰åœ¨æ•°ç»„æˆ–é“¾è¡¨ä¸Šè¿›è¡Œéå†ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡å¤è®¡ç®—ï¼Œæé«˜æ•ˆç‡ã€‚ é€‚ç”¨äº æ•°ç»„ã€å­—ç¬¦ä¸²ã€é“¾è¡¨ç­‰çº¿æ€§ç»“æ„ï¼Œ\næŸ¥æ‰¾ æ¯”è¾ƒ å»é‡ æ’åºç­‰ã€‚ é€‚ç”¨æ¡ä»¶ # æœ‰åºæ•°ç»„/å­—ç¬¦ä¸²/é“¾è¡¨ï¼Œæ–¹ä¾¿åˆ©ç”¨ å·¦å³å¯¹æ’ æˆ– å¿«æ…¢éå†ã€‚ å¯»æ‰¾ç‰¹å®šç»„åˆï¼ˆå¦‚å’Œä¸º targetï¼‰ï¼Œå¯ä»¥é€šè¿‡ å¯¹æ’æŒ‡é’ˆ é¿å…æš´åŠ›è§£æ³•ã€‚ éœ€è¦åŠ¨æ€ç»´æŠ¤çª—å£ï¼ˆå¦‚æœ€é•¿æ— é‡å¤å­ä¸²ï¼‰ï¼Œæ»‘åŠ¨çª—å£å¯é«˜æ•ˆè§£å†³é—®é¢˜ã€‚ æ­¥éª¤ # é—®é¢˜åˆ†è§£ï¼šå°†é—®é¢˜åˆ†ä¸ºè‹¥å¹²ä¸ªå­é—®é¢˜ å±€éƒ¨æœ€ä¼˜é€‰æ‹©ï¼šå¯¹æ¯ä¸ªå­é—®é¢˜ï¼Œé€‰æ‹©ä¸€ä¸ªå±€éƒ¨æœ€ä¼˜è§£ åˆå¹¶è§£ï¼šå°†å±€éƒ¨æœ€ä¼˜è§£åˆå¹¶ä¸ºå…¨å±€è§£ ç»å…¸åº”ç”¨ # æ´»åŠ¨é€‰æ‹©é—®é¢˜ï¼šé€‰æ‹©æœ€å¤šçš„äº’ä¸é‡å çš„æ´»åŠ¨ã€‚ éœå¤«æ›¼ç¼–ç ï¼šæ„é€ æœ€ä¼˜å‰ç¼€ç¼–ç ã€‚ æœ€å°ç”Ÿæˆæ ‘ï¼šå¦‚Primç®—æ³•å’ŒKruskalç®—æ³•ã€‚ æœ€çŸ­è·¯å¾„é—®é¢˜ï¼šå¦‚Dijkstraç®—æ³•ã€‚ èƒŒåŒ…é—®é¢˜çš„åˆ†æ•°ç‰ˆæœ¬ï¼šé€‰æ‹©å•ä½ä»·å€¼æœ€é«˜çš„ç‰©å“ã€‚ ä¼˜ç¼ºç‚¹ # ä¼˜ç‚¹\né™ä½æ—¶é—´å¤æ‚åº¦ å¥—å¾ªç¯ï¼Œé™ä½ O(nÂ²) ä¸º O(n)ï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—ã€‚ é€‚ç”¨äºæœ‰åºç»“æ„ æœ‰åºæ•°ç»„ã€å•è°ƒé€’å¢åºåˆ— å¯ç”¨åŒæŒ‡é’ˆ é«˜æ•ˆæŸ¥æ‰¾ç›®æ ‡å€¼ã€‚ ç©ºé—´å¤æ‚åº¦ä½ ä¸€èˆ¬åªéœ€ O(1) é¢å¤–ç©ºé—´ï¼Œé¿å…é¢å¤–æ•°ç»„æˆ–å“ˆå¸Œè¡¨ã€‚ ç¼ºç‚¹\nä¸é€‚ç”¨äºæ— åºæ•°ç»„ ä¾‹å¦‚ æ— åºæ•°ç»„æ±‚å’Œ ä¸èƒ½ç›´æ¥ç”¨ å¯¹æ’æŒ‡é’ˆã€‚ æœ‰äº›é—®é¢˜æ— æ³•è§„é¿åµŒå¥—å¾ªç¯ ä¾‹å¦‚ å››æ•°ä¹‹å’Œ ä»ç„¶éœ€è¦ O(nÂ³)ã€‚ å¤æ‚æƒ…å†µéœ€è¦é¢å¤–é€»è¾‘ æ»‘åŠ¨çª—å£æœ‰æ—¶å€™éœ€è¦ å“ˆå¸Œè¡¨ è®°å½•çŠ¶æ€ã€‚ "},{"id":84,"href":"/docs/linux/%E7%BD%91%E7%BB%9C/","title":"ç½‘ç»œ","section":"linux","content":" è®¡ç®—æœºç½‘ç»œ # "},{"id":85,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-event/","title":"argo event","section":"Argo","content":"ä»‹ç»ä½¿ç”¨argo event\n"},{"id":86,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/harbor/","title":"Harbor","section":"äº‘åŸç”Ÿ","content":"æœ¬ç« èŠ‚ä»‹ç»Harbor\n"},{"id":87,"href":"/docs/%E7%AE%97%E6%B3%95/%E5%A0%86/","title":"å †","section":"ç®—æ³•","content":"æœ¬ç« èŠ‚ä»‹ç»å †\nåŸºæœ¬æ€æƒ³ # å †é€šå¸¸ç”¨å®Œå…¨äºŒå‰æ ‘å®ç°ï¼Œå¹¶å­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œä¿è¯é«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œ æœ€å¤§å †ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œæ ¹èŠ‚ç‚¹æ˜¯æœ€å¤§å€¼ æœ€å°å †ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œæ ¹èŠ‚ç‚¹æ˜¯æœ€å°å€¼ å­˜å‚¨æ–¹å¼ # ä½¿ç”¨æ•°ç»„è¡¨ç¤ºå®Œå…¨äºŒå‰æ ‘ æ“ä½œ # æ’å…¥æ“ä½œ\næŠŠæ–°å…ƒç´ æ’å…¥åˆ°æ•°ç»„æœ«å°¾ ä¸Šæµ® åˆ é™¤å †é¡¶å…ƒç´ \nç”¨æœ€åä¸€ä¸ªå…ƒç´ æ›¿æ¢å †é¡¶ ä¸‹æ²‰ å †æ’åº\næ„å»ºæœ€å¤§å † äº¤æ¢æ ¹èŠ‚ç‚¹å’Œæœ€åä¸€ä¸ªå…ƒç´  è°ƒæ•´å † é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°æ’åºå®Œæˆ ç»å…¸åº”ç”¨ # ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriority Queueï¼‰ ä½¿ç”¨æœ€å°å †å®ç°ä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦ ä½¿ç”¨æœ€å¤§å †å®ç°Top K é—®é¢˜ æ±‚TOP K å¤§/å°å…ƒç´  æœ€å°å †æ±‚TOP K å¤§å…ƒç´  æœ€å¤§å †æ±‚TOP K å°å…ƒç´  ä¸­ä½æ•°ç»´æŠ¤ å·¦è¾¹æœ€å¤§å †ï¼ˆç»´æŠ¤è¾ƒå°çš„ä¸€åŠæ•°ï¼‰ å³è¾¹æœ€å°å †ï¼ˆç»´æŠ¤è¾ƒå¤§çš„ä¸€åŠæ•°ï¼‰ ä¸­ä½æ•°ä¸ºä¸¤å †çš„é¡¶å…ƒç´  ä¼˜ç¼ºç‚¹ # ä¼˜ç‚¹\næ’å…¥ã€åˆ é™¤ æ“ä½œæ—¶é—´å¤æ‚åº¦ O(log n) åŠ¨æ€ç»´æŠ¤ Top K é—®é¢˜ï¼Œé€‚ç”¨äºå¤§æ•°æ®åœºæ™¯ ä¼˜å…ˆé˜Ÿåˆ—å®ç°ç®€å•é«˜æ•ˆ ç¼ºç‚¹\nä¸æ”¯æŒå¿«é€ŸæŸ¥æ‰¾ï¼ˆä¸åƒå“ˆå¸Œè¡¨ O(1)ï¼‰ å †æ’åºä¸æ˜¯ç¨³å®šæ’åºï¼ˆç›¸åŒå…ƒç´ ç›¸å¯¹é¡ºåºå¯èƒ½æ”¹å˜ï¼‰ æ•°ç»„å®ç°å †å¯èƒ½éœ€è¦é¢å¤–çš„ç©ºé—´ç§»åŠ¨ ç¤ºä¾‹ # æœ€å°å †\nimport \u0026#34;container/heap\u0026#34; type MinHeap []int func (h MinHeap) Len() int { return len(h) } func (h MinHeap) Less(i, j int) bool { return h[i] \u0026lt; h[j] } // æœ€å°å † func (h MinHeap) Swap(i, j int) { h[i], h[j] = h[j], h[i] } func (h *MinHeap) Push(x any) { *h = append(*h, x.(int)) } func (h *MinHeap) Pop() any { old := *h n := len(old) x := old[n-1] *h = old[:n-1] return x } func main() { h := \u0026amp;MinHeap{} heap.Init(h) heap.Push(h, 5) heap.Push(h, 2) heap.Push(h, 8) heap.Push(h, 1) fmt.Println(heap.Pop(h)) // 1 } "},{"id":88,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/","title":"Argo","section":"äº‘åŸç”Ÿ","content":"ä»‹ç»ä½¿ç”¨argo\n"},{"id":89,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo_e2e_flow_full/","title":"e2e_flow_full","section":"Argo","content":" ğŸŒ Nginx å…¨å®¶æ¡¶ GitOps â€“ Dev \u0026amp; Prod é‡‘ä¸é›€å‘å¸ƒ # åˆ©ç”¨ Argo Events â†’ Argo Workflows â†’ Harbor â†’ Argo CD â†’ Argo Rollouts\nå®ç° ä»£ç  Push â†’ Dev Canary â†’ å®¡æ‰¹ â†’ Prod Canary çš„ç«¯åˆ°ç«¯æµæ°´çº¿ï¼Œ\nå¹¶é€šè¿‡ Prometheus Analysis ä¸ä¸¤çº§äººå·¥å®¡æ‰¹ä¿éšœç”Ÿäº§å®‰å…¨ã€‚ # ğŸ–¼ï¸ æ¶æ„å›¾ # flowchart TD P[Git Push] --\u0026gt; ES(EventSource\u0026lt;br/\u0026gt;Git Webhook) ES --\u0026gt; EB[EventBus NATS (3)] EB --\u0026gt; S(Sensor) S --\u0026gt; WF[CI Workflow\u0026lt;br/\u0026gt;Kaniko + Helm + ä¸¤çº§å®¡æ‰¹] WF --\u0026gt; IMG[(Harbor é•œåƒ)] WF --\u0026gt; CH[(Harbor Chart)] WF -.sync-dev.-\u0026gt; CD1[Argo CD Dev\u0026lt;br/\u0026gt;Rollout] WF -.sync-prod.-\u0026gt; CD2[Argo CD Prod\u0026lt;br/\u0026gt;Rollout] CD1 --\u0026gt;|25â†’100 %| VS1(Istio VS Dev) CD2 --\u0026gt;|10â†’50â†’100 %| VS2(Istio VS Prod) Prom[Prometheus] -.metrics.-\u0026gt; VS1 \u0026amp; VS2 ğŸ“‚ ç›®å½•ç»“æ„ # nginx-gitops/ â”œâ”€â”€ Dockerfile â”œâ”€â”€ chart/ â”‚ â”œâ”€â”€ Chart.yaml â”‚ â”œâ”€â”€ values.yaml # å…¬å…± â”‚ â”œâ”€â”€ values-dev.yaml # Dev â”‚ â”œâ”€â”€ values-prod.yaml # Prod â”‚ â””â”€â”€ templates/ â”‚ â”œâ”€â”€ rollout.yaml â”‚ â””â”€â”€ service.yaml â””â”€â”€ argo/ â”œâ”€â”€ eventbus.yaml â”œâ”€â”€ eventsource-git.yaml â”œâ”€â”€ sensor-ci.yaml â”œâ”€â”€ workflowtemplate-ci-harbor.yaml â”œâ”€â”€ analysis/success-rate.yaml â””â”€â”€ applications/ â”œâ”€â”€ nginx-dev.yaml â””â”€â”€ nginx-prod.yaml 1ï¸âƒ£ EventBusï¼ˆNATSï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: EventBus metadata: name: default namespace: argo-events spec: nats: native: replicas: 3 auth: token 2ï¸âƒ£ EventSourceï¼ˆGit Webhookï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: EventSource metadata: name: git-webhook namespace: argo-events spec: service: ports: - port: 12000 targetPort: 12000 github: git-push: endpoint: /push port: 12000 insecure: false secretToken: name: github-secret key: token 3ï¸âƒ£ Sensorï¼ˆè°ƒç”¨ WorkflowTemplateï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: ci-sensor namespace: argo-events spec: eventBusName: default dependencies: - name: push eventSourceName: git-webhook eventName: git-push triggers: - template: name: ci-workflow k8s: group: argoproj.io version: v1alpha1 resource: workflows operation: create source: resource: apiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: ci-pipeline- spec: workflowTemplateRef: name: ci-template 4ï¸âƒ£ WorkflowTemplateï¼ˆCI â†’ å®¡æ‰¹ â†’ GitOpsï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: WorkflowTemplate metadata: name: ci-nginx-harbor namespace: argo spec: entrypoint: pipeline serviceAccountName: argo-ci templates: - name: pipeline dag: tasks: - name: build template: kaniko - name: package dependencies: [build] template: helm-package - name: push-chart dependencies: [package] template: helm-push - name: approve-dev dependencies: [push-chart] template: pause - name: sync-dev dependencies: [approve-dev] template: argocd-sync arguments: parameters: [{name: app, value: nginx-dev}] - name: approve-prod dependencies: [sync-dev] template: pause - name: sync-prod dependencies: [approve-prod] template: argocd-sync arguments: parameters: [{name: app, value: nginx-prod}] # -- Kaniko æ„å»ºå¹¶æ¨é•œåƒ -- - name: kaniko outputs: parameters: - name: tag valueFrom: path: /tmp/tag container: image: gcr.io/kaniko-project/executor:v1.20.0 env: - name: TAG value: \u0026#34;{{workflow.labels.git-sha}}\u0026#34; args: - --dockerfile=Dockerfile - --destination=harbor.example.com/library/nginx:${TAG} lifecycle: postStart: exec: command: [\u0026#34;sh\u0026#34;,\u0026#34;-c\u0026#34;,\u0026#34;echo ${TAG} \u0026gt;/tmp/tag\u0026#34;] volumeMounts: - name: harbor-auth mountPath: /kaniko/.docker volumes: - name: harbor-auth secret: secretName: harbor-secret # -- Helm Packageï¼ˆå†™ Dev/Prodï¼‰ -- - name: helm-package inputs: parameters: - name: tag value: \u0026#34;{{tasks.build.outputs.parameters.tag}}\u0026#34; script: image: alpine/helm:3.13.0 command: [sh] source: | TAG=$0 cp -R /workspace/chart /tmp/chart \u0026amp;\u0026amp; cd /tmp/chart for env in dev prod; do yq -i \u0026#39;.image.tag = strenv(TAG)\u0026#39; values-${env}.yaml done yq -i \u0026#39;.version=strenv(TAG) | .appVersion=strenv(TAG)\u0026#39; Chart.yaml helm dependency update . helm package . -d /tmp/out echo /tmp/out/$(ls /tmp/out) \u0026gt;/tmp/chart env: - name: 0 value: \u0026#34;{{inputs.parameters.tag}}\u0026#34; outputs: artifacts: - name: chart path: /tmp/chart # -- Helm Push åˆ° Harbor OCI -- - name: helm-push inputs: artifacts: - name: chart from: \u0026#34;{{tasks.helm-package.outputs.artifacts.chart}}\u0026#34; script: image: alpine/helm:3.13.0 command: [sh] source: | helm registry login harbor.example.com -u $USER -p $PASS helm push $(cat {{inputs.artifacts.chart}}) oci://harbor.example.com/chartrepo env: - name: USER value: robot$library+ci - name: PASS valueFrom: secretKeyRef: name: harbor-secret key: .dockerconfigjson - name: pause suspend: {} - name: argocd-sync inputs: parameters: - name: app container: image: argoproj/argocd:v2.10.0 command: - argocd - app - sync - \u0026#34;{{inputs.parameters.app}}\u0026#34; - --grpc-web - --insecure env: - name: ARGOCD_AUTH_TOKEN valueFrom: secretKeyRef: name: argocd-token key: token 5ï¸âƒ£ Argo CD Application + Rolloutï¼ˆé‡‘ä¸é›€ï¼‰ # values.yaml é‡Œä½¿ç”¨ Rolloutï¼Œç¤ºä¾‹ç•¥ï¼ˆè§å‰æ–‡ Rollouts ç¤ºä¾‹ï¼‰ã€‚\nå°† autoPromotionEnabled: false å¯ä»¥è®©è¿ç»´æ‰‹åŠ¨åˆ‡æµé‡ã€‚\nğŸ”‘ å…³é”®ç‚¹ # æ­¥éª¤ æŠ€æœ¯ å¤‡æ³¨ äº‹ä»¶æ•è· Argo Events Git Webhook CI/Image Argo Workflows + Kaniko æ—  docker-in-docker å®¡æ‰¹ Workflow Suspend UI / CLI Resume GitOps Workflow Git commit æ”¹ chart tag CD \u0026amp; Canary Argo CD + Rollouts Dev / Prod é›†ç¾¤ æŒ‡æ ‡åˆ†æ Prometheus Rollouts Analysis æŒ‰éœ€æ‰©å±•æ›´å¤šæœåŠ¡å¯ç”¨ ApplicationSet Matrixã€‚\nå¦‚éœ€å®Œæ•´ç¤ºä¾‹ä»“åº“ï¼Œè¯·å°†ä¸Šé¢ YAML æ”¾å…¥æ–°ç‰ˆ GitOps å­˜å‚¨ç»“æ„ã€‚\n"},{"id":90,"href":"/docs/%E7%AE%97%E6%B3%95/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/","title":"æ‹“æ‰‘æ’åº","section":"ç®—æ³•","content":"æœ¬ç« èŠ‚ä»‹ç»å †\nåŸºæœ¬æ€æƒ³ # æ‹“æ‰‘æ’åºï¼ˆTopological Sortingï¼‰æ˜¯ é’ˆå¯¹æœ‰å‘æ— ç¯å›¾ï¼ˆDAG, Directed Acyclic Graphï¼‰çš„ä¸€ç§æ’åºæ–¹æ³•ï¼Œå®ƒçš„ç›®æ ‡æ˜¯å°†å›¾ä¸­çš„æ‰€æœ‰é¡¶ç‚¹æ’åºï¼Œä½¿å¾—å¯¹äºæ¯ä¸€æ¡æœ‰å‘è¾¹ (u â†’ v)ï¼Œé¡¶ç‚¹ u å…ˆå‡ºç°åœ¨ v ä¹‹å‰ã€‚\nkahnç®—æ³•ï¼ˆå…¥åº¦æ³•ï¼‰ ç»´æŠ¤æ‰€æœ‰å…¥åº¦0çš„èŠ‚ç‚¹ï¼ˆå¯ä»¥å…¥é˜Ÿï¼‰ æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶åˆ é™¤å®ƒæŒ‡å‘çš„è¾¹ï¼Œæ›´æ–°ç›¸é‚»èŠ‚ç‚¹çš„å…¥åº¦ è‹¥æŸä¸ªç›¸é‚»èŠ‚ç‚¹å…¥åº¦å˜æˆ0ï¼Œåˆ™åŠ å…¥é˜Ÿåˆ— çŸ¥é“æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è®¿é—®å®Œ DFS é€†åºæ³• é‡‡ç”¨DFSéå†æ¯ä¸ªç‚¹ï¼Œé€’å½’è®¿é—®æ‰€æœ‰å­èŠ‚ç‚¹ è®¿é—®å®Œæ‰€æœ‰åç»­èŠ‚ç‚¹åï¼Œå°†å½“å‰çš„èŠ‚ç‚¹å‹å…¥æ ˆ æœ€ç»ˆæ ˆä¸­çš„å…ƒç´ é¡ºåºå³ä¸ºæ‹“æ‰‘æ’åºçš„ç»“æœ ç»å…¸åº”ç”¨ # ä»»åŠ¡è°ƒåº¦ åœºæ™¯ï¼šå¤šä¸ªä»»åŠ¡æœ‰å‰åä¾èµ–å…³ç³»ï¼Œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œã€‚ ç¤ºä¾‹ï¼šç¼–è¯‘å¤šä¸ªæºä»£ç æ–‡ä»¶æ—¶ï¼Œéœ€è¦å…ˆç¼–è¯‘ä¾èµ–æ–‡ä»¶ã€‚ è¯¾ç¨‹å®‰æ’ï¼ˆå…ˆä¿®è¯¾ç¨‹ï¼‰ åœºæ™¯ï¼šæŸäº›è¯¾ç¨‹éœ€è¦å…ˆå®Œæˆå‰ç½®è¯¾ç¨‹ï¼Œæ‰èƒ½å­¦ä¹ åç»­è¯¾ç¨‹ã€‚ ç¤ºä¾‹ï¼šLeetCode 207 è¯¾ç¨‹è¡¨ï¼ˆCourse Scheduleï¼‰é—®é¢˜ã€‚ ç”µè·¯æ—¶åºåˆ†æ åœºæ™¯ï¼šè®¡ç®—ç”µè·¯ä¸­ä¿¡å·çš„ä¼ æ’­é¡ºåºï¼Œç¡®ä¿æ•°æ®æŒ‰é€»è¾‘æµåŠ¨ã€‚ è½¯ä»¶åŒ…ä¾èµ–ç®¡ç† åœºæ™¯ï¼šå¦‚ npmã€pip ç­‰åŒ…ç®¡ç†å™¨ï¼Œå®‰è£…åŒ…æ—¶éœ€è¦å…ˆå®‰è£…å…¶ä¾èµ–é¡¹ã€‚ ç¼–è¯‘å™¨ä¼˜åŒ– åœºæ™¯ï¼šä»£ç ä¸­çš„å‡½æ•°è°ƒç”¨ä¼˜åŒ–ï¼Œç¡®å®šä¾èµ–å…³ç³»ï¼Œå‡å°‘é‡å¤è®¡ç®—ã€‚ ä¼˜ç¼ºç‚¹ # ä¼˜ç‚¹\né«˜æ•ˆæ€§ï¼š Kahn ç®—æ³• æ—¶é—´å¤æ‚åº¦ O(V + E)ï¼ˆéå†æ‰€æœ‰èŠ‚ç‚¹å’Œè¾¹ï¼‰ã€‚ DFS é€†åºæ³• æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(V + E)ã€‚ æ˜“äºå®ç°ï¼š ä»£ç ç®€å•ï¼Œé€‚ç”¨äºæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ã€‚ è§£å†³ä¾èµ–å…³ç³»é—®é¢˜ï¼š èƒ½å¾ˆå¥½åœ°è§£å†³ ä»»åŠ¡è°ƒåº¦ã€å…ˆä¿®è¯¾ç¨‹ã€è½¯ä»¶åŒ…ç®¡ç† ç­‰ä¾èµ–é—®é¢˜ã€‚ ç¼ºç‚¹\nä»…é€‚ç”¨äº DAGï¼š ä¸èƒ½å¤„ç†æœ‰ç¯å›¾ï¼Œå¦‚æœå›¾ä¸­æœ‰ç¯ï¼Œæ— æ³•è¿›è¡Œæ‹“æ‰‘æ’åºã€‚ å¯èƒ½æœ‰å¤šç§æ‹“æ‰‘æ’åºç»“æœï¼š æ‹“æ‰‘æ’åºçš„ç»“æœå¯èƒ½ä¸æ˜¯å”¯ä¸€çš„ï¼Œä¸åŒçš„ç®—æ³•å¯èƒ½å¾—å‡ºä¸åŒçš„åˆæ³•é¡ºåºã€‚ ä¸èƒ½æ£€æµ‹æ‰€æœ‰ä¾èµ–å†²çªï¼š ä»…èƒ½å‘ç° å¾ªç¯ä¾èµ–ï¼ˆç¯ï¼‰ï¼Œä½†æ— æ³•å¤„ç†å¤æ‚çš„å†²çªï¼ˆå¦‚å¹¶å‘ä¾èµ–ï¼‰ã€‚ "},{"id":91,"href":"/docs/%E7%AE%97%E6%B3%95/%E5%88%86%E6%B2%BB%E6%B3%95/","title":"åˆ†æ²»æ³•","section":"ç®—æ³•","content":"æœ¬ç« èŠ‚ä»‹ç»è´ªå¿ƒç®—æ³•\nåŸºæœ¬æ€æƒ³ # åˆ†è§£ å°†å¤šä¸ªé—®é¢˜åˆ†æˆå¤šä¸ªè§„æ¨¡è¾ƒå°ã€ç›¸äº’ç‹¬ç«‹çš„å­é—®é¢˜ è¿™äº›å­é—®é¢˜çš„å½¢å¼ä¸åŸé—®é¢˜ç›¸ä¼¼ï¼Œä½†è§„æ¨¡è¾ƒå° è§£å†³ é€’å½’åœ°æ±‚è§£è¿™äº›å­é—®é¢˜ï¼Œç›´åˆ°é—®é¢˜çš„è§„æ¨¡è¶³å¤Ÿå°ï¼Œå¯ä»¥ç›´æ¥æ±‚è§£ï¼ˆé€šå¸¸è¾ƒå°è§„æ¨¡çš„åŸºæœ¬æƒ…å†µï¼Œå¦‚æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼‰ åˆå¹¶ å°†æ‰€æœ‰çš„å­é—®é¢˜çš„è§£åˆå¹¶æˆåŸé—®é¢˜çš„è§£ ç»å…¸åº”ç”¨ # æ’åºç®—æ³• å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰ï¼šå°†æ•°ç»„æ‹†åˆ†æˆä¸¤åŠï¼Œåˆ†åˆ«æ’åºååˆå¹¶ã€‚ å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰ï¼šé€‰æ‹©ä¸€ä¸ªåŸºå‡†å€¼ï¼ˆpivotï¼‰ï¼Œå°†æ•°ç»„åˆ’åˆ†ä¸º å°äºåŸºå‡†å€¼ å’Œ å¤§äºåŸºå‡†å€¼ çš„éƒ¨åˆ†ï¼Œç„¶åé€’å½’æ’åºã€‚ è®¡ç®—æ•°å­¦ å¤§æ•´æ•°ä¹˜æ³•ï¼ˆKaratsubaç®—æ³•ï¼‰ï¼šå°†å¤§æ•´æ•°æ‹†åˆ†ä¸ºè¾ƒå°çš„éƒ¨åˆ†é€’å½’è®¡ç®—ï¼Œæé«˜ä¹˜æ³•é€Ÿåº¦ã€‚ çŸ©é˜µä¹˜æ³•ï¼ˆStrassenç®—æ³•ï¼‰ï¼šå°†çŸ©é˜µæ‹†åˆ†æˆæ›´å°çš„å­çŸ©é˜µï¼Œæé«˜è®¡ç®—æ•ˆç‡ã€‚ é€’å½’é—®é¢˜ æ±‰è¯ºå¡”é—®é¢˜ï¼šå°†é—®é¢˜åˆ†è§£ä¸ºâ€œç§»åŠ¨ n-1 å±‚ç›˜å­â€çš„é—®é¢˜é€’å½’æ±‚è§£ã€‚ æœ€å¤§å­æ•°ç»„å’Œï¼ˆåˆ†æ²»æ³•è§£æ³•ï¼‰ï¼šå°†æ•°ç»„æ‹†åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ï¼Œæ±‚è§£æœ€å¤§å­æ•°ç»„å’Œã€‚ è®¡ç®—å‡ ä½• æœ€è¿‘ç‚¹å¯¹é—®é¢˜ï¼šå°†ç‚¹é›†æŒ‰ x è½´æ‹†åˆ†ï¼Œåˆ†åˆ«è®¡ç®—æœ€è¿‘ç‚¹å¯¹ï¼Œç„¶ååˆå¹¶ç»“æœã€‚ å‡¸åŒ…é—®é¢˜ï¼šä½¿ç”¨åˆ†æ²»æ³•æ±‚è§£ç‚¹é›†ä¸­å‡¸åŒ…ã€‚ ä¼˜ç¼ºç‚¹ # ä¼˜ç‚¹\næ˜“äºç†è§£å’Œå®ç°ï¼šé€’å½’æ€æƒ³æ¸…æ™°ï¼Œä»£ç ç»“æ„å¾€å¾€ç®€å•ç›´è§‚ã€‚ é«˜æ•ˆï¼šé€šå¸¸å¯ä»¥å°†é—®é¢˜çš„æ—¶é—´å¤æ‚åº¦é™è‡³ O(n \\log n) æˆ–æ›´ä¼˜ï¼Œå¦‚ å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºã€‚ é€‚ç”¨äºå¤§è§„æ¨¡é—®é¢˜ï¼šèƒ½å¤Ÿå°†å¤æ‚é—®é¢˜æ‹†è§£æˆå°é—®é¢˜ï¼Œé€‚ç”¨äº å¤§æ•°æ®å¤„ç†ã€‚ å¹¶è¡Œè®¡ç®—ï¼šè®¸å¤šåˆ†æ²»æ³•ç®—æ³•å¯ä»¥ å¹¶è¡ŒåŒ–ï¼ˆå¦‚ å¹¶è¡Œå½’å¹¶æ’åºï¼‰ï¼Œæå‡æ‰§è¡Œæ•ˆç‡ã€‚ ç¼ºç‚¹\né€’å½’è°ƒç”¨å¯èƒ½é€ æˆé¢å¤–å¼€é”€ï¼šå¦‚æœé€’å½’æ·±åº¦è¿‡å¤§ï¼Œå¯èƒ½å¯¼è‡´ æ ˆæº¢å‡ºï¼ˆStack Overflowï¼‰ã€‚ é¢å¤–çš„ç©ºé—´å¼€é”€ï¼š å½’å¹¶æ’åºéœ€è¦ é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼ˆO(n)ï¼‰æ¥å­˜å‚¨åˆå¹¶åçš„ç»“æœã€‚ å¿«é€Ÿæ’åºï¼ˆåœ¨åŸæ•°ç»„ä¸Šè¿›è¡Œï¼Œä¸éœ€è¦é¢å¤–ç©ºé—´ï¼‰ã€‚ å­é—®é¢˜å¯èƒ½ä¸æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼š ä¾‹å¦‚ï¼ŒåŠ¨æ€è§„åˆ’ ä¹Ÿä½¿ç”¨é€’å½’ï¼Œä½†å­˜åœ¨ é‡å å­é—®é¢˜ï¼Œéœ€è¦é€šè¿‡ è®°å¿†åŒ–æœç´¢ï¼ˆMemoizationï¼‰ æˆ– é€’æ¨ è¿›è¡Œä¼˜åŒ–ã€‚ "},{"id":92,"href":"/docs/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%A0%91/","title":"äºŒå‰æ ‘","section":"ç®—æ³•","content":" æœ¬ç« èŠ‚ä»‹ç»äºŒå‰æ ‘ # äºŒå‰æ ‘çš„æ€§è´¨ # èŠ‚ç‚¹æ€»æ•°ï¼š æ·±åº¦ä¸º h çš„æ»¡äºŒå‰æ ‘æœ€å¤šæœ‰ 2^{h} - 1 ä¸ªèŠ‚ç‚¹ã€‚ é«˜åº¦ï¼ˆheightï¼‰ ä»å½“å‰èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„è¾¹æ•° æ ¹èŠ‚ç‚¹çš„é«˜åº¦=æ•´æ£µæ ‘çš„é«˜åº¦ æ·±åº¦ï¼ˆdepthï¼‰ æ ¹èŠ‚ç‚¹çš„æ·±åº¦ä¸º0ï¼ŒæŸä¸ªèŠ‚ç‚¹çš„æ·±åº¦æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„è·¯å¾„é•¿åº¦ï¼ˆè¾¹çš„æ•°é‡ï¼‰ å±‚ï¼ˆlevelï¼‰ æ ¹èŠ‚ç‚¹ä¸ºç¬¬1å±‚ï¼Œå…¶å­èŠ‚ç‚¹ä¸ºç¬¬2å±‚ï¼Œä»¥æ­¤ç±»æ¨ ç‰¹æ®Šç±»å‹çš„äºŒå‰æ ‘ # æ»¡äºŒå‰æ ‘ # æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæœ‰0ä¸ªèŠ‚ç‚¹ï¼Œè¦ä¹ˆæœ‰2ä¸ªå­èŠ‚ç‚¹ï¼ˆä¸å­˜åœ¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µï¼‰ å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚æˆ–è€…ä»…æ¯”æœ€åº•å±‚å°‘ä¸€å±‚ å®Œå…¨äºŒå‰æ ‘ # é™¤äº†æœ€åä¸€å±‚ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹å¿…é¡»æ˜¯æ»¡çš„ æœ€åä¸€å±‚çš„å¶å­èŠ‚ç‚¹å¿…é¡»é å·¦æ’åˆ— å®Œç¾äºŒå‰æ ‘ # æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹å¿…é¡»å¤„äºåŒä¸€å±‚ èŠ‚ç‚¹æ•°æ»¡è¶³å…¬å¼ 2^h - 1ï¼ˆh ä¸ºé«˜åº¦ï¼‰ å¹³è¡¡äºŒå‰æ ‘ # ä»»æ„èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡ 1 å…¸å‹ä»£è¡¨ï¼šAVL æ ‘ï¼Œçº¢é»‘æ ‘ äºŒå‰æœç´¢æ ‘ # å·¦å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹å€¼ \u0026lt; æ ¹èŠ‚ç‚¹ \u0026lt; å³å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹å€¼ ä¸­åºéå†çš„ç»“æœæ˜¯ä¸€ä¸ªé€’å¢åºåˆ— äºŒå‰å † # æœ€å°å †ï¼šçˆ¶èŠ‚ç‚¹ \u0026lt;= å­èŠ‚ç‚¹ æœ€å¤§å †: çˆ¶èŠ‚ç‚¹ \u0026gt;= å­èŠ‚ç‚¹ äºŒå‰æ ‘çš„éå†æ–¹å¼ # 1 / \\ 2 3 / \\ / \\ 4 5 6 7 / \\ / \\ / \\ / \\ 8 9 10 11 12 13 14 15 å‰åºéå† # æ ¹ â†’ å·¦å­æ ‘ â†’ å³å­æ ‘\nè®¿é—®å½“å‰èŠ‚ç‚¹ é€’å½’éå†å·¦å­æ ‘ é€’å½’éå†å³å­æ ‘ [1, 2, 4, 8, 9, 5, 10, 11, 3, 6, 12, 13, 7, 14, 15] å®ç°æ–¹å¼ï¼šé€’å½’/æ ˆ\né€‚ç”¨äºï¼šæ‹·è´äºŒå‰æ ‘ã€å‰ç¼€è¡¨è¾¾å¼è®¡ç®—ã€‚\nä¸­åºéå† # å·¦å­æ ‘ â†’ æ ¹ â†’ å³å­æ ‘\né€’å½’éå†å·¦å­æ ‘ è®¿é—®å½“å‰èŠ‚ç‚¹ é€’å½’éå†å³å­æ ‘ [8, 4, 9, 2, 10, 5, 11, 1, 12, 6, 13, 3, 14, 7, 15] å®ç°æ–¹å¼ï¼šé€’å½’/æ ˆ\né€‚ç”¨äºï¼šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰ çš„å‡åºéå†\nåç»­éå† # å·¦å­æ ‘ â†’ å³å­æ ‘ â†’ æ ¹\né€’å½’éå†å·¦å­æ ‘ é€’å½’éå†å³å­æ ‘ è®¿é—®æ ¹èŠ‚ç‚¹ [8, 9, 4, 10, 11, 5, 2, 12, 13, 6, 14, 15, 7, 3, 1] å®ç°æ–¹å¼ï¼šé€’å½’/ä¸¤ä¸ªæ ˆ\né€‚ç”¨äºï¼šåˆ é™¤èŠ‚ç‚¹ã€è®¡ç®—æ ‘çš„é«˜åº¦ã€‚\nå±‚åºéå† # ä¾æ¬¡è®¿é—®æ¯ä¸€å±‚çš„èŠ‚ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³ é€‚ç”¨äºï¼šæœ€çŸ­è·¯å¾„æœç´¢ï¼ˆå¦‚ BFS ç®—æ³•ï¼‰\n"},{"id":93,"href":"/docs/go/sync/sync_pool_guide/","title":"Sync Pool Guide","section":"sync","content":" Go sync.Pool æ·±åº¦æŒ‡å— # é€‚ç”¨ç‰ˆæœ¬ï¼šGoÂ 1.22ï¼ˆæœºåˆ¶è‡ª 1.3 å¼•å…¥ï¼Œ1.13Â åŠ å…¥ Victim ç¼“å­˜ï¼‰\nå®šä½ï¼šé«˜é¢‘ã€çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„ä¸´æ—¶å¤ç”¨æ± ï¼Œå‡è½» GC å‹åŠ›ã€‚\n1Â Â·Â å†…éƒ¨æœºåˆ¶æ¦‚è§ˆ # ç»„ä»¶ ä½œç”¨ Perâ€‘P freelist æ¯ä¸ªé€»è¾‘å¤„ç†å™¨ P æ‹¥æœ‰æœ¬åœ°ç©ºé—²é“¾ï¼Œå‘½ä¸­æ—¶å®Œå…¨æ— é” Victim list æ¯è½® GC æŠŠ freelist äº¤æ¥åˆ° victimï¼›ä¸¤è½®æ— å‘½ä¸­åˆ™è®© GC å›æ”¶ New å›è°ƒ Get å¤±è´¥æ—¶è°ƒç”¨ï¼Œä»…å½“æ¬¡ è¿”å›ï¼Œä¸ä¼šè‡ªåŠ¨å…¥æ±  GC æ¸…ç©º Pool å¯¹è±¡æ— å¼•ç”¨å³éš GC æ¸…ç©ºï¼Œä¸åšé•¿æœŸç¼“å­˜ä¿è¯ æµç¨‹ï¼šPut â†’ freelistâ€¯â†’â€¯(GC)â€¯â†’â€¯freelist â†” victimâ€¯â†’â€¯ä¸¤è½®æ— ç”¨â€¯â†’â€¯GC å›æ”¶ã€‚\n2Â Â·Â API å¿«è§ˆ # type Pool struct { New func() any } p := sync.Pool{New: func() any { return new(bytes.Buffer) }} obj := p.Get() // å¯èƒ½æ˜¯ nil /* ...ä½¿ç”¨... */ p.Put(obj) // å½’è¿˜ï¼Œå¯æ”¾ nil 3Â Â·Â ä½¿ç”¨ç¤ºä¾‹ # 3.1Â å¤ç”¨ bytes.Bufferï¼ˆWeb JSON å“åº”ï¼‰ # var bufPool = sync.Pool{ New: func() any { return new(bytes.Buffer) }, } func writeJSON(w http.ResponseWriter, v any) { buf := bufPool.Get().(*bytes.Buffer) buf.Reset() defer bufPool.Put(buf) _ = json.NewEncoder(buf).Encode(v) w.Header().Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) w.Write(buf.Bytes()) } æ”¶ç›Šï¼šåœ¨ 50â€¯kâ€¯QPS æµ‹è¯•ä¸­ï¼Œallocs/op ä» 4.2 â†’ 0.3ï¼ŒP99 å»¶è¿Ÿ â€‘15â€¯%ã€‚\n3.2Â é‡å¤åˆ©ç”¨å¤§ Sliceï¼ˆå‹ç¼©å·¥å…·ï¼‰ # type scratch struct{ buf []byte } var scratchPool = sync.Pool{ New: func() any { return \u0026amp;scratch{buf: make([]byte, 0, 64\u0026lt;\u0026lt;10)} }, // 64â€¯KiB } func Compress(dst io.Writer, src []byte) error { sc := scratchPool.Get().(*scratch) defer scratchPool.Put(sc) sc.buf = sc.buf[:0] out := snappy.Encode(sc.buf, src) _, err := dst.Write(out) return err } 4Â Â·Â åŸºå‡†æµ‹è¯•å¯¹æ¯” # Benchmark ns/op B/op allocs/op make([]byte) 12â€¯500 65â€¯536 1 sync.Pool 320 0 0 Pool æŠŠåˆ†é…æ—¶é—´é™ä½åˆ° ~3â€¯%ï¼Œå¹¶åšåˆ° é›¶åˆ†é…ã€‚\n5Â Â·Â æœ€ä½³å®è·µ # Put å‰ Resetï¼šæ¸…ç†å¯å˜å­—æ®µï¼Œé˜²æ­¢è„æ•°æ®æ³„éœ²ã€‚ å­˜æŒ‡é’ˆè€Œéå€¼ï¼šå‡å°‘ interface å¤åˆ¶æˆæœ¬ã€‚ Benchmark å†³ç­–ï¼šç”¨ go test -benchmemã€pprof é‡åŒ–æ”¶ç›Šã€‚ é¿å…æ”¾ç¨€ç¼ºèµ„æºï¼šFDã€DB è¿æ¥éœ€æ˜¾å¼ç”Ÿå‘½å‘¨æœŸï¼ŒPool éš GC å¯èƒ½ä¸¢å¤±ã€‚ ä½ QPS æ— æ„ä¹‰ï¼šé¢å¤–åŸå­å¼€é”€å¯èƒ½å¾—ä¸å¿å¤±ã€‚ 6Â Â·Â å¸¸è§è¯¯åŒº # è¯¯åŒº äº‹å® â€œPool ä¼šæ— é™å¢é•¿â€ æ¯è½® GC æœ€å¤šä¿ç•™ä¸¤ä»£ï¼Œå†·å¯¹è±¡æœ€ç»ˆè¢«å›æ”¶ â€œå¿…é¡» Put é›¶å€¼â€ åªéœ€ å¯å®‰å…¨å¤ç”¨ï¼›ä¿ç•™åº•å±‚ç¼“å†²æ‰æœ‰æ„ä¹‰ â€œPool ç›¸å½“äºç¼“å­˜â€ ä¸ä¿è¯å­˜æ´»æ—¶é—´ï¼Œä¹Ÿä¸æ”¯æŒæ·˜æ±°ç­–ç•¥ 7Â Â·Â ä½•æ—¶ ä¸è¦ ç”¨ sync.Pool # å°å¯¹è±¡ã€ä½å¹¶å‘ï¼ŒGC å¼€é”€å¯å¿½ç•¥ã€‚ éœ€è¦ TTL/LRU é€»è¾‘ã€‚ é˜»å¡ I/Oï¼Œå ç”¨çº¿ç¨‹æ—¶é—´ \u0026raquo; åˆ†é…æ—¶é—´ã€‚ 8Â Â·Â ç‰ˆæœ¬æ¼”è¿› # ç‰ˆæœ¬ å˜æ›´ æ•ˆç›Š 1.3 åˆç‰ˆå‘å¸ƒ æ”¯æŒ GC æ¸…ç©º 1.13 Victim list å‡å°‘ GC çªåˆº 1.21 fastâ€‘path ä¼˜åŒ– é«˜å¹¶å‘åå â†‘ ä¸€å¥è¯æ€»ç»“ # sync.Pool è®©â€œçŸ­å‘½å¤§å¯¹è±¡â€åœ¨ä¸‹ä¸€æ¬¡è¢«ç”¨åˆ°å‰æœ‰ä¸ªè½è„šç‚¹ï¼šé™ä½ GCï¼Œç®€åŒ–å›æ”¶ï¼Œä¸åšé•¿æœŸç¼“å­˜ã€‚\n"},{"id":94,"href":"/docs/go/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/pprof_analysis/","title":"Pprof Analysis","section":"æ€§èƒ½æµ‹è¯•","content":" Go pprof æ€§èƒ½åˆ†æå®è·µæ‰‹å†Œ # é€‚ç”¨ç‰ˆæœ¬ï¼šGoÂ 1.20Â â€“Â GoÂ 1.23ï¼ˆ2025â€¯å¹´æœ€æ–°ç‰ˆï¼‰\né˜…è¯»å¯¹è±¡ï¼šå¸Œæœ›ç³»ç»ŸæŒæ¡ pprof å¹¶è½åœ°åˆ°ç”Ÿäº§çš„ Go å¼€å‘ / SRE\nç›®å½• # æ¦‚è§ˆï¼špprof èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ Profile ç±»å‹ä¸é‡‡æ ·åŸç† ç¦»çº¿é‡‡é›†ï¼šåŸºå‡†æµ‹è¯• \u0026amp; CLI åœ¨çº¿é‡‡é›†ï¼šnet/http/pprof \u0026amp; è¿œç¨‹æŠ“å– å¯è§†åŒ–ï¼šå‘½ä»¤è¡Œã€FlameGraphã€Speedscope æ¡ˆä¾‹ä¸€ï¼šCPU Hotspot å®šä½ä¸ä¼˜åŒ– æ¡ˆä¾‹äºŒï¼šå†…å­˜æ³„æ¼æ’æŸ¥ æ¡ˆä¾‹ä¸‰ï¼šé˜»å¡ / Mutex ç«äº‰åˆ†æ æŒç»­ Profilingï¼šParca / Pyroscope / GrafanaÂ Pyroscope Cloud PGOï¼šProfile-Guided Optimization æµç¨‹ è‡ªåŠ¨åŒ–å·¥ä½œæµä¸ CI é›†æˆ å¸¸è§è¯¯åŒº \u0026amp; è°ƒå‚æ¸…å• å‚è€ƒé“¾æ¥ 1. æ¦‚è§ˆï¼špprof èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ # å®šä½ CPU çƒ­ç‚¹ï¼šé‡‡æ ·å‹ Profileï¼Œæ‰¾åˆ°æœ€è€—æ—¶çš„å‡½æ•°æˆ–è°ƒç”¨é“¾ æ’æŸ¥å†…å­˜æ³„æ¼ï¼šå¯¹æ¯”å¤šä»½å †å¿«ç…§ï¼Œç¡®å®šåˆ†é…ç‚¹ é”ç«äº‰ / é˜»å¡ï¼šæŸ¥çœ‹è¢« sync.Mutex æˆ–ç³»ç»Ÿè°ƒç”¨é˜»å¡çš„æ—¶é—´ Goroutine çˆ†ç‚¸ï¼šå¿«ç…§å½“å‰æ‰€æœ‰ goroutine æ ˆï¼Œåˆ†æåˆ›å»ºæº pprof ä¸ä¼šç›´æ¥å‘Šè¯‰ä½ â€œæ€ä¹ˆæ”¹â€ï¼Œä½†èƒ½ç²¾å‡†æŒ‡å‘ç“¶é¢ˆä½ç½®ã€‚éšåé€šè¿‡ä»£ç  / å‚æ•° / æ¶æ„å±‚é¢ä¼˜åŒ–å¹¶ benchstat éªŒè¯ã€‚\n2. Profile ç±»å‹ä¸é‡‡æ ·åŸç† # Profile é»˜è®¤é‡‡æ · ä¸»è¦å­—æ®µ CPU 100Â Hz æ—¶é’Ÿä¸­æ–­ flat, cum **Heap (allocs/inuse)` æ¯åˆ†é… 512â€¯KiB alloc_objects / inuse_space Block 100Â Hz contentions_ns Mutex 50Â Hz contentions, delay Goroutine å¿«ç…§ stack Go è¿è¡Œæ—¶åœ¨çƒ­ç‚¹å¤„æ’å…¥é‡‡æ ·å›è°ƒï¼Œæˆæœ¬â‰ˆ1â€“2â€¯% CPUã€‚ Heap é‡‡æ ·ç‡å¯é€šè¿‡ç¯å¢ƒå˜é‡ GODEBUG=memprofilerate=N è°ƒèŠ‚ã€‚ 3. ç¦»çº¿é‡‡é›†ï¼šåŸºå‡†æµ‹è¯• \u0026amp; CLI # # ç¼–è¯‘åŸºå‡†å¹¶è¾“å‡º cpu.prof go test -run=^$ -bench=. -benchtime=10s -cpuprofile cpu.prof ./pkg # ç”Ÿæˆå†…å­˜ profile GODEBUG=memprofilerate=131072 go test -run=^$ -bench=. -memprofile mem.prof ./pkg Tips\n-run=^$ è·³è¿‡å•å…ƒæµ‹è¯•ï¼Œä»…è·‘åŸºå‡† -benchmem æŠ¥å‘Š alloc/opï¼Œé…åˆ mem.prof æ•ˆæœæ›´ä½³ 4. åœ¨çº¿é‡‡é›†ï¼šnet/http/pprof # import _ \u0026#34;net/http/pprof\u0026#34; func main() { go http.ListenAndServe(\u0026#34;:6060\u0026#34;, nil) ... } å¸¸ç”¨æŠ“å–å‘½ä»¤ # URL è¯´æ˜ /debug/pprof/profile?seconds=30 CPU 30â€¯s /debug/pprof/heap å †å¿«ç…§ /debug/pprof/mutex?debug=1 Mutex /debug/pprof/block?debug=1 Block ç¡®ä¿åªå¯¹å†…ç½‘æˆ– mTLS æš´éœ²ï¼› kubernetes å¯ç”¨ kubectl port-forward ä¸´æ—¶æ‹‰é€šã€‚\n5. å¯è§†åŒ– # 5.1 CLI # go tool pprof -top cpu.prof go tool pprof -list \u0026#39;MyHotFunc\u0026#39; cpu.prof 5.2 å†…ç½® Web # go tool pprof -http=:8080 cpu.prof 5.3 Speedscope # go tool pprof -proto cpu.prof \u0026gt; cpu.pb.gz # å°† protobuf æ–‡ä»¶æ‹–åˆ° https://www.speedscope.app Speedscope æ”¯æŒæ—¶é—´è½´è§†å›¾ï¼Œé€‚åˆåˆ†æå¹¶è¡Œ / I/O é˜»å¡ã€‚\n6. æ¡ˆä¾‹ä¸€ï¼šCPU Hotspot # ç—‡çŠ¶ï¼šQPS è¾¾åˆ° 5k æ—¶ CPU å ç”¨ 900â€¯% é‡‡é›†ï¼š30â€¯ç§’ CPU profile åˆ†æï¼štop å‘ç° regexp.(*Regexp).FindAllIndex flat=45â€¯% ä¼˜åŒ–ï¼š å¤ç”¨ç¼–è¯‘åçš„æ­£åˆ™ æ›¿æ¢ä¸º strings.Contains + é¢„è§£æ å›å½’ï¼šbenchstat æ˜¾ç¤º latency â†“30â€¯% / CPU â†“25â€¯% 7. æ¡ˆä¾‹äºŒï¼šå†…å­˜æ³„æ¼ # # å‘¨æœŸæŠ“å–å † go tool pprof http://app:6060/debug/pprof/heap -o heap1.prof sleep 120 go tool pprof http://app:6060/debug/pprof/heap -o heap2.prof # Diff go tool pprof -base heap1.prof heap2.prof è‹¥å·®å¼‚é›†ä¸­åœ¨ bytes.makeSliceï¼Œé€šå¸¸æ˜¯åˆ‡ç‰‡æ— é™æ‰©å®¹ï¼›æ£€æŸ¥ cap é¢„ä¼°æˆ–æ‰©å®¹ç­–ç•¥ã€‚\n8. æ¡ˆä¾‹ä¸‰ï¼šé˜»å¡ / Mutex # Block profileï¼šå®šä½ç½‘ç»œ / DB å»¶è¿Ÿ Mutex profileï¼šå‡ºç° runtime.mapassign çƒ­ç‚¹ â†’ map å†™äº‰ç”¨ï¼›å¯æ¢ sync.Map æˆ– sharding GoÂ 1.21+ æ”¯æŒ runtime/pprof.Labels(\u0026quot;tenant\u0026quot;, id)ï¼Œåœ¨ç«ç„°å›¾ä¸­æŒ‰æ ‡ç­¾èšåˆï¼Œå¿«é€Ÿè¯†åˆ«å“ªæ¡ç§Ÿæˆ·è€—æ—¶ã€‚\n9. æŒç»­ Profiling # æ–¹æ¡ˆ ç‰¹ç‚¹ Parca / Parca Agent äº‘åŸç”Ÿï¼ŒeBPF + DWARFï¼Œæ— éœ€ sidecar Pyroscope UI å‹å¥½ï¼Œå¯ä¸ Grafana Merge Go è¿è¡Œæ—¶ mprof 1.20+ å†…ç½®è¿ç»­ CPU/Heap é‡‡æ ·ï¼Œä½å¼€é”€ åœ¨ Kubernetes é›†ç¾¤æ¨è DaemonSet æ–¹å¼å®‰è£… Agentï¼Œç»Ÿä¸€ä¸ŠæŠ¥åˆ°é›†ä¸­ UIã€‚\n10. PGOï¼šProfile-Guided Optimization # GoÂ 1.20 èµ·æ”¯æŒ -pgo= æµç¨‹ï¼š go test -c -pgo=./pgo.pprof go build -pgo=./pgo.pprof -o app PGO ä¸»è¦ä¼˜åŒ– å†…è” / åˆ†æ”¯é¢„æµ‹ï¼›å¯¹å¾®æœåŠ¡æ•ˆæœ 3â€“10â€¯%ã€‚ 11. è‡ªåŠ¨åŒ–å·¥ä½œæµ # # Makefile ç‰‡æ®µ bench: go test -run=^$ -bench=. -benchmem -cpuprofile cpu.prof ./... benchstat old.txt new.txt go tool pprof -svg cpu.prof \u0026gt; cpu.svg CI ä¸­ä¸Šä¼  cpu.svg ä½œä¸º artifactï¼Œé…åˆ GitHub Actions æ³¨é‡Š PRã€‚\n12. å¸¸è§è¯¯åŒº \u0026amp; è°ƒå‚æ¸…å• # è¯¯åŒº çº æ­£ æŠ“ä¸€æ¬¡ profile å°±å¤Ÿ é‡‡æ ·æœ‰éšæœºæ€§ï¼Œè‡³å°‘å¤šè·‘ 3 æ¬¡ Heap Profile = RSS åªåŒ…å« Go å †ï¼Œä¸å« mmapã€Cgoã€æ ˆ pprof ä¼šæ‹–æ…¢çº¿ä¸Š é‡‡æ ·å‹å¼€é”€æä½ï¼Œé˜»å¡ / mutex å»ºè®®ä¸´æ—¶å¼€å¯ è°ƒå‚\nruntime.SetMutexProfileFraction(10)Â â€“ æ¯ 10 æ¬¡ç«äº‰é‡‡æ ·ä¸€æ¬¡ runtime.SetBlockProfileRate(1)Â â€“ æ•æ‰æ‰€æœ‰é˜»å¡ï¼ˆæ’éšœåæ”¹å› 0ï¼‰ 13. å‚è€ƒé“¾æ¥ # Go å®˜æ–¹ Blogã€ŠProfiling Go Programsã€‹ BrendanÂ Gregg FlameGraph é¡¹ç›® Parca.dev / Pyroscope.io / Grafana Cloud ContinuousÂ Profiling Go 1.23 Release Notes â€“ PGO \u0026amp; profiler æ”¹è¿› å»ºè®®ï¼šåœ¨æ¯ä¸ªé‡å¤§ç‰ˆæœ¬å‡çº§åï¼Œé‡æ–°è¯„ä¼°é‡‡æ ·ç‡ä¸é˜ˆå€¼ã€‚Go è¿è¡Œæ—¶åŠ GC æ¯å¹´éƒ½åœ¨è¿›æ­¥ï¼Œå†å²â€œç„å­¦è°ƒå‚â€å¯èƒ½å·²è¿‡æ—¶ã€‚\n"},{"id":95,"href":"/docs/go/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/go_escape_analysis/","title":"Go Escape Analysis","section":"æ•°æ®ç»“æ„","content":" Goâ€¯é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰è¯¦è§£ # æ ¸å¿ƒç»“è®ºï¼šé€ƒé€¸åˆ†æå‘ç”Ÿåœ¨ ç¼–è¯‘æœŸï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªå˜é‡åœ¨å‡½æ•°è°ƒç”¨é“¾ä¸Šæ˜¯å¦å¯èƒ½â€œé€ƒå‡ºâ€å…¶æ ˆå¸§â€”â€”ä¸€æ—¦é€ƒé€¸ï¼Œå°±å¿…é¡»åˆ†é…åˆ°å †ä¸Šå¹¶å—åƒåœ¾å›æ”¶ç®¡ç†ï¼›å¦åˆ™å¯åœ¨æ ˆä¸Šåˆ†é…ï¼Œç”Ÿå‘½å‘¨æœŸéšæ ˆå¸§è‡ªåŠ¨ç»“æŸã€‚\n1Â Â·Â ä¸ºä»€ä¹ˆéœ€è¦é€ƒé€¸åˆ†æï¼Ÿ # ç›®æ ‡ è§£é‡Š å‡å°‘Â GCÂ å‹åŠ› æ ˆä¸Šåˆ†é…æ— éœ€å›æ”¶ï¼›å †åˆ†é…è¶Šå°‘ï¼ŒGCÂ æ¬¡æ•°å’Œåœé¡¿è¶Šä½ã€‚ åŠ é€Ÿè®¿é—® æ ˆå†…å­˜æ¯”å †å†…å­˜å±€éƒ¨æ€§å¥½ï¼ŒCPUÂ CacheÂ å‹å¥½ã€‚ æ¶ˆé™¤åŒæ­¥ æ ˆç§æœ‰ï¼Œæ— éœ€å¹¶å‘åŒæ­¥ï¼›å †å¯¹è±¡å¯èƒ½è¢«å…¶ä»– goroutine é—´æ¥å¼•ç”¨ã€‚ 2Â Â·Â Go ç¼–è¯‘å™¨çš„é€ƒé€¸åˆ¤å®šé€»è¾‘ # å˜é‡ç”Ÿå‘½å‘¨æœŸåˆ†æ å»ºç«‹ SSAï¼ˆé™æ€å•èµ‹å€¼ï¼‰å›¾ï¼Œè·Ÿè¸ªå˜é‡ä»å®šä¹‰åˆ°æ‰€æœ‰å¯èƒ½çš„ä½¿ç”¨ç‚¹ã€‚ æŒ‡é’ˆè¿½è¸ª è‹¥å˜é‡åœ°å€è¢«ä¼ é€’åˆ°ï¼š è¿”å›å€¼ / æŒ‡é’ˆå‚æ•° æ¥å£å€¼ï¼ˆè£…ç®±ï¼‰ å †å¯¹è±¡å­—æ®µ åå°„ã€unsafe.Pointerã€é—­åŒ…æ•è·\nåˆ™è§†ä¸ºâ€œå¯èƒ½åœ¨å½“å‰è°ƒç”¨æ ˆå¤–ä»å¯è®¿é—®â€ â†’ å †åˆ†é… å¾ªç¯è¿­ä»£åˆå¹¶Â (PromotedÂ Scalars) å¯¹ä»…åœ¨å¾ªç¯å†…ã€ä¸”ä¸è¢«å–åœ°å€çš„ä¸´æ—¶å¯¹è±¡ï¼Œå¯åš Scalar Replacement of AggregateÂ (SRA)ï¼Œå½»åº•æ‹†æˆå¯„å­˜å™¨/æ ˆæ ‡é‡ã€‚ è·¨å‡½æ•°å†…è”ååŒ //go:noinlineâ€¯æˆ–è¿‡å¤§å‡½æ•°ä½“ä¼šé˜»æ–­å†…è”ï¼Œå¯¼è‡´æ›´å¤šé€ƒé€¸ã€‚ åä¹‹ï¼Œå†…è”åé—æ¼å–åœ°å€æ“ä½œå¯è¢«è¿›ä¸€æ­¥åˆ†æä¸ºæ ˆåˆ†é…ã€‚ åŸåˆ™ï¼šç¼–è¯‘å™¨å®å¯â€œè¯¯æ€â€ä¹Ÿä¸ä¼šâ€œæ¼åˆ¤â€ã€‚ä¸€æ—¦é€ƒé€¸å¯èƒ½ï¼Œç›´æ¥åˆ†é…å †ã€‚\n3Â Â·Â æŸ¥çœ‹é€ƒé€¸ä¿¡æ¯ # go build -gcflags=\u0026#34;-m -l\u0026#34; # -m æ‰“å°é€ƒé€¸ä¿¡æ¯ï¼Œ-l ç¦æ­¢å†…è”ä¾¿äºè§‚å¯Ÿ ç¤ºä¾‹ä»£ç  escape.goï¼š\npackage main type Data struct{ buf [1024]byte } func stackAlloc() *Data { d := \u0026amp;Data{} // \u0026amp;Data å¯èƒ½é€ƒé€¸ return d // è¿”å›å‡ºå‡½æ•° â†’ å † } func stayInStack() int { x := 42 // ä¸å–åœ°å€ return x // æ ˆä¸Š } func main() { _ = stackAlloc() _ = stayInStack() } ç¼–è¯‘è¾“å‡ºï¼ˆæˆªå–ï¼‰ï¼š\n./escape.go:6:6: new(Data) escapes to heap // d = \u0026amp;Data{} ./escape.go:15:6: moved to heap: d // main è°ƒç”¨ç»“æœä»åœ¨å † é˜…è¯»æŠ€å·§\nâ€œescapes to heapâ€ â†’ å˜é‡æœ¬ä½“åœ¨å †ï¼ŒæŒ‡é’ˆå˜é‡ä»åœ¨æ ˆï¼›\nâ€œmoved to heapâ€ â†’ ç¼–è¯‘å™¨å°†æ•´ä¸ªå˜é‡æ¬åˆ°å †ä¸Šã€‚\n4Â Â·Â å¸¸è§å¯¼è‡´é€ƒé€¸çš„åœºæ™¯ # åœºæ™¯ ç¤ºä¾‹ è¯´æ˜ / è§„é¿ç­–ç•¥ è¿”å›å±€éƒ¨æŒ‡é’ˆ return \u0026amp;v å¿…é€ƒé€¸ï¼›å¯æ”¹ä¸ºå€¼è¿”å›æˆ–æ¥å£å›æ”¶æ± ã€‚ é—­åŒ…æ•è· go func() { println(v) }() v ç”Ÿå‘½å‘¨æœŸ \u0026gt; å¤–å±‚æ ˆå¸§ï¼›è€ƒè™‘ä¼ å€¼ã€‚ æ¥å£è£…ç®± var i interface{} = struct{...}{} éç©ºæ¥å£æŠŠæ•°æ®å¤åˆ¶è¿›å»ï¼›ç©ºæ¥å£å°†æŒ‡é’ˆ+ç±»å‹é€ƒé€¸ã€‚ fmt/åå°„ fmt.Println(v) fmt å‚æ•°ä¸ºæ¥å£ï¼Œç¼–è¯‘æœŸä¸å¯è§ï¼›ä¸´æ—¶å€¼å¸¸é€ƒé€¸ã€‚ slice è¿½åŠ  append(s, bigStruct) è‹¥ slice è¶…å®¹é‡å¹¶è¿”å›åˆ°ä¸Šå±‚ï¼Œåˆ™åº•å±‚æ•°ç»„å¯èƒ½é€ƒé€¸ã€‚ method å–å€ obj.Method() è‹¥ Method éœ€è¦æ¥æ”¶è€…åœ°å€ ä½¿ç”¨å€¼æ¥æ”¶è€…ç‰ˆæœ¬ func (T) Method()ã€‚ 5Â Â·Â ä¼˜åŒ–å®è·µ # å¤šç”¨å€¼è¯­ä¹‰ï¼šå°ç»“æ„ä½“ (\u0026lt;Â 128â€¯B) å°½é‡å€¼ä¼ é€’ï¼›æŒ‡é’ˆå¤šæ„å‘³ç€é€ƒé€¸é£é™©ã€‚ å¤ç”¨ç¼“å†²åŒºï¼šsync.Pool ç¼“è§£é¢‘ç¹å †åˆ†é…ï¼Œä½†åˆ«è¿‡åº¦ï¼ˆGCÂ è¿˜æ˜¯ä¼šæ¸…ï¼‰ã€‚ åˆç†åˆ‡åˆ†å‡½æ•°ï¼šè¿‡å¤§å‡½æ•°ä¸æ˜“å†…è”ï¼›æ‹†åˆ†åçƒ­ç‚¹è·¯å¾„å¯æ›´ç²¾å‡†æ ˆåˆ†é…ã€‚ é¿å…ä¸å¿…è¦çš„æ¥å£ \u0026amp; åå°„ï¼šçƒ­ç‚¹å†…å±‚ç”¨æ³›å‹æˆ–ç›´æ¥ç±»å‹ã€‚ profileÂ éªŒè¯ï¼šgo test -bench . -benchmem / pprof -alloc_spaceï¼›ç¡®ä¿ä¿®æ”¹ç¡®å®é™ä½ B/opï¼ˆæ¯æ¬¡æ“ä½œåˆ†é…å­—èŠ‚æ•°ï¼‰ã€‚ 6Â Â·Â ä¸ Go ç‰ˆæœ¬æ¼”è¿› # ç‰ˆæœ¬ æ”¹è¿› å½±å“ Goâ€¯1.13 æ–° inlining + escape æ¡†æ¶ å‡å°‘é—­åŒ…æ•è·é€ƒé€¸ Goâ€¯1.20 æ•´å‹èŒƒå›´åˆ†æ åˆå¹¶åˆ° EA å¯¹ map key ä¸´æ—¶å˜é‡æ›´å‹å¥½ Goâ€¯1.22 SRA \u0026amp; Ï†â€‘èŠ‚ç‚¹ä¼˜åŒ– slice/header æ‹†åˆ†æ›´å½»åº• Goâ€¯1.23ï¼ˆè§„åˆ’ï¼‰ Path-sensitive EA å¤æ‚æ¡ä»¶åˆ†æ”¯ä¸‹æ›´ç²¾å‡† 7Â Â·Â å¾®åŸºå‡†ä¾‹å­ï¼ˆè§‚å¯Ÿé€ƒé€¸å‰åï¼‰ # package bench type big struct{ buf [4096]byte } func byPointer() *big { b := \u0026amp;big{} // å † b.buf[0] = 1 return b } func byValue() big { var b big // æ ˆï¼ˆ4â€¯KiB ä¼šè¢« memclrï¼Œä½†ä»åœ¨æ ˆï¼‰ b.buf[0] = 1 return b // å¤åˆ¶å¼€é”€ï¼Œä½†å¯ç”±ç¼–è¯‘å™¨å˜æˆ `memmove` } go test -bench . -benchmem è¾“å‡ºç¤ºä¾‹ï¼ˆä¸åŒæœºå™¨ç•¥æœ‰å·®å¼‚ï¼‰ï¼š\nBenchmarkByPointer-8 1000000 1200 ns/op 4096 B/op 1 allocs/op BenchmarkByValue-8 1000000 320 ns/op 0 B/op 0 allocs/op 8Â Â·Â è°ƒè¯•é™·é˜± # //go:escape å†…ç½®æ³¨é‡Šï¼ˆruntime åŒ…ä½¿ç”¨ï¼‰å¼ºåˆ¶å˜é‡è§†ä¸ºé€ƒé€¸ï¼›æ™®é€šé¡¹ç›®è¯·å‹¿ä½¿ç”¨ã€‚ unsafe è¯¯å¯¼ ç¼–è¯‘å™¨å¯¹ unsafe.Pointer ä¼š ä¿å®ˆé€ƒé€¸ï¼Œé™¤éèƒ½è¯æ˜åªåœ¨æ ˆé—­åŒ…å†…è®¿é—®ã€‚ cgo ä¼ ç»™ C çš„æŒ‡é’ˆç¦æ­¢æ˜¯ Go æ ˆæŒ‡é’ˆï¼ˆCGO Checkï¼‰ï¼›å› æ­¤å‡ ä¹éƒ½è¦å †åˆ†é…ã€‚ 9Â Â·Â ä¸€å›¾é€ŸæŸ¥ # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” \u0026amp;v / interface / closure â”‚ å˜é‡å®šä¹‰ â”‚â”€â”€â”€â”€â”€â”€â”€å¯èƒ½é€ƒé€¸â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚SSA æ ˆåˆ†æ â–¼ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â””â”€â”€â”€â”€â”€â”€â”€â”€Noâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ æ ˆä¸Šåˆ†é… â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚Yes â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ å †ä¸Šåˆ†é… + GC â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å°ç»“ # é€ƒé€¸åˆ†ææ˜¯ Go æ€§èƒ½ä¼˜åŒ–çš„ç¬¬ä¸€é“å…³å¡ï¼šå † vs. æ ˆ å†³ç­–å…¨å‡­ç¼–è¯‘æœŸæ¨å¯¼ã€‚ ä½¿ç”¨ -gcflags=-m å®¡è§†çƒ­ç‚¹å‡½æ•°çš„é€ƒé€¸è¾“å‡ºï¼Œé…åˆ benchmemâ€¯\u0026amp;â€¯pprof åšé‡åŒ–å›å½’ã€‚ ä¸å¿…â€œè°ˆé€ƒé€¸è‰²å˜â€â€”â€”åœ¨å¯è¯»æ€§å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ï¼Œä»£ç çš„æ¸…æ™°åº¦ å¾€å¾€æ¯”æç«¯çš„æ ˆä¼˜åŒ–æ›´é‡è¦ã€‚ "},{"id":96,"href":"/docs/go/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/go_gc_overview/","title":"Go Gc Overview","section":"æ•°æ®ç»“æ„","content":" GoÂ åƒåœ¾å›æ”¶ï¼ˆGCï¼‰å·¥ä½œåŸç†å…¨æ™¯ # é€‚ç”¨ç‰ˆæœ¬ï¼šGoâ€¯1.22ï¼›ä» 1.5 å¹¶å‘ä¸‰è‰²æ ‡è®°â€æ¸…æ‰«å¥ åŸºï¼Œåç»­æ¼”è¿›å§‹ç»ˆä¿æŒæ€»ä½“æ¡†æ¶ä¸å˜ã€‚\nå…³é”®è¯ï¼šå¹¶å‘ä¸‰è‰²ã€å†™å±éšœã€MutatorÂ Assistã€Scavengerã€STWÂ å‹ç¼©ã€SoftÂ MemoryÂ Limitã€‚\n1â€¯Â·â€¯æ€»ä½“æ¶æ„ # ç»´åº¦ ç‰¹æ€§ è¯´æ˜ ç®—æ³• å¹¶å‘ä¸‰è‰² Markâ€‘Sweep ç»å¤§éƒ¨åˆ†æ ‡è®°ã€æ¸…æ‰«ä¸ä¸šåŠ¡çº¿ç¨‹å¹¶å‘æ‰§è¡Œ åœé¡¿ ä¸¤æ¬¡ STW MarkÂ Setup \u0026amp; MarkÂ Terminationï¼Œé€šå¸¸ \u0026lt;â€¯1â€¯ms å¹¶å‘ åå°/è¾…åŠ©æ ‡è®° + æ¸…æ‰« ä¸šåŠ¡çº¿ç¨‹æŒ‰â€œåˆ†é…æ¯”ä¾‹â€ä¸»åŠ¨å¹² GCï¼Œåå° goroutine æŒç»­å·¥ä½œ å†…å­˜å›æ”¶ SpanÂ æ¸…æ‰« + Scavenger å°å¯¹è±¡å½’è¿˜åˆ° perâ€‘PÂ ç©ºé—²é“¾ï¼Œå¤§ Span é€€è¿˜æ“ä½œç³»ç»Ÿ 2â€¯Â·â€¯ä¸€æ¬¡ GCÂ å¾ªç¯ # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ STW #1 â”‚ â”‚ STW #2 â”‚ â”‚ Mark Setup â”‚â”€â”€â–¶â”€â”€â–¶â”‚ Mark Termination (é»‘å®Œç°) â”‚ â””â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚å¹¶å‘å†™å±éšœ â”‚å¹¶å‘ Sweep / Scavenge â””â”€â”€â”€â–º å¹¶å‘æ ‡è®° (Mutator Assist + BG marker) â”€â”€â”€â”€â–ºâ”˜ 2.1Â é˜¶æ®µè¦ç‚¹ # é˜¶æ®µ ä½œç”¨ å…¸å‹è€—æ—¶ (8C/2â€¯GiB) MarkÂ SetupÂ (STW) æ ¹å¯¹è±¡ç°åŒ–ï¼ˆæ ˆ/å…¨å±€/å¯„å­˜å™¨ï¼‰ï¼›æ‰“å¼€å†™å±éšœ 30â€“200â€¯Âµs å¹¶å‘æ ‡è®° ç° â†’ é»‘ï¼›MutatorÂ AssistÂ æŒ‰åˆ†é…é‡å¸®å¿™ 1â€“100â€¯ms (å¹¶å‘) MarkÂ TerminationÂ (STW) ç°é˜Ÿåˆ—æ¸…ç©ºï¼›åœå†™å±éšœï¼›è®°å½• liveBytes 50â€“400â€¯Âµs å¹¶å‘æ¸…æ‰« (Sweep) éå† spanï¼Œå°†ç©ºé—²å—å½’è¿˜ mcentral 1â€“100â€¯ms (å¹¶å‘) Scavenger å¤§å—ç©ºé—²é¡µ madviseÂ å› OSï¼Œå‹ RSS æŒç»­åå° 3â€¯Â·â€¯ä¸‰è‰²æ ‡è®° \u0026amp; å†™å±éšœ # 3.1Â é¢œè‰²å«ä¹‰ # é¢œè‰² çŠ¶æ€ è¡Œä¸º ç™½ æœªè®¿é—® å¯èƒ½åƒåœ¾ ç° å·²å‘ç°æœªæ‰«æ ç­‰å¾…æ‰«æ é»‘ å·²æ‰«æ æ´»å¯¹è±¡ ä¸å˜å¼ï¼šé»‘å¯¹è±¡ä¸èƒ½æŒ‡å‘ç™½å¯¹è±¡ã€‚\nå†™å±éšœè´Ÿè´£åœ¨ Mutator å¹¶å‘å†™æŒ‡é’ˆæ—¶ï¼ŒæŠŠ æ—§å€¼ æˆ– æ–°å€¼ ç°åŒ–ï¼Œç»´æŒä¸å˜å¼ã€‚\n3.2Â HybridÂ WriteÂ Barrier # dstOld := *p // è¯»å–æ—§æŒ‡é’ˆ * p = newPtr // å†™æ–°æŒ‡é’ˆ shade(dstOld) // ç°åŒ–æ—§å€¼ ç¼–è¯‘å™¨åœ¨æ’æ¡©é˜¶æ®µå¯¹ â€œå¯èƒ½åœ¨ GC æ—¶å†™æŒ‡é’ˆâ€ çš„æŒ‡ä»¤åŒ…è£¹ writebarrierptrã€‚ åªæœ‰åœ¨ å¹¶å‘æ ‡è®°çª—å£ å†…å±éšœæ‰åšå®äº‹ï¼Œå…¶ä½™æ—¶é—´æ˜¯ç©ºå‡½æ•° â†’ 99.9% è·¯å¾„é›¶å¼€é”€ã€‚ 4â€¯Â·â€¯MutatorÂ Assist æœºåˆ¶ # åˆ†é…è·¯å¾„ä¼šç´¯åŠ  assist debt\ndebt += bytesAllocated * (markWorkRate / allocRate) è‹¥è´Ÿå€ºè¶…é˜ˆå€¼ï¼Œåˆ™åœ¨åˆ†é…è°ƒç”¨æ ˆä¸­ ä¸»åŠ¨æ‰«æç°å¯¹è±¡ï¼Œç›´åˆ°å¿è¿˜å€ºåŠ¡ã€‚ è¿™æ ·å®ç° â€œGC é€Ÿåº¦ â‰¥ åˆ†é…é€Ÿåº¦â€ çš„è‡ªé€‚åº”èŠ‚å¥ï¼Œæ— éœ€é¢‘ç¹å…¨å±€é”ã€‚ 5â€¯Â·â€¯HeapÂ å¸ƒå±€ä¸æ¸…æ‰« # æ¦‚å¿µ ç²’åº¦ åŠŸèƒ½ Span 8â€¯KiBâ€“4â€¯MiB å†…å­˜ç®¡ç†åŸºæœ¬å•å…ƒï¼Œè®°å½•å¯¹è±¡ä½å›¾ Class (size class) 8â€¯Bâ€“32â€¯KiB å…± 67Â æ¡£ å°å¯¹è±¡æŒ‰ classÂ åˆ†é…ï¼Œå¤ç”¨ç¼“å­˜ MCache (æ¯ P) çº¿ç¨‹/å¤„ç†å™¨æœ¬åœ°ç©ºé—²é“¾ åˆ†é…æ— éœ€é” MCentral å…¨å±€ç©ºé—²é“¾ Sweep å°† Free span å›æ”¶ Sweepï¼š\nè¯»å– span ä½å›¾ï¼Œé»‘å¯¹è±¡æ‰€åœ¨ block æ ‡è®°ä¿ç•™ã€‚ å…¶ä½™ block å½’å¹¶åˆ° freeListï¼›è‹¥æ•´ Span ç©ºï¼ŒæŒ‚åˆ° mheap.sweepSpansEmptyã€‚ åˆ†é…è‹¥æ— ç¼“å­˜ï¼Œä¼šè§¦å‘ Onâ€‘Demand Sweepã€‚ 6â€¯Â·â€¯ScavengerÂ (é€€è¿˜ç‰©ç†å†…å­˜) # GoÂ 1.17 èµ· èƒŒæ™¯çº¿ç¨‹ + Bitmap è¿½è¸ª unusedÂ é¡µã€‚ è¾¾é˜ˆå€¼åè°ƒç”¨ madvise(MADV_DONTNEED) â†’ OS ç«‹åˆ»å›æ”¶ç‰©ç†é¡µï¼ŒRSSÂ ä¸‹é™ã€‚ å— GODEBUG=madvdontneed=1Â æ§åˆ¶ï¼›é»˜è®¤ä¸ºå¼€ã€‚ 7â€¯Â·â€¯å †ç›®æ ‡ \u0026amp; èŠ‚å¥æ§åˆ¶ # targetHeap = liveHeap * (1 + GOGC/100) // é»˜è®¤ GOGC=100 åˆ†é…è¾¾åˆ° targetHeap â†’ è§¦å‘ä¸‹ä¸€è½® GCã€‚ GOGCâ†“ æå‰è§¦å‘ã€é™ä½å³°å€¼å†…å­˜ï¼›GOGCâ†‘ åä¹‹ä½†æš‚åœæ¬¡æ•°å‡ã€‚ GoÂ 1.19 å¼•å…¥ SoftÂ MemoryÂ Limitï¼šè‹¥è¿›ç¨‹ RSS è¶…é˜ˆå€¼ï¼ŒGC ä¼šåŠ å€é€Ÿç‡ç›´è‡³é™å›ã€‚ 8â€¯Â·â€¯è§‚æµ‹æŒ‡æ ‡é€ŸæŸ¥ # Metric (Prometheus/runtime) è§£è¯» gc.pause_ns.sum / gc.pause_total_ns ç´¯è®¡ STWï¼›å°¾å»¶è¿Ÿæ•æ„Ÿä¸šåŠ¡å»ºè®® \u0026lt;â€¯100â€¯ms/min gc.cycles.total / gc.heap_objects GC é¢‘ç‡ \u0026amp; å­˜æ´»å¯¹è±¡è¶‹åŠ¿ gc.cpu.ns / process_cpu_seconds_total GC CPU æ¯”ä¾‹ï¼›\u0026gt;30% éœ€ä¼˜åŒ– heap_released vs heap_idle é‡Šæ”¾ç»™ OS çš„é¡µ vs æœªç”¨é¡µï¼›ç¢ç‰‡è§‚æµ‹ gc.assist_cpu_fraction (1.22) Mutator Assist å ç”¨ï¼›è¿‡é«˜è¯´æ˜åˆ†é…è¿‡çŒ› 9â€¯Â·â€¯ç‰ˆæœ¬æ¼”è¿›äº®ç‚¹ # ç‰ˆæœ¬ é‡è¦å˜åŒ– æ•ˆæœ 1.14 AsyncÂ preemptï¼›å‡½æ•°ä¸­é€”æŠ¢å  STW å‹ç¼© Ã—Â 2 1.17 æ–°Â Scavengerï¼›Huge Page æ„ŸçŸ¥ å®¹å™¨ RSS â€‘30% 1.19 SoftÂ MemoryÂ Limitï¼›Pacing é‡å†™ OOM é£é™©æ˜¾è‘—ä¸‹é™ 1.22 å†™å±éšœè·¯å¾„ç®€åŒ–ï¼›ç°é˜Ÿåˆ—ä¼˜åŒ– 2â€¯GiB å † STW \u0026lt;Â 1â€¯ms 1.23 (è®¡åˆ’) å¹´è½»ä»£ï¼ˆGenerationalï¼‰åŸå‹ è¿›ä¸€æ­¥å‰Šå‡çŸ­å‘½å¯¹è±¡æˆæœ¬ 10â€¯Â·â€¯å®æˆ˜å»ºè®® # å…ˆé‡åŒ–ï¼šæ‰“å¼€ runtime/metrics â†’ Prometheusï¼Œç¡®å®šç©¶ç«Ÿæ˜¯æš‚åœã€CPUã€è¿˜æ˜¯ RSS ç“¶é¢ˆã€‚ çƒ­ç‚¹ä»£ç å®¡é€ƒé€¸ï¼šgo build -gcflags=-m + benchmem é‡åŒ– allocs/opã€‚ åˆç†è°ƒ GOGCï¼šå†…å­˜ç´§ â†’ 50â€“80ï¼›CPU å¿™ â†’ 150â€“200ï¼›ä¸Šçº¿å‰å‹æµ‹æ‰¾å¹³è¡¡ç‚¹ã€‚ å®¹å™¨ç¯å¢ƒï¼šè®¾ç½® GOMEMLIMIT æˆ– GODEBUG=softmemlimit=â€¦ï¼Œé¿å… K8sÂ OOMKillã€‚ å‡çº§ Go ç‰ˆæœ¬ï¼šå¤§ç‰ˆæœ¬ GC æ”¹è¿›æ˜¾è‘—ï¼Œä¼˜å…ˆè€ƒè™‘ 1.22+ã€‚ ä¸€å¥è¯è®°å¿† # â€œæçŸ­ STW + å¹¶å‘æ ‡è®° + è‡ªåŠ©åŠ©æ”» + èƒŒæ™¯æ¸…æ‰« + ç‰©ç†é¡µå›æ”¶â€ = Goâ€¯GC æˆç†Ÿæ–¹æ¡ˆã€‚\nè‹¥ä½ æ‰‹ä¸Šæœ‰ gctrace æ—¥å¿—ã€heapÂ pprofã€trace.out ç­‰æ–‡ä»¶ï¼Œæˆ–æƒ³é’ˆå¯¹ç‰¹å®šåœºæ™¯ï¼ˆå»¶è¿Ÿã€å†…å­˜ã€CPUï¼‰è°ƒä¼˜ï¼Œéšæ—¶å‘ç»™æˆ‘ï¼Œæˆ‘ä»¬å¯ä»¥é€è¡Œè§£è¯»å¹¶ç»™å‡ºå‚æ•°ä¸ä»£ç çº§å»ºè®®ã€‚\n"},{"id":97,"href":"/docs/go/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/go_gmp_model/","title":"Go Gmp Model","section":"æ•°æ®ç»“æ„","content":" GoÂ è¿è¡Œæ—¶è°ƒåº¦ï¼šGâ€‘Pâ€‘MÂ æ¨¡å‹å…¨è§£ # é€‚ç”¨ç‰ˆæœ¬ï¼šGoÂ 1.22ï¼ˆè®¾è®¡è‡ª 1.2 å¥ åŸºï¼Œ1.14 æ­é…å¼‚æ­¥æŠ¢å å½¢æˆå½“å‰å½¢æ€ï¼‰\næ ¸å¿ƒæ¦‚å¿µï¼šGoroutine (G)ã€Processor (P)ã€Machine (M)\nå…³é”®è¯ï¼šWorkâ€‘stealingã€Run Queueã€SyscallÂ Blockã€Netpollã€AsyncÂ Preempt\n1Â Â·Â ä¸ºä»€ä¹ˆè¦æœ‰ Gâ€‘Pâ€‘Mï¼Ÿ # ç›®æ ‡ é—®é¢˜ è§£å†³æ–¹æ¡ˆ é«˜å¹¶å‘ Goroutine æ•°å¯è¾¾ç™¾ä¸‡ï¼›ç¨€ç¼ºèµ„æºæ˜¯æ ¸æ•° å¼•å…¥ PÂ æ‰¿è½½è°ƒåº¦ä¸Šä¸‹æ–‡ ä½æˆæœ¬åˆ‡æ¢ OS çº¿ç¨‹åˆ‡æ¢æ˜‚è´µï¼ˆ\u0026gt;1â€¯Âµsï¼‰ åœ¨ç”¨æˆ·æ€åˆ‡æ¢ G (~30â€¯ns) å……åˆ†åˆ©ç”¨å¤šæ ¸ å…¨å±€é” \u0026amp; çº¿ç¨‹ç«äº‰ä¸¥é‡ Workâ€‘stealing + å±€éƒ¨é˜Ÿåˆ— éšè—é˜»å¡ ç³»ç»Ÿè°ƒç”¨/ç½‘ç»œ IO å¯èƒ½å¡æ ¸ M \u0026lt;=\u0026gt; P è§£ç»‘ï¼Œé˜»å¡ä¸æ‹–æ…¢è°ƒåº¦ 2Â Â·Â ä¸‰å¤§è§’è‰² # 2.1Â GÂ â€” Goroutine æ§åˆ¶å— # type g struct { stack stack // [lo, hi) sched gobuf // ä¿å­˜å¯„å­˜å™¨å¿«ç…§ status uint32 // _Grunnable, _Grunning, ... m *m // æ­£åœ¨æ‰§è¡Œè¯¥ g çš„ M stackguard0, stackguard1 uintptr // æŠ¢å  \u0026amp; ç¼ºæ ˆæ£€æŸ¥ // ...çœç•¥ } ç”Ÿå‘½å‘¨æœŸï¼š_Gidle â†’ _Grunnable â†’ _Grunning â†’ _Gwaiting/_Gdead â€¦ ç‰¹æ®Š gï¼šg0 (ç³»ç»Ÿæ ˆ)ã€gsignal (ä¿¡å·æ ˆ) 2.2Â PÂ â€” Processor (é€»è¾‘ CPU) # å­—æ®µ å«ä¹‰ runq [256]g æ¯â€¯P æœ¬åœ°ç¯å½¢é˜Ÿåˆ— runqhead/runqtail æ— é”ç¯é˜Ÿåˆ—æŒ‡é’ˆ schedtick è°ƒåº¦è®¡æ•°ï¼›æŠ¢å é—¨æ§ mcache æœ¬åœ°å¯¹è±¡ç¼“å­˜ (alloc fastâ€‘path) gcAssistTime GCÂ åŠ©æ”»è®¡æ—¶ P çš„æ•°é‡ = GOMAXPROCSï¼Œå†³å®šå¹¶å‘åº¦ä¸Šé™ã€‚\n2.3Â MÂ â€” Machine (ç»‘å®š OS çº¿ç¨‹) # å­—æ®µ è¯´æ˜ g0 ç³»ç»Ÿæ ˆï¼›æ‰§è¡Œè°ƒåº¦ã€GC curg å½“å‰è¿è¡Œçš„ G p ç»‘å®šçš„Â P (å¯ç©º) park å½“æ—  P å¯ç”¨æ—¶ç¡çœ çš„ semaphore M å¯ å¤šäº Pï¼ˆé˜»å¡ç³»ç»Ÿè°ƒç”¨éœ€é¢å¤–çº¿ç¨‹ï¼‰ã€‚ 3Â Â·Â è°ƒåº¦å¾ªç¯æ ¸å¿ƒæµç¨‹ # â”Œâ”€ G è¿›å…¥ runnable â”€â” â”‚ newproc/go func â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â–¼ P.runq â† push â–¼ no local G ? â”Œâ”€â”€ execute G â”€â”€â” â”€â”€â–º steal from other P â”€â” â”‚ switch to g â”‚ â”‚ â””â”€â”€â”€â–º run g â”‚ â–¼ â”‚ global runq ? â”‚ syscall/block â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º steal from global â–¼ hand P back to sched 3.1Â æœ¬åœ°ä¼˜å…ˆ \u0026amp; Workâ€‘stealing # M ä» P.runq PopÂ Gï¼Œè‹¥ç©ºï¼š ä»å…¨å±€é˜Ÿåˆ— sched.runq æŠ¢ 0.5Â æ‰¹é‡ éšæœºæŒ‘ä¸€åŠ P å°è¯• stealÂ 1/2Â G æ–° G åˆ›å»ºæ—¶ä¼˜å…ˆå…¥ å½“å‰ P.runqï¼›è‹¥æ»¡å†å…¥å…¨å±€ã€‚ 3.2Â ç³»ç»Ÿè°ƒç”¨å¤„ç† # è¿›å…¥ï¼šg è¿›å…¥ _Gsyscallï¼›M æ”¾å› Pï¼Œè‡ªèº«è¿›å…¥ syscallÂ é˜Ÿåˆ—ã€‚ è¿”å›ï¼šå”¤é†’ä¼‘çœ  M æˆ–æ–°å»º M ä»¥æ¥ç®¡ç©ºé—² Pã€‚ 3.3Â ç½‘ç»œ Poller \u0026amp; Timer # netpoll è½®è¯¢ epoll/kqueueï¼›å°±ç»ªÂ G ç›´æ¥æ”¾å…¥å½“å‰Â P æˆ–å…¨å±€é˜Ÿåˆ—ã€‚ timer åˆ°æœŸååŒæ ·å…¥é˜Ÿã€‚ 3.4Â æŠ¢å  # æ–¹å¼ ç‰ˆæœ¬ è§¦å‘ åä½œæŠ¢å  å…¨ç‰ˆæœ¬ å‡½æ•°åºè¨€Â stackguard0 æ£€æŸ¥ å¼‚æ­¥æŠ¢å  â‰¥1.14 å‘çº¿ç¨‹å‘é€ä¿¡å·ï¼Œä¸­æ–­åˆ° g0 4Â Â·Â çŠ¶æ€æœºä¸€è§ˆ # +---------+ | _Gidle | +----+----+ | new G | acquire P v +---------+ runnable +-----------+ | _Gdead |-----------\u0026gt; | _Grunnable| +---------+ +-----+-----+ | schedule v +-----+-----+ | _Grunning | +--+---+----+ | | syscall/block| |time slice | | +------+------+----+ | _Gsyscall | _Gwaiting +------------+-------+ 5Â Â·Â å…³é”®æºç å¯¼èˆª # æ–‡ä»¶ å…³æ³¨å‡½æ•° / ç»“æ„ è¯´æ˜ runtime/proc.go schedule, execute, newproc, goexit è°ƒåº¦ä¸»å¾ªç¯ä¸ G åˆ›å»ºã€é”€æ¯ runtime/runtime2.go type g, type m, type p ä¸‰å¤§æ ¸å¿ƒæ•°æ®ç»“æ„ runtime/asm_*.s goschedguarded, asminit æ±‡ç¼–å…¥å£ã€å¯„å­˜å™¨ä¿å­˜ runtime/netpoll_kqueue.goÂ /Â _epoll.go netpoll I/O å¤šè·¯å¤ç”¨é›†æˆ 6Â Â·Â è°ƒä¼˜ä¸è§‚æµ‹ # åœºæ™¯ æŒ‡æ ‡ / å·¥å…· å»ºè®® è°ƒåº¦ç“¶é¢ˆ go tool trace â†’ â€œScheduler Latencyâ€ è§‚å¯Ÿ Proc Idle vs Runnable è¿‡é‡çº¿ç¨‹ M-\u0026gt;P Ratio (runtime metrics) é¢‘ç¹ syscall â†’ ä¼˜åŒ– I/O æ¨¡å‹ æ ˆæ‹·è´é«˜ pprof gcsamples-bytes é¿å…æ·±é€’å½’ \u0026amp; å¤§å±€éƒ¨å˜é‡ æŠ¢å å»¶è¿Ÿ trace GoSched/GoPreempt runtime/debug.SetMaxThreads(â€¦) 7Â Â·Â å¸¸è§é—®é¢˜æ’æŸ¥ # ç—‡çŠ¶ å¯èƒ½åŸå›  æ’æŸ¥ CPU åˆ©ç”¨ç‡ä½ GOMAXPROCS \u0026lt; CPU æˆ– goroutine é˜»å¡å¤š runtime.GOMAXPROCS(0) / trace é«˜å»¶è¿Ÿå°–åˆº ç³»ç»Ÿè°ƒç”¨é˜»å¡ï¼›æŠ¢å ä¸åŠæ—¶ sysmon æ—¥å¿— / schedtrace=1000 çº¿ç¨‹çˆ†ç‚¸ cgo æˆ–åå¤é™·å…¥é˜»å¡ ps -L / debug.SetMaxThreads 8Â Â·Â ç‰ˆæœ¬æ¼”è¿›äº®ç‚¹ # ç‰ˆæœ¬ æ”¹è¿› å½±å“ 1.2 å¼•å…¥ Pã€æœ¬åœ° runq å¤§å¹…æå‡å¹¶å‘åº¦ 1.10 netpoll å‡çº§ \u0026amp; timer åˆ†å±‚ å®šæ—¶å™¨æ•ˆç‡â†‘ 1.14 AsyncÂ Preempt æŠ¢å å»¶è¿Ÿä» ms â†’Â Âµs 1.20 è°ƒåº¦å™¨ trace é‡å†™ å¯è§†åŒ–æ›´å‹å¥½ 1.22 Goroutine Aware Alloc (mcache) åˆ†é…å¿«â€‘path è¿›ä¸€æ­¥æœ¬åœ°åŒ– 9Â Â·Â å®æˆ˜ Tips # ä¼˜å…ˆæœ¬åœ°åŒ–ï¼šé¿å…åœ¨çƒ­ç‚¹å¾ªç¯ä¸­åˆ›å»º/é”€æ¯ goroutineï¼Œå¯ç”¨å¯¹è±¡æ± æˆ– channel ç¼“å†²å¤ç”¨ã€‚ åˆç† GOMAXPROCSï¼šI/O å‹æœåŠ¡å¯ç•¥å°äº CPU æ ¸ï¼›è®¡ç®—å‹è´´åˆç‰©ç†æ ¸æ•°ã€‚ å–„ç”¨ go tool traceï¼šè°ƒåº¦å¯è§†åŒ–æœ€ç›´æ¥ã€‚ é¿å…é•¿é˜»å¡ï¼šæ•°æ®åº“/ç½‘ç»œè°ƒç”¨åŠ å…¥è¶…æ—¶ï¼›å¿…è¦æ—¶ç”¨ semaphore æ§å¹¶å‘ã€‚ ä½¿ç”¨ GODEBUG=schedtrace=1000,scheddetail=1 è§‚æµ‹å®æ—¶ Runq é•¿åº¦ã€‚ ä¸€å¥è¯æ€»ç»“ # M æ‰§è¡Œ Gï¼ŒP æä¾›æ‰§è¡Œæƒï¼Œrunq + steal è®© goroutine åœ¨å¤šæ ¸é—´å‡è¡¡ï¼Œé«˜å¹¶å‘ä½å¼€é”€ã€‚\nå¦‚éœ€å¯¹ trace ç«ç„°å›¾ã€schedtrace æ—¥å¿— åšæ·±å…¥è§£æï¼Œæˆ–å®šä½è°ƒåº¦å»¶è¿Ÿå°–åˆºï¼Œæ¬¢è¿å°†æ•°æ®å‘ç»™æˆ‘ï¼Œä¸€èµ·é€å¸§åˆ†æã€‚\n"},{"id":98,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-event/example/","title":"Example","section":"argo event","content":" ğŸš€ Argo Events æ”¯æŒçš„ Trigger ç±»å‹ + Sensor + EventBus ç¤ºä¾‹åˆé›† # âœ… EventBusï¼ˆNATS é»˜è®¤ï¼‰ç¤ºä¾‹ # apiVersion: argoproj.io/v1alpha1 kind: EventBus metadata: name: default namespace: argo-events spec: nats: native: replicas: 3 auth: token âœ… Sensor + Trigger ç¤ºä¾‹åˆé›† # ğŸ“Œ 1. Kubernetes Trigger - åˆ›å»º Workflow # apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: workflow-sensor namespace: argo-events spec: dependencies: - name: webhook-dep eventSourceName: webhook-source eventName: webhook triggers: - template: name: create-workflow k8s: group: argoproj.io version: v1alpha1 resource: workflows operation: create source: resource: apiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: example-workflow- spec: entrypoint: whalesay templates: - name: whalesay container: image: docker/whalesay command: [cowsay] args: [\u0026#34;Hello from Argo Events\u0026#34;] ğŸ“Œ 2. HTTP Trigger - è°ƒç”¨å¤–éƒ¨ Webhook # apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: http-trigger-sensor spec: dependencies: - name: webhook-dep eventSourceName: webhook-source eventName: webhook triggers: - template: name: call-http http: url: https://hooks.example.com/build method: POST payload: - src: dependencyName: webhook-dep dataKey: body dest: body.data headers: - name: Content-Type value: application/json ğŸ“Œ 3. Kafka Trigger - å‘é€æ¶ˆæ¯ # apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: kafka-trigger-sensor spec: dependencies: - name: kafka-dep eventSourceName: kafka-source eventName: my-topic triggers: - template: name: kafka-trigger kafka: url: kafka.default.svc.cluster.local:9092 topic: result-topic partition: 0 parameters: - src: dependencyName: kafka-dep dataKey: body.message dest: payload ğŸ“Œ 4. AWS Lambda Trigger - æ‰§è¡Œå‡½æ•° # apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: lambda-trigger-sensor spec: dependencies: - name: webhook-dep eventSourceName: webhook-source eventName: webhook triggers: - template: name: call-lambda awsLambda: functionName: myLambdaFunction region: us-west-2 accessKey: key: accesskey name: aws-creds secretKey: key: secretkey name: aws-creds payload: - src: dependencyName: webhook-dep dataKey: body dest: body.message ğŸ“Œ 5. Argo Workflow Triggerï¼ˆç®€å†™æ–¹å¼ï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: simple-workflow-sensor spec: dependencies: - name: git-push eventSourceName: github-source eventName: push triggers: - template: name: simple-workflow argoWorkflow: group: argoproj.io version: v1alpha1 resource: workflows operation: create source: inline: apiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: gitops- spec: entrypoint: hello templates: - name: hello container: image: alpine command: [\u0026#34;echo\u0026#34;] args: [\u0026#34;Git pushed, deploying...\u0026#34;] ğŸ“š æ€»ç»“ # æ¯ç§ Trigger ç±»å‹éƒ½å¯é…åˆä»»æ„ EventSourceï¼Œå¦‚ Webhook/Kafka/S3/Cron ç­‰ä½¿ç”¨ã€‚EventBus æä¾›ä¼ è¾“é€šé“ï¼ˆé»˜è®¤ NATSï¼‰ï¼ŒSensor ç®¡ç†ä¾èµ–å’Œäº‹ä»¶é€»è¾‘ï¼ŒTrigger æ‰§è¡Œå®é™…åŠ¨ä½œã€‚\næ›´å¤šæ¨¡æ¿å‚è€ƒï¼šhttps://github.com/argoproj/argo-events/tree/master/examples\n"},{"id":99,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/argo/argo-rollout/example/","title":"Example","section":"argo rollout","content":" ğŸš€ Argo CD ç”Ÿäº§ç¯å¢ƒæœ€å¤æ‚ç¤ºä¾‹ï¼ˆå¤šæœåŠ¡ã€å¤šé›†ç¾¤ã€å¤šç¯å¢ƒã€Helm + Rolloutsï¼‰ # æœ¬ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Argo CD ç®¡ç†å¤šä¸ªæœåŠ¡ã€ç¯å¢ƒå’Œé›†ç¾¤ï¼Œç»“åˆ Helmã€Rolloutsã€Projectã€RBACã€ApplicationSet æ„å»ºå®Œæ•´ GitOps æµæ°´çº¿ã€‚\nğŸ“ Git ä»“åº“ç»“æ„çº¦å®š # apps/ â”œâ”€â”€ svc-a/ â”‚ â””â”€â”€ charts/ â”‚ â”œâ”€â”€ dev/values.yaml â”‚ â”œâ”€â”€ stage/values.yaml â”‚ â””â”€â”€ prod/values.yaml â”œâ”€â”€ svc-b/ â”‚ â””â”€â”€ charts/ â”‚ â”œâ”€â”€ dev/values.yaml â”‚ â””â”€â”€ prod/values.yaml â””â”€â”€ rollout-templates/ â””â”€â”€ nginx-rollout.yaml ğŸ§© 1. AppProject å®šä¹‰ï¼ˆå¤šæœåŠ¡éš”ç¦»ï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: AppProject metadata: name: microservices namespace: argocd spec: description: Production microservice apps sourceRepos: - https://github.com/your-org/gitops-repo.git destinations: - namespace: svc-* server: https://kubernetes.default.svc - namespace: svc-* server: https://k8s-prod.example.com clusterResourceWhitelist: - group: \u0026#34;*\u0026#34; kind: \u0026#34;*\u0026#34; namespaceResourceWhitelist: - group: \u0026#34;*\u0026#34; kind: \u0026#34;*\u0026#34; âš™ï¸ 2. ApplicationSetï¼ˆæœåŠ¡ x ç¯å¢ƒ x é›†ç¾¤ x Rolloutï¼‰ # apiVersion: argoproj.io/v1alpha1 kind: ApplicationSet metadata: name: multi-svc-prod namespace: argocd spec: generators: - matrix: generators: - git: repoURL: https://github.com/your-org/gitops-repo.git revision: main directories: - path: apps/*/charts/* - list: elements: - env: dev cluster: https://kubernetes.default.svc - env: prod cluster: https://k8s-prod.example.com template: metadata: name: \u0026#39;{{path[1]}}-{{env}}\u0026#39; spec: project: microservices source: repoURL: https://github.com/your-org/gitops-repo.git targetRevision: main path: apps/{{path[1]}}/charts/{{env}} helm: valueFiles: - values.yaml destination: server: \u0026#39;{{cluster}}\u0026#39; namespace: svc-{{path[1]}}-{{env}} syncPolicy: automated: prune: true selfHeal: true syncOptions: - CreateNamespace=true - ApplyOutOfSyncOnly=true ğŸ” 3. ç¤ºä¾‹æœåŠ¡ä½¿ç”¨ Rolloutsï¼ˆHelm Chart ä¸­åŒ…å« rollout.yamlï¼‰ # åœ¨ values.yaml ä¸­æ§åˆ¶æ˜¯å¦å¯ç”¨ Rollout ç±»å‹èµ„æºæ›¿ä»£ Deploymentã€‚\nrollout: enabled: true strategy: canary canary: steps: - setWeight: 10 - pause: {duration: 1m} - setWeight: 100 analysis: enabled: true templateName: success-rate-check Chart æ¨¡æ¿ç»“æ„å‚è€ƒ nginx-rollout.yamlï¼š\napiVersion: argoproj.io/v1alpha1 kind: Rollout metadata: name: {{ .Release.Name }} spec: strategy: canary: steps: - setWeight: 10 - pause: {duration: 1m} ğŸ” 4. RBAC é™åˆ¶ # apiVersion: v1 kind: ConfigMap metadata: name: argocd-rbac-cm namespace: argocd data: policy.csv: | g, devops-team, role:microservices-admin p, role:microservices-admin, applications, *, microservices/*, allow ğŸ” 5. é›†æˆå»ºè®® # Prometheus + Grafanaï¼šç”¨äºç›‘æ§ Rollout çŠ¶æ€ä¸æŒ‡æ ‡åˆ†æ Istioï¼šç”¨äºé‡‘ä¸é›€æµé‡æ§åˆ¶ Dex + OIDCï¼šç”¨æˆ·è®¤è¯ + å•ç‚¹ç™»å½• Argo Notificationsï¼šé€šçŸ¥éƒ¨ç½²çŠ¶æ€å˜åŒ– Loki/EFKï¼šæ—¥å¿—å®¡è®¡ Cert-Manager + Ingressï¼šHTTPS è®¿é—® Argo CD ç•Œé¢ ğŸ§  æ€»ç»“åŠŸèƒ½è¦†ç›– # æ¨¡å— æ˜¯å¦åŒ…å« å¤šæœåŠ¡æ”¯æŒ âœ… å¤šç¯å¢ƒï¼ˆdev/prodï¼‰ âœ… å¤šé›†ç¾¤éƒ¨ç½² âœ… Helm ç®¡ç†é…ç½® âœ… Canary Rollout + Prometheus âœ… è‡ªåŠ¨åŒæ­¥ã€è‡ªæ„ˆã€å‘½åç©ºé—´è‡ªåŠ¨åˆ›å»º âœ… RBAC + Project + SSO âœ… å¯è§‚æµ‹æ€§ä¸é€šçŸ¥ âœ… ApplicationSet åŠ¨æ€ç”Ÿæˆ âœ… ğŸ“š å‚è€ƒæ–‡æ¡£ # Argo CD ApplicationSetï¼šhttps://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/ Argo Rolloutsï¼šhttps://argo-rollouts.readthedocs.io/ Prometheus Metrics + AnalysisRunï¼šhttps://argo-rollouts.readthedocs.io/en/stable/features/analysis/ "},{"id":100,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/harbor/example/","title":"Example","section":"Harbor","content":" ğŸ§ª Harbor æœ€å¤æ‚çš„ç”Ÿäº§ä½¿ç”¨ç¤ºä¾‹ # æœ¬ç¤ºä¾‹æ¼”ç¤ºåœ¨ä¼ä¸šçº§ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ Harbor çš„å¤æ‚é›†æˆä¸æœ€ä½³å®è·µã€‚è¯¥æ¡ˆä¾‹åŒ…æ‹¬å¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²ã€Keycloak å•ç‚¹ç™»å½•ã€CI/CDã€é•œåƒç­¾åã€æ¼æ´æ‰«æã€å¤šç§Ÿæˆ·ã€å¼‚åœ°ç¾å¤‡ç­‰å®Œæ•´åœºæ™¯ã€‚\nğŸ­ åœºæ™¯èƒŒæ™¯ # ä¼ä¸šè§„æ¨¡ï¼šè·¨å›½å…¬å¸ æ•°æ®ä¸­å¿ƒï¼šåŒ—äº¬ã€ä¸Šæµ·ã€æ–°åŠ å¡ ç”¨æˆ·ç®¡ç†ï¼šKeycloak + AD åŒæ­¥ é•œåƒç±»å‹ï¼šå®¹å™¨é•œåƒã€Helm Chartã€AI æ¨¡å‹ DevOps å·¥å…·ï¼šGitLab CIã€Argo CDã€Cosign å®‰å…¨è¦æ±‚ï¼šé•œåƒç­¾åã€æ¼æ´æ‰«æã€RBACã€å®¡è®¡æ—¥å¿— ğŸ§° ç»„ä»¶éƒ¨ç½²æ¶æ„ # +---------------------------+ +---------------------------+ | Developer (GitLab) | | SSO (Keycloak + AD) | +-------------+-------------+ +-------------+-------------+ | | v | GitLab CI/CD Runner | | | v v +--------+---------+ +-----------+-----------+ | Harbor (ä¸») | \u0026lt;------------\u0026gt; | Keycloak Realm | | harbor.beijing | | realm: harbor | +--------+---------+ +------------------------+ | é•œåƒå¤åˆ¶ç­–ç•¥ (åŒå‘) v +--------+---------+ | Harbor (å¤‡) | | harbor.singapore | +------------------+ ğŸ” å®‰å…¨é…ç½® # 1. OIDC ç™»å½•ä¸æƒé™æ§åˆ¶ # å¯ç”¨ Keycloak OIDC æ¨¡å¼ Harbor è®¾ç½®ä¸º auth_mode: oidc Keycloak åŒæ­¥ AD ç”¨æˆ·ï¼Œåˆ†ç»„æ˜ å°„ Harbor é¡¹ç›® Harbor å†…éƒ¨ä½¿ç”¨ RBAC ç²¾ç»†åŒ–æˆæƒï¼ˆä¾‹å¦‚ project-admin, developer, guestï¼‰ 2. é•œåƒç­¾åï¼ˆCosignï¼‰ # CI/CD é˜¶æ®µä½¿ç”¨ Cosign å¯¹æ„å»ºå¥½çš„é•œåƒç­¾åï¼š cosign sign --key k8s://default/mykey docker.io/acme/app:1.0.0 Harbor å¯ç”¨é•œåƒéªŒè¯ç­–ç•¥ï¼Œç¡®ä¿éƒ¨ç½²å‰å¿…é¡»éªŒè¯ç­¾å 3. æ¼æ´æ‰«æï¼ˆTrivyï¼‰ # Harbor å¯ç”¨ Trivy Scanner é…ç½®ä¸Šä¼ å³æ‰«æç­–ç•¥ ç»“åˆ Argo CD å®ç°æ¼æ´é˜»æ–­éƒ¨ç½² 4. å®¡è®¡æ—¥å¿—ä¸å­˜å‚¨åŠ å¯† # å®¡è®¡æ—¥å¿—å¼€å¯ï¼Œå¯¼å‡ºè‡³ ELK ç³»ç»Ÿ Harbor å­˜å‚¨åç«¯ä¸º S3ï¼Œå¼€å¯æœåŠ¡ç«¯åŠ å¯†ï¼ˆSSEï¼‰ ğŸ”„ é•œåƒåŒæ­¥ç­–ç•¥ # Harbor ä¸»èŠ‚ç‚¹ï¼ˆåŒ—äº¬ï¼‰é…ç½®å¤šä¸ª replication ruleï¼š åŒæ­¥è‡³ä¸Šæµ· Harborï¼ˆå»¶è¿Ÿ 5sï¼‰ åŒæ­¥è‡³æ–°åŠ å¡ Harborï¼ˆç”¨äºç¾å¤‡ï¼‰ åŒæ­¥æ¨¡å¼ï¼šPush-basedï¼Œå®šæ—¶è§¦å‘ æ”¯æŒåŒå‘åŒæ­¥ï¼ˆé˜²æ­¢å•ç‚¹ï¼‰ ğŸš€ DevOps æµç¨‹é›†æˆ # CI é˜¶æ®µï¼ˆGitLabï¼‰ # build: script: - docker build -t harbor.beijing.company.com/dev/app:$CI_COMMIT_SHA . - docker push harbor.beijing.company.com/dev/app:$CI_COMMIT_SHA - cosign sign --key k8s://default/signkey harbor.beijing.company.com/dev/app:$CI_COMMIT_SHA CD é˜¶æ®µï¼ˆArgo CDï¼‰ # Argo CD éƒ¨ç½²å‰æ ¡éªŒé•œåƒç­¾åå’Œæ‰«æç»“æœï¼š ä½¿ç”¨ Gatekeeper + OPA ç­–ç•¥ ä¸åˆè§„é•œåƒæ‹’ç»éƒ¨ç½² ğŸ“¦ å¤šç±»å‹é•œåƒæ”¯æŒ # å®¹å™¨é•œåƒï¼ˆæ ‡å‡†ï¼‰ Helm Chart ä»“åº“ï¼ˆå¼€å¯ chartmuseumï¼‰ AI æ¨¡å‹ä»“åº“ï¼ˆé€šè¿‡ OCI artifact æ”¯æŒè‡ªå®šä¹‰ç±»å‹ï¼‰ ğŸ“Š å¤šç§Ÿæˆ·ç®¡ç† # æ¯ä¸ª BUï¼ˆä¸šåŠ¡å•å…ƒï¼‰å¯¹åº”ä¸€ä¸ª Harbor é¡¹ç›® æƒé™é€šè¿‡ Keycloak Group è‡ªåŠ¨åŒæ­¥ å„é¡¹ç›®å¯ç”¨èµ„æºé…é¢ï¼ˆQuotaï¼‰æ§åˆ¶ ğŸŒ ç¾å¤‡ä¸é«˜å¯ç”¨ # Harbor ä¸»èŠ‚ç‚¹é«˜å¯ç”¨éƒ¨ç½²ï¼ˆ3 èŠ‚ç‚¹ Nginx + Keepalived + shared DBï¼‰ é•œåƒå¼‚åœ°åŒæ­¥ + æ•°æ®å®šæœŸå¤‡ä»½ Redisã€æ•°æ®åº“å¤–éƒ¨åŒ–ï¼Œä¾¿äºè¿ç§»å’Œç›‘æ§ âœ… æ€»ç»“ # æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨çœŸå®ã€å¤æ‚çš„ä¼ä¸šç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½² Harborï¼Œå¹¶ä¸èº«ä»½ç®¡ç†ã€CI/CDã€å®‰å…¨æœºåˆ¶ã€é•œåƒæ²»ç†ç­‰ä½“ç³»æ·±åº¦é›†æˆï¼Œæ„å»ºä¸€ä¸ªç¨³å®šã€å®‰å…¨ã€é«˜æ•ˆçš„é•œåƒç®¡ç†å¹³å°ã€‚\n"},{"id":101,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/harbor/install/","title":"Install","section":"Harbor","content":" ğŸš€ Harbor ç”Ÿäº§ç¯å¢ƒå®‰è£…ä¸ Keycloak å¯¹æ¥æŒ‡å— # ğŸ—ï¸ ä¸€ã€ç”Ÿäº§ç¯å¢ƒ Harbor å®‰è£…æ­¥éª¤ # 1. ç³»ç»Ÿå‡†å¤‡ # æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04 / CentOS 7+ ç¯å¢ƒè¦æ±‚ï¼š CPU â‰¥ 2 æ ¸ å†…å­˜ â‰¥ 4 GB ç£ç›˜ â‰¥ 40 GB å®‰è£…ä¾èµ–ï¼š sudo apt update \u0026amp;\u0026amp; sudo apt install docker.io docker-compose -y 2. ä¸‹è½½ Harbor å®‰è£…åŒ… # wget https://github.com/goharbor/harbor/releases/download/v2.10.0/harbor-offline-installer-v2.10.0.tgz # è§£å‹ tar -zxvf harbor-offline-installer-*.tgz cd harbor 3. é…ç½® harbor.yml # ç¼–è¾‘ harbor.yml å…³é”®é…ç½®é¡¹ï¼š\nhostname: harbor.yourdomain.com https: port: 443 certificate: /path/to/cert.pem private_key: /path/to/key.pem harbor_admin_password: YourStrongAdminPass auth_mode: oidc oidc_provider_name: keycloak oidc_endpoint: https://keycloak.yourdomain.com/realms/harbor/.well-known/openid-configuration oidc_client_id: harbor-client oidc_client_secret: \u0026lt;your-client-secret\u0026gt; oidc_scope: openid,profile,email,groups oidc_verify_cert: true oidc_auto_onboard: true 4. å®‰è£… Harbor # ./install.sh ğŸ§© äºŒã€é…ç½® Keycloak ä¸ Harbor å¯¹æ¥ # 1. åˆ›å»º Realm # åç§°å»ºè®®ä¸º harbor 2. åˆ›å»º Client # Client ID: harbor-client Access Type: confidential Root URL: https://harbor.yourdomain.com Redirect URI: https://harbor.yourdomain.com/c/oidc/callback 3. å¯ç”¨åŠŸèƒ½ # å¯ç”¨ä»¥ä¸‹é€‰é¡¹ï¼š Standard Flow Enabled Direct Access Grants Enabled Service Accounts Enabled 4. æ˜ å°„ç”¨æˆ·ç»„ï¼ˆå¯é€‰ï¼‰ # æ·»åŠ  Mapperï¼š Name: groups Token Claim Name: groups Claim JSON Type: String Add to ID token / access token: âœ… ğŸ” ä¸‰ã€å®‰å…¨å»ºè®® # é¡¹ç›® å»ºè®® TLS è¯ä¹¦ ä½¿ç”¨ CA ç­¾å‘è¯ä¹¦ é•œåƒæ‰«æ å¯ç”¨ Trivy æ¼æ´æ‰«æ æ•°æ®åº“å¤–ç½® ä½¿ç”¨å¤–éƒ¨ PostgreSQL æå‡å¯ç»´æŠ¤æ€§ é•œåƒç­¾å é…åˆ Cosign / Notary å®ç°é•œåƒç­¾å RBAC æƒé™æ§åˆ¶ Keycloak åˆ†ç»„ + Harbor é¡¹ç›®æƒé™ æ—¥å¿—ä¸å®¡è®¡ å¯ç”¨ audit.log å¹¶å®šæœŸå¤‡ä»½ âœ… å››ã€éªŒè¯æµç¨‹ # å¯åŠ¨ Harbor å¹¶è®¿é—® https://harbor.yourdomain.com ç‚¹å‡»ç™»å½•ï¼Œå°†è·³è½¬åˆ° Keycloak é¡µé¢ ç™»å½•åè‡ªåŠ¨å®Œæˆæ³¨å†Œå¹¶è¿›å…¥ Harbor æ§åˆ¶å° ğŸ“¦ äº”ã€è¡¥å……å»ºè®® # Harbor æ”¯æŒé«˜å¯ç”¨éƒ¨ç½²ï¼Œå¯é…åˆ Nginx Ingress + Keepalived å®ç° Harbor æ”¯æŒ Helm Charts ç®¡ç†ï¼Œå¯ç»“åˆ GitOps å·¥å…·ä½¿ç”¨ å»ºè®®å®šæœŸæ›´æ–° Trivy æ•°æ®åº“ï¼Œä¿æŒæ¼æ´æ‰«æèƒ½åŠ›çš„æ—¶æ•ˆæ€§ "},{"id":102,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/harbor/introduce/","title":"Introduce","section":"Harbor","content":" ğŸš¢ Harbor ä»‹ç»æ–‡æ¡£ # ğŸ“Œ ä¸€ã€Harbor ç®€ä»‹ # Harbor æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†å‘å®¹å™¨é•œåƒçš„ä¼ä¸šçº§ Registry æœåŠ¡ï¼Œç”± VMware å¼€æºã€‚å®ƒåœ¨ Docker Registry çš„åŸºç¡€ä¸Šæ‰©å±•äº†è§’è‰²è®¿é—®æ§åˆ¶ã€é•œåƒå¤åˆ¶ã€å®¡è®¡æ—¥å¿—ã€é•œåƒæ‰«æã€å®‰å…¨ç­–ç•¥ç­‰ä¼ä¸šåŠŸèƒ½ï¼Œæ”¯æŒ Helm Chart çš„æ‰˜ç®¡ï¼Œé€‚ç”¨äºå¤šç§Ÿæˆ·åœºæ™¯ã€‚\nâš™ï¸ äºŒã€Harbor çš„åŸç† # Harbor æ˜¯ä¸€ä¸ªåŸºäº RESTful API çš„æ¶æ„ï¼Œä¾èµ–äºåº•å±‚çš„ Docker Registryï¼Œæä¾›å¢å¼ºçš„è®¿é—®æ§åˆ¶ã€å®‰å…¨æœºåˆ¶ã€é•œåƒæ‰«æä¸å¤åˆ¶ç­‰èƒ½åŠ›ã€‚å®ƒå°†é•œåƒå­˜å‚¨ã€æƒé™è®¤è¯ã€ç”¨æˆ·ç®¡ç†ã€å®¡è®¡æ—¥å¿—ã€Web UI å’Œç¬¬ä¸‰æ–¹é›†æˆæ¨¡å—æœ‰æ•ˆç»“åˆï¼Œæ„å»ºäº†ä¸€ä¸ªå…¨é¢çš„é•œåƒç®¡ç†å¹³å°ã€‚\næ ¸å¿ƒåŸç†åŒ…æ‹¬ï¼š\nğŸ§‘â€ğŸ’» ç”¨æˆ·é€šè¿‡ Web UI æˆ– CLI ç™»å½• Harborï¼Œè·å– token ğŸ” ä½¿ç”¨ token è¿›è¡Œæƒé™æ§åˆ¶å’Œèº«ä»½è®¤è¯ ğŸ” æ”¯æŒå¤šç§é•œåƒå¤åˆ¶ç­–ç•¥ï¼Œå®ç°è·¨æ•°æ®ä¸­å¿ƒçš„é•œåƒåŒæ­¥ ğŸ›¡ï¸ å¯¹æ¥ Trivy ç­‰æ‰«æå™¨å®ç°æ¼æ´æ£€æµ‹ ğŸ§± ä¸‰ã€Harbor æ¶æ„å›¾ # +---------------------+ | Web UI | +----------+----------+ | +----------v----------+ | API Server |\u0026lt;------------+ +----------+----------+ | | | +----------v----------+ +---------v----------+ | Core Services | | Authentication | | (Project/User Mgmt) | | (LDAP/DB/OIDC) | +----------+----------+ +---------+----------+ | | +----------v----------+ +---------v----------+ | Job Service | | Scanner (Trivy) | +----------+----------+ +--------------------+ | +----------v----------+ | Registry (Docker) | +----------+----------+ | +----------v----------+ | Storage Backend | +---------------------+ ğŸ§° å››ã€Harbor çš„ä½œç”¨ # ğŸ¢ ç§æœ‰é•œåƒä»“åº“ï¼šä¸ºä¼ä¸šæä¾›å®‰å…¨çš„é•œåƒä»“åº“ï¼Œé˜²æ­¢å…¬å…±ä»“åº“çš„ä¸ç¨³å®šå’Œå®‰å…¨é£é™©ã€‚ ğŸ§‘â€ğŸ”§ è®¿é—®æ§åˆ¶å’Œæƒé™ç®¡ç†ï¼šæ”¯æŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)ï¼Œç¡®ä¿èµ„æºéš”ç¦»å’Œæƒé™å®‰å…¨ã€‚ ğŸŒ é•œåƒå¤åˆ¶ä¸å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼šæ”¯æŒè·¨ Harbor å®ä¾‹çš„é•œåƒåŒæ­¥ï¼Œä¾¿äºå¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²ä¸å¤‡ä»½ã€‚ ğŸ•µï¸â€â™‚ï¸ é•œåƒæ¼æ´æ‰«æï¼šé›†æˆ Trivy ç­‰æ‰«æå·¥å…·ï¼Œæå‡é•œåƒå®‰å…¨æ€§ã€‚ ğŸ“ å®¡è®¡æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰ç”¨æˆ·æ“ä½œï¼Œæ–¹ä¾¿å®‰å…¨å®¡è®¡ä¸é—®é¢˜è¿½è¸ªã€‚ ğŸ“¦ æ”¯æŒ Helm Chartï¼šä¸ä»…æ”¯æŒå®¹å™¨é•œåƒï¼Œè¿˜æ”¯æŒ Helm Chart ä»“åº“ç®¡ç†ã€‚ ğŸ§¾ äº”ã€æ€»ç»“ # Harbor ä½œä¸ºä¼ä¸šçº§å®¹å™¨é•œåƒç®¡ç†å¹³å°ï¼Œæ˜¯æ„å»ºå®‰å…¨ã€å¯é ã€é«˜æ•ˆ DevOps æµæ°´çº¿çš„å…³é”®ç»„ä»¶ã€‚é€šè¿‡å…¶ä¸°å¯Œçš„åŠŸèƒ½å’Œè‰¯å¥½çš„æ‰©å±•æ€§ï¼Œä¸ºå®¹å™¨åŒ–ç”Ÿäº§ç¯å¢ƒæä¾›äº†é‡è¦æ”¯æŒã€‚\n"},{"id":103,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/helm-install-postgresql/","title":"Helm Install Postgresql","section":"äº‘åŸç”Ÿ","content":" ä½¿ç”¨ Helm å®‰è£… PostgreSQL åˆ° Kubernetes # å‰ææ¡ä»¶ # å·²å®‰è£…å¹¶é…ç½®å¥½çš„ Kubernetes é›†ç¾¤ æœ¬åœ°å·²å®‰è£…å¹¶é…ç½®å¥½ kubectl å®‰è£…äº† Helm v3+ æ­¥éª¤ä¸€ï¼šæ·»åŠ  Bitnami Helm ä»“åº“ # helm repo add bitnami https://charts.bitnami.com/bitnami helm repo update æ­¥éª¤äºŒï¼šåˆ›å»ºå‘½åç©ºé—´ï¼ˆå¯é€‰ï¼‰ # kubectl create namespace postgres æ­¥éª¤ä¸‰ï¼šå®‰è£… PostgreSQL # helm install my-postgresql \\ --namespace postgres \\ --set auth.postgresPassword=your-password \\ bitnami/postgresql ä½ å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹å‚æ•°ï¼Œå¦‚ï¼š\nauth.postgresPasswordï¼šè®¾ç½® PostgreSQL çš„å¯†ç  primary.persistence.enabled=true/falseï¼šæ˜¯å¦å¯ç”¨æ•°æ®æŒä¹…åŒ– primary.resources.requestsï¼šè®¾ç½® CPU/å†…å­˜è¯·æ±‚èµ„æº æ­¥éª¤å››ï¼šéªŒè¯å®‰è£… # kubectl get pods -n postgres kubectl get svc -n postgres æ­¥éª¤äº”ï¼šè¿æ¥åˆ° PostgreSQL # æ–¹å¼ä¸€ï¼šé€šè¿‡ Pod å†…éƒ¨è¿æ¥ # kubectl run -i --tty --rm psql-client --image=bitnami/postgresql --namespace postgres \\ --env=\u0026#34;PGPASSWORD=your-password\u0026#34; \\ --command -- psql -h my-postgresql.postgres.svc.cluster.local -U postgres æ–¹å¼äºŒï¼šé€šè¿‡ç«¯å£è½¬å‘ï¼ˆæœ¬åœ°è¿æ¥ï¼‰ # kubectl port-forward --namespace postgres svc/my-postgresql 5432:5432 ç„¶åä½¿ç”¨æœ¬åœ°å·¥å…·è¿æ¥ï¼š\npsql -h 127.0.0.1 -U postgres -p 5432 å¯†ç ä¸º your-password\næ­¥éª¤å…­ï¼šå¸è½½ PostgreSQLï¼ˆå¯é€‰ï¼‰ # helm uninstall my-postgresql -n postgres kubectl delete namespace postgres é™„å½•ï¼šå¸¸ç”¨ Helm å‚æ•° # å‚æ•° æè¿° ç¤ºä¾‹ auth.postgresPassword è®¾ç½® PostgreSQL å¯†ç  your-password primary.persistence.enabled å¯ç”¨æŒä¹…åŒ– true primary.persistence.size å­˜å‚¨å¤§å° 8Gi primary.resources.requests.memory å†…å­˜è¯·æ±‚ 512Mi primary.resources.requests.cpu CPU è¯·æ±‚ 250m æ›´å¤šå‚æ•°è¯¦è§ï¼š Bitnami PostgreSQL Helm Chart æ–‡æ¡£\n"},{"id":104,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/keycloak/install/","title":"Install","section":"Keycloak","content":" ğŸ—ï¸ Keycloak ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å— # ğŸ“¦ éƒ¨ç½²æ–¹å¼æ¦‚è§ˆ # Keycloak æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼Œå¸¸è§åŒ…æ‹¬ï¼š\nDocker / Podman å®¹å™¨éƒ¨ç½² Kubernetes / OpenShift éƒ¨ç½²ï¼ˆæ¨èç”Ÿäº§ä½¿ç”¨ï¼‰ ä½¿ç”¨ç‹¬ç«‹ JAR æ–‡ä»¶è¿è¡Œ Helm Chart éƒ¨ç½²ï¼ˆé€‚åˆ Kubernetes ç¯å¢ƒï¼‰ æœ¬æŒ‡å—ä»¥ Kubernetes ç¯å¢ƒ + PostgreSQL æ•°æ®åº“ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚\nğŸ”§ ç¯å¢ƒå‡†å¤‡ # ç³»ç»Ÿè¦æ±‚ # Kubernetes é›†ç¾¤ï¼ˆv1.21+ï¼‰ Ingress Controllerï¼ˆå¦‚ nginx-ingressï¼‰ PostgreSQL æ•°æ®åº“ æŒä¹…åŒ–å­˜å‚¨ï¼ˆPVCï¼‰ Cert Managerï¼ˆå¯é€‰ï¼Œç”¨äº TLSï¼‰ å»ºè®®èµ„æºé…ç½® # ç»„ä»¶ CPU å†…å­˜ Keycloak 2æ ¸ 4Gi PostgreSQL 1æ ¸ 2Gi ğŸ³ ä½¿ç”¨ Helm éƒ¨ç½² Keycloak # 1ï¸âƒ£ æ·»åŠ  Helm ä»“åº“ # helm repo add bitnami https://charts.bitnami.com/bitnami helm repo update 2ï¸âƒ£ å®‰è£… PostgreSQLï¼ˆå¯é€‰ï¼Œæˆ–ä½¿ç”¨å¤–éƒ¨ DBï¼‰ # helm install keycloak-postgresql bitnami/postgresql \\ --set auth.postgresPassword=yourpassword \\ --set primary.persistence.enabled=true 3ï¸âƒ£ å®‰è£… Keycloak # helm install keycloak bitnami/keycloak \\ --set auth.adminUser=admin \\ --set auth.adminPassword=adminpassword \\ --set externalDatabase.host=keycloak-postgresql \\ --set externalDatabase.user=postgres \\ --set externalDatabase.password=yourpassword \\ --set proxy=edge \\ --set ingress.enabled=true \\ --set ingress.hostname=keycloak.example.com ğŸ”’ TLS é…ç½®ï¼ˆå¯é€‰ï¼‰ # å¦‚æœé›†ç¾¤ä¸­éƒ¨ç½²äº† cert-managerï¼Œå¯é€šè¿‡å¦‚ä¸‹æ–¹å¼é…ç½® TLSï¼š\ningress: enabled: true hostname: keycloak.example.com tls: true annotations: cert-manager.io/cluster-issuer: letsencrypt-prod extraTls: - hosts: - keycloak.example.com secretName: keycloak-tls ğŸ“ æ•°æ®æŒä¹…åŒ–é…ç½® # Keycloak é»˜è®¤å¼€å¯æŒä¹…åŒ–ï¼Œç¡®ä¿ statefulset æŒ‚è½½äº† PVCï¼š\npersistence: enabled: true size: 8Gi storageClass: standard ğŸ©º å¥åº·æ£€æŸ¥ä¸ç›‘æ§ # é»˜è®¤å¼€å¯ liveness/readiness probe å¯é€šè¿‡ Prometheus Operator é›†æˆ Keycloak Exporter å®ç°ç›‘æ§ ğŸ› ï¸ å¸¸è§é—®é¢˜æ’æŸ¥ # é—®é¢˜ è§£å†³æ–¹æ³• Admin é¡µé¢æ‰“ä¸å¼€ æ£€æŸ¥ ingress æˆ– admin å¯†ç æ˜¯å¦æ­£ç¡® æ•°æ®ä¸¢å¤± ç¡®ä¿ PVC æ­£å¸¸æŒ‚è½½å¹¶é…ç½®æŒä¹…åŒ– ç™»å½•å¤±è´¥ æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®æ˜¯å¦æ­£ç¡® ğŸ“š å‚è€ƒé“¾æ¥ # å®˜æ–¹æ–‡æ¡£ï¼š https://www.keycloak.org/documentation Helm Chartï¼š https://artifacthub.io/packages/helm/bitnami/keycloak GitHubï¼š https://github.com/keycloak/keycloak âœ… å»ºè®®å°† Keycloak ä¸ LDAP/AD é›†æˆï¼Œå¹¶å®šæœŸå¤‡ä»½æ•°æ®åº“ï¼Œå¯ç”¨é«˜å¯ç”¨éƒ¨ç½²ä»¥å¢å¼ºç¨³å®šæ€§ã€‚\n"},{"id":105,"href":"/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/keycloak/introduce/","title":"Introduce","section":"Keycloak","content":" ğŸ›¡ï¸ Keycloak ç®€ä»‹ä¸æ¶æ„ # ğŸ“Œ ä»€ä¹ˆæ˜¯ Keycloakï¼Ÿ # Keycloak æ˜¯ä¸€ä¸ªå¼€æºçš„èº«ä»½å’Œè®¿é—®ç®¡ç† (IAM) è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå•ç‚¹ç™»å½• (SSO)ã€èº«ä»½è®¤è¯ã€æˆæƒå’Œç”¨æˆ·ç®¡ç†åŠŸèƒ½ï¼Œé€‚ç”¨äºç°ä»£åº”ç”¨ç¨‹åºä¸æœåŠ¡ã€‚\nå®ƒç”± Red Hat é¢†å¯¼ç»´æŠ¤ï¼Œå¹¿æ³›ç”¨äºå¾®æœåŠ¡æ¶æ„ã€å®‰å…¨ç½‘å…³ã€ä¼ä¸šçº§æƒé™æ§åˆ¶ç­‰åœºæ™¯ã€‚\nğŸ§  Keycloak çš„æ ¸å¿ƒåŸç† # Keycloak åŸºäº OAuth 2.0ã€OpenID Connect å’Œ SAML 2.0 ç­‰æ ‡å‡†åè®®æ„å»ºï¼Œå…è®¸å¼€å‘è€…å°†è®¤è¯äº¤ç»™ Keycloak å¤„ç†ï¼Œä»è€Œç®€åŒ–åº”ç”¨ç¨‹åºçš„èº«ä»½å®‰å…¨å®ç°ã€‚\nğŸ” èº«ä»½è®¤è¯ï¼šç”¨æˆ·é€šè¿‡ Keycloak ç™»å½•ï¼Œè·å–è®¿é—®ä»¤ç‰Œã€‚ ğŸ†” æˆæƒç®¡ç†ï¼šå®šä¹‰è§’è‰²ï¼ˆRoleï¼‰ä¸æƒé™ï¼ˆPermissionï¼‰æ¥æ§åˆ¶èµ„æºè®¿é—®ã€‚ ğŸ” å•ç‚¹ç™»å½•ä¸ç™»å‡ºï¼šä¸€æ¬¡ç™»å½•ï¼Œè®¿é—®å¤šä¸ªç³»ç»Ÿï¼›ç»Ÿä¸€ç™»å‡ºæ¸…é™¤æ‰€æœ‰ç™»å½•çŠ¶æ€ã€‚ ğŸ“¦ å¤šåè®®æ”¯æŒï¼šæ”¯æŒæ ‡å‡† OAuth2ã€OIDCã€SAML åè®®ï¼Œå…¼å®¹æ€§å¼ºã€‚ ğŸ—ï¸ Keycloak æ¶æ„å›¾ # graph LR A[ç”¨æˆ·] --\u0026gt;|æµè§ˆå™¨è®¿é—®| B(Keycloak ç™»å½•ç•Œé¢) B --\u0026gt; C[èº«ä»½éªŒè¯ï¼ˆç”¨æˆ·å/å¯†ç ã€ç¤¾äº¤ç™»å½•ç­‰ï¼‰] C --\u0026gt; D[Keycloak Server] D --\u0026gt;|Token| E[å®¢æˆ·ç«¯åº”ç”¨] E --\u0026gt;|è®¿é—®| F[å—ä¿æŠ¤èµ„æº] æˆ–ç®€åŒ–ä¸ºï¼š\n[ç”¨æˆ·] --æµè§ˆå™¨--\u0026gt; [Keycloak Server] --Token--\u0026gt; [å®¢æˆ·ç«¯] --è¯·æ±‚--\u0026gt; [å—ä¿æŠ¤æœåŠ¡] âš™ï¸ Keycloak çš„ç»„ä»¶ # ğŸ›ï¸ Realmï¼šä¸€ä¸ªé€»è¾‘éš”ç¦»çš„ç©ºé—´ï¼Œå®šä¹‰äº†ä¸€ç»„ç”¨æˆ·ã€è§’è‰²å’Œå®¢æˆ·ç«¯ã€‚ ğŸ‘¥ Userï¼šç³»ç»Ÿä¸­çš„ç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºæˆ–é›†æˆ LDAPã€ADã€‚ ğŸ­ Clientï¼šæ¥å…¥ Keycloak çš„åº”ç”¨ï¼Œæ”¯æŒé…ç½®è®¿é—®ç±»å‹ä¸åè®®ã€‚ ğŸ§© Role / Groupï¼šç”¨äºæƒé™æ§åˆ¶å’Œç»„ç»‡ç®¡ç†ã€‚ ğŸ”Œ Identity Provider (IdP)ï¼šç¬¬ä¸‰æ–¹èº«ä»½æºï¼ˆå¦‚ Googleã€GitHub ç­‰ï¼‰ã€‚ ğŸ¯ Keycloak çš„ä½œç”¨ # âœ… å®ç°ç»Ÿä¸€è®¤è¯ä¸æˆæƒï¼šç®€åŒ–å¤šç³»ç»Ÿçš„ç™»å½•é€»è¾‘ã€‚ ğŸ”„ æä¾›å•ç‚¹ç™»å½•èƒ½åŠ›ï¼šä¸€æ¬¡ç™»å½•ï¼Œå¤„å¤„é€šè¡Œã€‚ ğŸ” æ”¯æŒç²¾ç»†åŒ–æƒé™æ§åˆ¶ï¼šé€šè¿‡è§’è‰²ä¸ç­–ç•¥è¿›è¡Œè®¿é—®æ§åˆ¶ã€‚ ğŸ§¬ é›†æˆå¤šç§èº«ä»½æºï¼šæ”¯æŒ LDAPã€Active Directoryã€ç¤¾äº¤è´¦å·ã€‚ ğŸ“Š æä¾›å¯è§†åŒ–ç®¡ç†ç•Œé¢ï¼šæ–¹ä¾¿é…ç½®ç”¨æˆ·ã€è§’è‰²ã€å®¢æˆ·ç«¯ã€‚ ğŸ“¤ æ”¯æŒ REST API ä¸ Admin CLIï¼šå¯é›†æˆè‡ªåŠ¨åŒ–å¹³å°ã€‚ ğŸ“š æ€»ç»“ # Keycloak æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ IAM å·¥å…·ï¼Œé€‚ç”¨äºä»å°å‹é¡¹ç›®åˆ°ä¼ä¸šçº§ç³»ç»Ÿçš„è®¤è¯ä¸æˆæƒéœ€æ±‚ã€‚é€šè¿‡æ ‡å‡†åè®®ã€çµæ´»é…ç½®ä»¥åŠä¸°å¯Œçš„é›†æˆèƒ½åŠ›ï¼Œä¸ºç°ä»£åº”ç”¨å®‰å…¨ä¿é©¾æŠ¤èˆªã€‚\nğŸ”— ç›¸å…³é“¾æ¥ï¼š\nå®˜ç½‘ï¼š https://www.keycloak.org GitHubï¼š https://github.com/keycloak/keycloak æ–‡æ¡£ï¼š https://www.keycloak.org/documentation.html "}]
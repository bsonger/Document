<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>operate on bei的个人博客</title>
    <link>http://localhost:1313/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/operate/</link>
    <description>Recent content in operate on bei的个人博客</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <atom:link href="http://localhost:1313/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/operate/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>如何创建kubeConfig</title>
      <link>http://localhost:1313/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/operate/%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BAkubeconfig/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/docs/%E4%BA%91%E5%8E%9F%E7%94%9F/operate/%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BAkubeconfig/</guid>
      <description>&lt;h1 id=&#34;如何创建kubeconfig&#34;&gt;&#xA;  如何创建kubeConfig&#xA;  &lt;a class=&#34;anchor&#34; href=&#34;#%e5%a6%82%e4%bd%95%e5%88%9b%e5%bb%bakubeconfig&#34;&gt;#&lt;/a&gt;&#xA;&lt;/h1&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;创建clusterRole&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl create clusterrole monitor --resource&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;prometheusrule --verb&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;&#xA;&lt;li&gt;创建clusterRoleBinding&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl create clusterrolebinding monitor --clusterrole&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;rule --user monitor&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;&#xA;&lt;li&gt;生成普通用户令牌&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd /etc/kubernetes/pki &lt;span style=&#34;color:#75715e&#34;&gt;#你的集群证书目录&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;user&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;monitor&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;organization&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;monitoring&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;clustername&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;cluster02&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 【集群地址，例如：https://172.21.114.169:6443】&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;api_addr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://192.168.31.208:6443&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;time_days&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;365&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#复制粘贴下面的代码即可&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;umask 077;openssl genrsa -out $user.key &lt;span style=&#34;color:#ae81ff&#34;&gt;2048&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;openssl req -new -key $user.key -out $user.csr -subj &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/O=&lt;/span&gt;$organization&lt;span style=&#34;color:#e6db74&#34;&gt;/CN=&lt;/span&gt;$user&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;openssl  x509 -req -in $user.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out $user.crt -days $time_days&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl config set-cluster $clustername --server&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$api_addr --certificate-authority&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;ca.crt --embed-certs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;true --kubeconfig&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/root/$user.config&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl config set-credentials $user --client-certificate&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$user.crt --client-key&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$user.key --embed-certs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;true --kubeconfig&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/root/$user.config&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl config set-context $user@$clustername --cluster&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$clustername --user&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$user --kubeconfig&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/root/$user.config&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl config use-context $user@$clustername --kubeconfig&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/root/$user.config&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
  </channel>
</rss>
